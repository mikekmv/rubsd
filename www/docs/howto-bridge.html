<!--#set var="DOC_TITLE" value="Настройка Ethernet Bridge" -->
<!--#set var="DOC_ROOT" value="../" -->
<!--#include virtual="../header.html" -->

&nbsp; &nbsp; Начиная с версии 2.5, появилась возможность использования OpenBSD
в качестве Ethernet Bridge. Использование функции Bridge позволяет объединить
несколько сегментов Ethernet в один логический сегмент. При этом допустимо
использование правил фильтрации ipf, что позволяет превратить OpenBSD в
прозрачный IP фильтр.

<p>
Чтобы настроить OpenBSD в качестве Ethernet Bridge, нужно
выполнить следующие шаги:
<ol>
	<li>Сконфигурировать ядро OpenBSD, включив в него псевдо-устройство
	&quot;bridge&quot;. Файл конфигурации ядра должен содержать строку
	&quot;<strong>pseudo-device bridge 1</strong>&quot;. Вместо числа
	<strong>1</strong> нужно подставить количество предполагаемых
	логических сегментов.
	<p>
	<li>Создать файл конфигурации /etc/bridgename.bridge0, содержащий
	команды конфигурации Bridge, например:
	<strong><pre>
	add rl0
	add fxp0
	up
	</pre></strong>
	В данном случае мы объявляем интерфейсы fxp0 и rl0 одним логическим
	Ethernet сегментом. Подробнее о командах конфигурирования Bridge
	можно прочитать в <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&section=8">
	brconfig(8)</a>. При использовании нескольких логических сегментов,
	следует создать файл конфигурации для каждого псевдоустройства bridge.
	<p>
	<li>Создать файлы конфигурации сетевых интерфейсов:<br>
	<p>
	<font color="#008000">/etc/hostname.fxp0</font>:
	<strong><pre>
	inet 194.226.170.3 255.255.255.0 NONE media 100baseTX
	</pre></strong>
	<font color="#008000">/etc/hostname.rl0</font>:
	<strong><pre>
	up media 100baseTX
	</pre></strong>

	Подробнее о файлах конфигурации сетевых интерфейсов можно прочитать в
	<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&section=5">
	hostname.if(5)</a>
	<p>
	Обратите внимание, что IP адрес присваивается только одному интерфейсу.
	Допускается также создание Bridge, не имеющего своего IP адреса.
	<p>
	<li>Перезагрузить машину.
</ol>

<font color="#ff0000">Замечания</font>:
<ul>
	<li>При использовании ipf для фильтрации пакетов, проходящих через
	Bridge, действуют только правила для входящих пакетов.
	<li>При использовании OpenBSD Packet Filter, пакет проходящий через
	Bridge попадает под проверку PF два раза, при входе на одном интерфейсе
	и при выходе на другом. Чтобы производить keep-state фильтрацию, нам
	необходимо разрешить все входящие и исходящие пакеты на одном
	интерфейсе, а на другом производить фильтрацию. Пример правил:
	<ul><pre>
	# фильтрация производится на rl0, поэтому пропускаем все пакеты на rl1
	pass in  quick on rl1 all
	pass out quick on rl1 all

	# по умолчанию мы блокируем все пакеты, и пропускаем только
	# запросы icmp с получившимися keep-state ответами в обе стороны.
	block in  on rl0 all
	block out on rl0 all
	pass in  on rl0 inet proto icmp all icmp-type echoreq keep state
	pass out on rl0 inet proto icmp all icmp-type echoreq keep state
	</pre></ul>
	<li>Если во время работы Bridge, производится перенос какого-нибудь
	компьютера (или другого устройства, имеющего свой Ethernet адрес) с
	одного Ethernet сегмента на другой, следует выполнить команду
	<strong><pre>
	brconfig bridge0 flush
	</pre></strong>
	(где bridge0 - псевдо-интерфейс Bridge, к которому относится Ethernet
	сегмент, в котором раньше находился компьютер).
</ul>

<hr>
<small><em>$RuOBSD: howto-bridge.html,v 1.3 2001/01/06 05:42:48 form Exp $</em></small>

</body>
</html>
