<!--#set var="DOC_TITLE" value="Настройка Ethernet Bridge" -->
<!--#include virtual="doc_header.html" -->

<h3><font color="#0000e0">Настройка Ethernet Bridge</font></h3>

Начиная с версии 2.5, появилась возможность использования OpenBSD в качестве
Ethernet Bridge. Использование функции Bridge позволяет объединить несколько
сегментов Ethernet в один логический сегмент. При этом допустимо использование
правил фильтрации pf/ipf, что позволяет превратить OpenBSD в прозрачный IP
фильтр.

<p>
Чтобы настроить OpenBSD в качестве Ethernet Bridge, нужно
выполнить следующие шаги:
<ul>
	<li>Сконфигурировать ядро OpenBSD, включив в него псевдо-устройство
	&quot;bridge&quot;. Файл конфигурации ядра должен содержать строку
	&quot;<strong>pseudo-device bridge 1</strong>&quot;. Вместо числа
	<strong>1</strong> нужно подставить количество предполагаемых
	логических сегментов.
	<li>Создать файл конфигурации /etc/bridgename.bridge0, содержащий
	команды конфигурации Bridge, например:
</ul>

<table border="0" width="600" align="center" cellpadding="15" cellspacing="0">
<tr><td nowrap bgcolor="#c9c9ff">
<pre>
add rl0
add fxp0
up
</pre>
</td></tr>
</table>

<ul>
	В данном случае мы объявляем интерфейсы fxp0 и rl0 одним логическим
	Ethernet сегментом. Подробнее о командах конфигурирования Bridge
	можно прочитать в <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&section=8">
	brconfig(8)</a>. При использовании нескольких логических сегментов,
	следует создать файл конфигурации для каждого псевдоустройства bridge.
	<p>
	<li>Создать файлы конфигурации сетевых интерфейсов:<br>
	<p><font color="#008000">/etc/hostname.fxp0</font>:
</ul>

<table border="0" width="600" align="center" cellpadding="15" cellspacing="0">
<tr><td nowrap bgcolor="#c9c9ff">
<pre>
inet 194.226.170.3 255.255.255.0 NONE media 100baseTX
</pre>
</td></tr>
</table>

<ul><p><font color="#008000">/etc/hostname.rl0</font>:</ul>

<table border="0" width="600" align="center" cellpadding="15" cellspacing="0">
<tr><td nowrap bgcolor="#c9c9ff">
<pre>
up media 100baseTX</pre>
</td></tr>
</table>

<ul>
	<p>Подробнее о файлах конфигурации сетевых интерфейсов можно прочитать в
	<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&section=5">
	hostname.if(5)</a>
	<p>
	Обратите внимание, что IP адрес присваивается только одному интерфейсу.
	Допускается также создание Bridge, не имеющего своего IP адреса.
	<p>
	<li>Перезагрузить машину.
</ul>

<h3><font color="#ff0000">Замечания</font></h3>

<ul>
	<li>При использовании OpenBSD Packet Filter, пакет проходящий через
	Bridge попадает под проверку PF два раза, при входе на одном интерфейсе
	и при выходе на другом. Чтобы производить keep-state фильтрацию, нам
	необходимо разрешить все входящие и исходящие пакеты на одном
	интерфейсе, а на другом производить фильтрацию. Пример правил:
</ul>

<table border="0" width="600" align="center" cellpadding="15" cellspacing="0">
<tr><td nowrap bgcolor="#c9c9ff">
<pre>
# фильтрация производится на rl0, поэтому пропускаем все пакеты на rl1
pass in  quick on rl1 all
pass out quick on rl1 all

# по умолчанию мы блокируем все пакеты, и пропускаем только
# icmp запросы с получившимися keep-state ответами в обе стороны.
block in  on rl0 all
block out on rl0 all
pass in  on rl0 inet proto icmp all icmp-type echoreq keep state
pass out on rl0 inet proto icmp all icmp-type echoreq keep state
</pre>
</td></tr>
</table>

<ul>
	<li>При использовании ipf для фильтрации пакетов, проходящих через
	Bridge, действуют только правила для входящих пакетов.
	<li>Если во время работы Bridge, производится перенос какого-нибудь
	компьютера (или другого устройства, имеющего свой Ethernet адрес) с
	одного Ethernet сегмента на другой, следует выполнить команду
</ul>

<table border="0" width="600" align="center" cellpadding="15" cellspacing="0">
<tr><td nowrap bgcolor="#EEEEEE">
<pre>
# brconfig bridge0 flush
</pre>
</td></tr>
</table>

<ul>
	(где bridge0 - псевдо-интерфейс Bridge, к которому относится Ethernet
	сегмент, в котором раньше находился компьютер).
</ul>

<p><hr>
<a href="index.html"><img height="24" width="24" src="../images/back.gif"
border="0" alt="OpenBSD.ru"></a>
<a href="mailto:www@openbsd.ru">www@openbsd.ru</a><br>
<small>$RuOBSD: howto-bridge.html,v 1.7 2001/11/14 15:29:26 dfa Exp $
</small>

</body>
</html>
