<!--#set var="DOC_TITLE" value="RSA/DSA аутентификация в OpenSSH" -->
<!--#include virtual="doc_header.html" -->

<h3><font color="#0000e0">Что это такое?</font></h3>

<p>
OpenSSH замена стандартных уязвимых протоколов, таких как telnet или rsh.
OpenSSH использует шифрованный канал для передачи данных. В нем могут быть
использованы алгоритмы аутентификации RSA или DSA.

<p>
Эти протоколы основаны на базе специально созданной паре ключей, а именно
публичном и приватном ключах. Это асимметричные алгоритмы шифрования, то есть
мы можем зашифровать информацию одним ключом, а расшифровать только другим,
в отличие, например от DES, где используется один и тот же ключ для шифрования
и расшифровки информации.

<p>
Для работоспособности этих протоколов нам необходима их настройка.
Во-первых, сгенерируем пару ключей. Опцией <strong>-t</strong> мы задаём
тип ключа, доступны следующие типы ключей <strong>rsa</strong>,
<strong>dsa</strong> для протокола SSH 2 и <strong>rsa1</strong> для SSH 1.

<ul>
  <pre>
$ <b>ssh-keygen -t dsa</b>
Generating public/private dsa key pair.
Enter file in which to save the key (/home/user/.ssh/id_dsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/user/.ssh/id_dsa.
Your public key has been saved in /home/user/.ssh/id_dsa.pub.
The key fingerprint is:
27:33:40:91:0f:81:df:0a:87:f5:58:60:bb:28:c8:ad user@home
  </pre>
</ul>

<p>
Далее, если необходимо, указываем место куда сохранит ключ, по умолчанию
<strong>/home/user/.ssh/id_dsa</strong>. Если вводим пароль, наш приватный
ключ будет зашифрован и для того, чтобы позднее воспользоваться этим ключом
нам необходимо будет ввести пароль. Публичный ключ имеет суффикс
<strong>.pub</strong>.

<p>
При использовании беспарольной аутентификации, любой кто имеет доступ к
приватному ключу, беспрепятственно может проникнуть на удалённую машину,
для которой этот ключ используется.

<p>
Публичный ключ не так важен, мы можем пересылать его по email или по ftp.

<p>
Мы так же рассмотрим способ аутентификации с использованием 
<a href="#agent">ssh-agent</a>, при котором приватный ключ будет
зашифрован паролем и нам не надо будет каждый раз вводить его при соединении,
за нас это будет делать другая запущенная программа.

<h3><font color="#0000e0">Беспарольная аутентификация</font></h3>

<p>После успешной генерации ключей, необходимо скопировать публичный ключ
на удалённую машину в файл <strong>~/.ssh/authorized_keys</strong>:

<ul>
  <pre>
$ <b>scp ~/.ssh/id_dsa.pub remote.server:~/.ssh/authorized_keys</b>
user@remote.server password:
id_dsa.pub         100% |***************************|   598     00:00
  </pre>
</ul>

<p>Пример файла конфигурации клиента <strong>~/.ssh/config</strong>:

<ul>
  <pre>
Host remote.server
	IdentityFile ~/.ssh/id_dsa
	RSAAuthentication yes

Host anoncvs.ca.openbsd.org
	Compression no

Host *
	Cipher blowfish
	Compression yes
	EscapeChar ~
	Port 22
	Protocol 2,1
	User user
  </pre>
</ul>

<p>
Пробуем присоединиться к удалённой машине <strong>remote.server</strong>:

<ul>
  <pre>
$ <b>ssh remote.server</b>
OpenBSD 3.0-current (RUOBSD) #19: Sat Dec  1 11:57:43 NOVT 2001

Welcome to OpenBSD: The proactively secure Unix-like operating system.

$
  </pre>
</ul>

<a name="agent"><h3><font color="#0000e0">Парольная аутентификация с использованием ssh-agent</font></h3></a>

<p>
ssh-agent специальная программа-демон, разработана для протоколов
аутентификации RSA/DSA, используется для хранения парольной фразы приватного
ключа. Используя эту программу, вы можете соединяться с удалённой машиной не
набирая пароль, и при этом ваши приватные ключи остаются защищёнными. Программа
клиент ssh поддерживает ssh-agent и может взаимодействовать с ним.

<p>
Ключи и их пароли добавляются к ssh-agent только один раз, используя ssh-add,
и далее ssh будет обращаться к ssh-agent для определения парольной фразы для
данного приватного ключа.

<p>
При запуске, ssh-agent в зависимости от вашего $SHELL, выводит команды для
установки переменных окружения:

<ul>
  <pre>
$ <b>ssh-agent</b>
SSH_AUTH_SOCK=/tmp/ssh-jyw17290/agent.17290; export SSH_AUTH_SOCK;
SSH_AGENT_PID=8809; export SSH_AGENT_PID;
echo Agent pid 8809;
$
  </pre>
</ul>

<p>
ssh-agent открывает сокет для общения с ssh и сообщает об этом, через
переменную окружения $SSH_AUTH_SOCK, а так же сообщает свой pid, который
установлен в переменной окружения $SSH_AGENT_PID и выводится командой echo.

<p>
Правильный запуск ssh-agent, используя встроенную в shell, команду eval:

<ul>
  <pre>
$ <b>eval `ssh-agent`</b>
Agent pid 17522
$
  </pre>
</ul>

<p>
или задав программу использующею ssh, как аргумент ssh-agent. В данном
случае это обычный shell:

<ul>
  <pre>
$ <b>ssh-agent /bin/ksh</b>
$ <b>env | grep SSH</b>
SSH_AUTH_SOCK=/tmp/ssh-SAe17087/agent.17087
SSH_AGENT_PID=20652
$
  </pre>
</ul>

<p>
Теперь необходимо добавить ключ и парольную фразу к нему, используя ssh-add:

<ul>
  <pre>
$ <b>ssh-add ~/.ssh/id_dsa</b>
Enter passphrase for /home/user/.ssh/id_dsa:
Identity added: /home/user/.ssh/id_dsa (/home/user/.ssh/id_dsa)
$
  </pre>
</ul>

<p>
Пробуем присоединиться к удалённой машине <strong>remote.server</strong>:

<ul>
  <pre>
$ <b>ssh remote.server</b>
OpenBSD 3.0-current (RUOBSD) #19: Sat Dec  1 11:57:43 NOVT 2001

Welcome to OpenBSD: The proactively secure Unix-like operating system.

$
  </pre>
</ul>

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../images/back.gif" border="0" alt="OpenBSD.ru"></a>
<a href="mailto:www@openbsd.ru">www@openbsd.ru</a>
<br>
<small>$RuOBSD: ssh.html,v 1.16 2002/02/28 19:24:04 dfa Exp $</small>

</body>
</html>
