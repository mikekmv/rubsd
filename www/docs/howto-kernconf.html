<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=koi8-r">
<meta http-equiv="Content-Language" content="ru">
<meta name="copyright" content="Copyright (c) 2006 by OpenBSD.ru">
<title>Сборка custom ядра</title>
</head>

<body bgcolor="#ffffff" text="#000000" link="#23238e">

<h2><font color="#e00000">Сборка custom ядра</font></h2>
<hr>

<p>
<strong>Содержание</strong>:<br>
<ul>
<li><a href="#intro">Зачем это нужно?</a>
<li><a href="#required">Основные опции</a>
<li><a href="#arch">Поддержка расширенных возможностей архитектуры</a>
<li><a href="#debug">Опции, используемые при отладке</a>
<li><a href="#diag">Статистика и диагностика</a>
<li><a href="#ip">Стеки протоколов IPv4 и IPv6</a>
<li><a href="#crypto">Криптография в ядре. Использование криптографии в
сетевых протоколах</a>
<li><a href="#filesystem">Файловые системы</a>
<li><a href="#compat">Совместимость с ранними версиями</a>
<li><a href="#emul">Двоичная совместимость с другими системами</a>
<li><a href="#xwindow">X Window System</a>
<li><a href="#example">Пример конфигурации ядра</a>
</ul>

<hr>

<a name="intro">
<h3><font color="#0000e0">Зачем это нужно?</font></h3>

<p>
Причин для сборки custom ядра может быть много, но основные это:

<ul>
<li>оптимизация по размеру;
<li>оптимизация по скорости;
<li>связанные с драйверами устройств (добавление, удаление или изменение
режима работы).
</ul>

<p>
<strong>Внимание:</strong> настройка custom ядра - это операция, предполагающая
определенный уровень понимания своих действий и способная привести систему
в нерабочее состояние. Данное руководство призвано прояснить некоторые детали
и помочь в настройке ядра подготовленным пользователям.

<p>
Основная идея оптимизации ядра по размеру - удаление неиспользуемого кода.
Это, прежде всего, неиспользуемые драйверы устройств и различные подсистемы.
Для поиска используемых драйверов устройств можно использовать вывод
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&sektion=8">dmesg(8)</a>,
а так же специализированные программы, например,
<a href="http://www.sentia.org/projects/dmassage/">dmassage</a>.

<p>
Неиспользуемые подсистемы ядра отключаются удалением соответствующих
<em>опций</em>, например, если не используется двоичная совместимость с
исполняемыми файлами Linux, можно удалить опцию <code>COMPAT_LINUX</code>
и т. д. Список всех опций приведен в руководстве
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4">options(4)</a>.

<a name="required">
<h3><font color="#0000e0">Основные опции</font></h3>

Ниже приведен список <em>опций</em>, без которых работа ОС будет осложнена
или невозможна:

<p>
<table border="1" width="100%" cellpadding="10">
<tr valign="top">
<td width="20%">
<code>I386_CPU</code><br>
<code>I486_CPU</code><br>
<code>I586_CPU</code><br>
<code>I686_CPU</code>
</td>
<td>
Поддержка соответствующего семейства CPU (для архитектуры i386).
В целях стабильности рекомендуется указывать все опции сразу.
</td>
</tr>
<tr valign="top">
<td>
<code>FIFO</code>
</td>
<td>
Поддержка именованных каналов, достаточно распространенное средство
межпроцессорного взаимодействия (IPC).
</td>
</tr>
<tr valign="top">
<td>
<code>SYSVMSG</code><br>
<code>SYSVSEM</code><br>
<code>SYSVSHM</code>
</td>
<td>
Средства IPC из UNIX SystemV (очереди сообщений, семафоры, разделяемая память).
</td>
</tr>
<tr valign="top">
<td>
<code>FFS</code>
</td>
<td>
Файловая система Berkeley Fast File System.
</td>
</tr>
<tr valign="top">
<td>
<code>INET</code>
</td>
<td>
Поддержка протоколов стека IPv4.
</td>
</tr>
<tr valign="top">
<td>
<code>WSDISPLAY_COMPAT_USL</code><br>
<code>WSDISPLAY_DEFAULTSCREENS</code>
</td>
<td>
Поддержка виртуальных экранов.
</td>
</tr>
</table>
<p>
Остальные опции ядра включаются, если необходим соответствующий функционал.

<a name="arch">
<h3><font color="#0000e0">Поддержка расширенных возможностей архитектуры</font></h3>

<p>
За долгое время развития, архитектура i386 процессора вобрала в себя множество
различных возможностей. Некоторые фундаментальны, некоторые опциональны. Ряд
опциональных возможностей архитектуры i386 в OpenBSD представлен отдельными
опциями или устройствами.

<p>
Самыми интересными являются:

<p>
<table border="1" width="100%" cellpadding="10">
<tr valign="top">
<td width="20%">
<code>USER_LDT</code>
</td>
<td>
Добавляет возможность процессам менять локальную таблицу дескрипторов (LDT).
Обычно ядро OpenBSD полагается на глобальную таблицу дескрипторов (GDT) и
отдельные процессы не могут менять LDT. Однако, в ряде случаев, необходимо
иметь возможность изменять её. Чаще всего это связано с работой файлов и
библиотек других систем, например использование эмулятора Wine или Win32
кодеков в mplayer. Возможность изменения LDT должна быть явно задана
sysctl-флагом <tt><i>machdep.userldt</i></tt>.
</td>
</tr>
<tr valign="top">
<td>
<code>DUMMY_NOPS</code>
</td>
<td>
Эта опция не относится на прямую к "возможностям архитектуры", однако
напрямую зависит от старости системы. Включение этой опции убирает
задержки при опросе контроллера прерываний. На современных системах
это может несколько улучшить производительность периферийных устройств,
таких как сетевая карта.
</td>
</tr>
<tr valign="top"> 
<td>
<code>GPL_MATH_EMULATE</code>
</td>
<td>
Поддержка эмуляции FPU (математического сопроцессора) для систем, не
имеющих его в интегральном исполнении (например системы на основе
i486SX без отдельного сопроцессора). Поскольку система OpenBSD во
многих операциях полагается на операции с плавающей точкой, использование
эмуляции очень плохо отражается на общей работоспособности системы.
</td>
</tr>
</table>

<p>
Также поддерживаются два псевдо-устройства, связанные с дополнительными
возможностями процессоров семейства i386. Прежде всего это поддержка
регистров атрибутов областей памяти</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtrr&sektion=4">mtrr(4)</a>,
управляющих параметрами кэширования:

<pre>
pseudo-device mtrr
</pre>

<p>
Эти регистры используются X Window System и теоретически ускоряют работу
с видео подсистемой.

<p>
Второе псевдо-устройство предоставляет доступ к "счетчикам производительности"
процессоров Intel и к счетчикам времени TSC на других процессорах,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pctr&sektion=4">pctr(4)</a>:

<pre>
pseudo-device pctr
</pre>

<p>
"Счетчики производительности" процессоров Intel поддерживают широкие
возможности по наблюдению за прерываниями, кэшированием и др., в то
время как счетчики времени содержат лишь информацию о количестве
процессорных циклов, прошедших с момента загрузки ОС.

<p>
Эти средства часто используются в программах, измеряющих скорость
работы каких-либо процессов. Просмотреть текущие значения счетчиков
можно с помощью
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pctr&sektion=1">pctr(1)</a>.

<a name="debug">
<h3><font color="#0000e0">Опции, используемые при отладке</font></h3>

<p>
Отладка ядра OpenBSD может выполняться в двух режимах: непосредственно после
аварийного останова с использованием встроенного отладчика
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ddb&sektion=8">ddb(4)</a>
или отладка дампа памяти ядра в
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gdb&sektion=1">gdb(1)</a>
с использованием дополнительного ядра, содержащего отладочные символы.
Возможно использование обоих методов. За возможность использования <font
color="#008000">ddb</font> отвечает опция <code>DDB</code>, для того чтобы
отлаживать ядро по дампу памяти, необходимо соблюдение двух условий:

<ul>
<li>размер swap вмещает полный дамп памяти с некоторым запасом;
<li>ядро собрано с опцией <code>makeoptions DEBUG="-g"</code>.
</ul>

<p>
Для отладки пользовательских процессов удобно использовать
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ktrace&sektion=1">ktrace(1)</a>
или
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gdb&sektion=1">gdb(1)</a>.
Для этого необходимо включить опции <code>KTRACE</code> и <code>PTRACE</code>.

<a name="diag">
<h3><font color="#0000e0">Статистика и диагностика</font></h3>

<p>
OpenBSD поддерживает ряд опций, связанных со сбором статистики и
дополнительными проверками в коде ядра:

<p>
<table border="1" width="100%" cellpadding="10">
<tr valign="top">
<td width="20%">
<code>ACCOUNTING</code>
</td>
<td>
Поддержка сбора статистики работы системы по процессам (сюда входят данные
по нагрузке на процессор, дисковую подсистему и так далее). Реальное включение
сбора статистики производится с помощью
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=accton&sektion=8">accton(8)</a>.
</td>
</tr>
<tr valign="top">
<td>
<code>DIAGNOSTIC</code>
</td>
<td>
Включить дополнительные проверки в коде. Обычно это незначительные проверки,
которые могут привести к kernel panic. Можно попробовать отключить данную
опцию для достижения большей надежности системы, однако это может привести и
к нежелательным последствиям.
</td>
<tr valign="top">
<td>
<code>KMEMSTATS</code>
</td>
<td>
Сбор статистики по использованию памяти. Может быть отключен на рабочих
системах, поскольку требует дополнительных затрат процессора и памяти.
</td>
</tr>
</table>

<p>
Для достижения повышенной скорости работы эти опции могут быть почти
безболезненно удалены из конфигурации ядра.

<a name="ip">
<h3><font color="#0000e0">Стеки протоколов IPv4 и IPv6</font></h3>

<p>
<table border="1" width="100%" cellpadding="10">
<tr valign="top">
<td width="20%">
<code>INET</code>
</td>
<td>
Поддержка стека протоколов IPv4. Во многих случаях опция необходима.
</td>
</tr>
<tr valign="top">
<td>
<code>INET6</code>
</td>
<td>
Поддержка стека протоколов IPv6. Требует IPv4. Если вы не работаете с IPv6,
данную опцию можно отключить.
</td>
</tr>
<tr valign="top">
<td>
<code>TCP_SACK</code>
</td>
<td>
Поддержка механизма выборочного подтверждения TCP сегментов (Selective
Acknowledgements, RFC 2018). Позволяет повысить эффективность передачи TCP
сегментов. TCP SACK должен поддерживаться сервером и клиентами.
</td>
</tr>
<tr valign="top">
<td>
<code>TCP_ECN</code>
</td>
<td>
Поддержка явных уведомлений о перегрузках в сети (Explicit Congestion
Notification, RFC 3168). Позволяет дополнительно регулировать скорость
передачи TCP сегментов между двумя сторонами в следствии перегрузок в
канале передачи. TCP ECN должен поддерживаться обоими сторонами.
</td>
</tr>
<tr valign="top">
<td>
<code>ALTQ</code>
</td>
<td>
Поддержка механизмов обеспечения качества обслуживания (Quality of Service,
QoS). Включает в себя ряд дисциплин трафика: приоритетную, классовую и
иерархическую. Управление очередями осуществляется посредством соответствующих
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5#QUEUEING">правил
pf</a>.
</td>
</tr>
</table>

<p>
Пакетный фильтр
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&sektion=4">pf</a>,
работающий на межсетевом уровне (Internetworking) стека TCP/IP, поддерживает
работу как с IPv4, так и с IPv6 в зависимости от конфигурации ядра. Поддержка
<font color="#008000">pf</font> в ядре включается добавлением псевдо-устройства:

<pre>
pseudo-device pf
</pre>

<p>
Для того, чтобы в
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">правилах
pf</a> можно было использовать директиву <code>log</code>, необходимо добавить
поддержку псевдо-интерфейса
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&sektion=4">pflog(4)</a>:

<pre>
pseudo-device pflog
</pre>

<a name="crypto">
<h3><font color="#0000e0">Криптография в ядре. Использование криптографии в
сетевых протоколах</font></h3>

<p>
Криптография очень широко используется в ядре OpenBSD. В основу положено
обобщенное
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=crypto&sektion=9">OpenBSD 
Cryptographic Framework (OCF)</a>,
которое включается в сборку при указании опции <code>CRYPTO</code> - это базис
для всего кода, использующего криптографию в ядре.

<p>
Опция <code>UVM_SWAP_ENCRYPT</code> включает шифрование страниц памяти до
попадания в swap. По результатам тестирования на это затрачивается сравнительно
немного ресурсов, но для повышения быстродействия на слабых машинах,
возможно имеет смысл исключить эту опцию из файла конфигурации ядра. Отключить
шифрование можно также через
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a>:

<pre>
vm.swapencrypt.enable=0
</pre>

<p>
OpenBSD поддерживает ряд устройств, называемых крипто-акселераторами
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hifn&sektion=4">hifn(4)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ubsec&sektion=4">ubsec(4)</a>
и др.), которые способны регистрировать в OCF поддерживаемые алгоритмы, и ядро
в состоянии разгрузить работу по шифрованию на такие устройства. Доступ
пользовательских программ (таких как
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=openssl&sektion=1">OpenSSL</a>)
к этой подсистеме организуется через псевдоустройство
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=crypto&sektion=4">crypto(4)</a>:

<pre>
pseudo-device crypto
</pre>

<p>
Практика показывает, что использование подобных устройств способно реально
повысить быстродействие только в определенных случаях. Узкими местами
являются пропускная способность шины PCI и медлительность самих устройств,
по сравнению с современными CPU. Крипто-акселераторы могут повысить
быстродействие в тех случаях, когда используются медленные CPU, шина PCI
разгружена, а также при больших блоках шифруемых данных и при определенных
алгоритмах шифрования (чаще всего - блочных симметричных шифрах, например 3DES).
Однако, весьма эффективными являются криптографические средства, встроенные
непосредственно в CPU. Ярким примером является процессор
<a href="http://www.via.com.tw/en/products/processors/eden-n/">VIA Eden-N</a>,
поддерживающий инструкции работы с блочным симметричным шифрованием AES.

<p>
Поддержка IPsec включается опцией <code>IPSEC</code>. Требуется поддержка
IPv4 стека (опция <code>INET</code>), OCF (опция <code>CRYPTO</code>) и
специализированного псевдо-интерфейса
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&sektion=4">enc(4)</a>,
предназначенного для фильтрации ``внутри'' IPsec туннеля (а на самом деле, до
шифрования пакетов и после их дешифрования):

<pre>
pseudo-device enc
</pre>

<p>
Средства криптографии также применяются в ряде сетевых протоколов. При
использовании BGP маршрутизации очень часто используются подписанные TCP
сегменты для обеспечения аутентификации источника сообщений. В OpenBSD это
делается добавлением опции <code>TCP_SIGNATURE</code> (это требует
включенных опций <code>INET</code>, <code>CRYPTO</code>, <code>IPSEC</code>).

<p>
Протоколы
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&sektion=4">pfsync(4)</a>
и
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&sektion=4">carp(4)</a>
также используют криптографическую подпись пакетов, поэтому нуждаются в
поддержке OCF и зависят от ряда компонент IPsec.

<a name="filesystem">
<h3><font color="#0000e0">Файловые системы</font></h3>

<p>
Основной файловой системой в OpenBSD является Berkeley Fast File System.
Также поддерживаются FAT, NTFS, Linux Extended 2, ISO-9660, UDF и две
сетевые файловые системы: NFS и XFS.

<p>
<table border="1" width="100%" cellpadding="10">
<tr valign="top">
<td width="20%">
<code>FFS</code>
</td>
<td>
Файловая система Berkeley Fast File System.
</td>
</tr>
<tr valign="top">
<td>
<code>FFS_SOFTUPDATES</code>
</td>
<td>
Поддержка SoftUpdates для FFS. За счет системы буферизации заметно
увеличивает скорость записи на диск.
</td>
</tr>
<tr valign="top">
<td>
<code>UFS_DIRHASH</code>
</td>
<td>
Хеширование содержимого директорий, повышает скорость доступа к директориям
с большим количеством файлов.
</td>
</tr>
<tr valign="top">
<td>
<code>QUOTA</code>
</td>
<td>
Поддержка квот на файловой системе FFS.
</td>
</tr>
<tr valign="top">
<td>
<code>MFS</code>
</td>
<td>
Поддержка создания файловой системы в оперативной памяти, способной к
переходу в свап.
</td>
</tr>
<tr valign="top">
<td>
<code>MSDOSFS</code>
</td>
<td>
Поддержка FAT12, FAT16 и FAT32.
</td>
</tr>
<tr valign="top">
<td>
<code>NTFS</code>
</td>
<td>
Поддержка NTFS4 (Windows NT 4.0) и NTFS5 (Windows 2000 и более поздние) в
режиме только для чтения. <em>Нестабильно</em>.
</td>
</tr>
<tr valign="top">
<td>
<code>EXT2FS</code>
</td>
<td>
Поддержка Linux Extended 2 File System.
</td>
</tr>
<tr valign="top">
<td>
<code>CD9660</code>
</td>
<td>
Поддержка файловой системы ISO-9660, используемой на CD и DVD дисках
(мультисессионные диски не поддерживаются).
</td>
</tr>
<tr valign="top">
<td>
<code>UDF</code>
</td>
<td>
Поддержка файловой системы DVD. Обычно DVD диски могут быть смонтированы как
обычные CD.
</td>
</tr>
<tr valign="top">
<td>
<code>NFSCLIENT</code><br>
<code>NFSSERVER</code>
</td>
<td>
Поддержка сетевой файловой системы NFS в режимах клиента и сервера.
</td>
</tr>
<tr valign="top">
<td>
<code>XFS</code>
</td>
<td>
Поддержка сетевой распределенной файловой системы Andrew FS (AFS).
Практически не используется.
</td>
</tr>
</table>

<p>
Существуют и несколько виртуальных файловых систем: PROCFS и PORTAL.
Однако, из-за архитектурных особенностей системы они являются
необязательными. Файловая система PROCFS используется в основном с эмуляцией
Linux, а поддержка PORTAL осталась со времен BSD UNIX и не несет в себе
никакой смысловой нагрузки. Ранее также существовали файловые системы KERNFS,
NULLFS, UMAPFS и другие, но были удалены по причине нестабильности или
отсутствия в них нужды.

<a name="compat">
<h3><font color="#0000e0">Совместимость с ранними версиями</font></h3>

<p>
OpenBSD, как и любая развивающаяся система, эволюционирует, но в тоже
время пытается оставаться совместимой с прежними интерфейсами ядра и
двоичными файлами, скомпилированными для ранних версий системы.
Для этого существует ряд опций:

<p>
<table border="1" width="100%" cellpadding="10">
<tr valign="top">
<td width="20%">
<code>COMPAT_43</code>
</td>
<td>
Самая старая из опций совместимости. Отвечает за поддержку ряда устаревших
ioctl'ей для терминальных устройств и других незначительных интерфейсов.
В настоящее время, в подавляющем большинстве случаев может быть опущена.
</td>
</tr>
<tr valign="top">
<td>
<code>COMPAT_23</code><br>
<code>COMPAT_25</code><br>
<code>COMPAT_35</code>
</td>
<td>
Опции совместимости с соответствующей версией OpenBSD. Они вводились, когда
менялись интерфейсы ядра. Более подробно о том, для чего введены эти опции
написано в руководстве
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4">options(4)</a>.
</td>
</tr>
<tr valign="top">
<td> 
<code>COMPAT_AOUT</code>
</td>
<td>
Поддержка двоичных файлов, собранных для OpenBSD/i386 версий ниже 3.4 (т.е.
двоичные файлы формата <em>a.out</em>). Возможно будет необходимо также
включить опции совместимости с предыдущими версиями OpenBSD. Эмуляция
активизируется при включении опции <tt><i>kern.emul.aout</i></tt>.
</td>
</tr>
</table>

<a name="emul">
<h3><font color="#0000e0">Двоичная совместимость с другими системами</font></h3>

<p>
OpenBSD поддерживает эмуляцию системных вызовов для некоторых систем.
Основным требованием является принадлежность двоичного файла и хостовой
системе к одной архитектуре. Например OpenBSD поддерживает исполняемые
файлы от Solaris, но программы, оттранслированные для архитектуры SPARC
не загрузятся на i386-совместимом процессоре.

<p>
Подсистемы эмуляции опциональны и при желании могут не включаться в ядро.

<p>
Рассмотрим опции двоичной совместимости, предоставляемые для архитектуры i386.
По умолчанию эмуляция всех систем является отключенной. Для активизации,
необходимо выставить соответствующий sysctl-флаг.

<p>
<table border="1" width="100%" cellpadding="10">
<tr valign="top">
<td width="20%">
<code>COMPAT_LINUX</code>
</td>
<td>
Поддержка запускаемых файлов ОС Linux. (Возможно придется так же установить
порт с библиотеками Linux системы,
<font color="#008000">/usr/ports/emulators/redhat/</font>). Эмуляция
активизируется при включении <tt><i>kern.emul.linux</i></tt>.
Подробную информацию можно получить из
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&sektion=8">страницы
руководства</a>. 
</td>
</tr>
<tr valign="top">
<td>
<code>COMPAT_FREEBSD</code>
</td>
<td>
Поддержка запускаемых файлов ОС FreeBSD. (Существует порт, содержащий
библиотеки FreeBSD,
<font color="#008000">/usr/ports/emulators/freebsd_lib/</font>). Эмуляция
активизируется при включении <tt><i>kern.emul.freebsd</i></tt>.
Подробную информацию можно получить из
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_freebsd&sektion=8">страницы
руководства</a>.
</td>
</tr>
<tr valign="top">
<td>
<code>COMPAT_BSDOS</code><br>
<code>COMPAT_IBCS2</code><br>
<code>COMPAT_SVR4</code>
</td>
<td>
Поддержка запускаемых файлов систем BSDI, Solaris, SCO и др. Подробную
информацию можно найти в руководствах:
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_bsdos&sektion=8">compat_bsdos(8)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ibcs2&sektion=8">compat_ibcs2(8)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_svr4&sektion=8">compat_svr4(8)</a>.
</td>
</tr>
</table>

<p>
Если вы не используете двоичную совместимость с другими системами, настоятельно
рекомендуется не включать эмуляцию, поскольку история проекта уже насчитывает
ряд уязвимостей, выявленных в подсистеме эмуляции файлов iBCS2 и др.

<a name="xwindow">
<h3><font color="#0000e0">X Window System</font></h3>

Для корректной работы X Window System необходимы или желательны следующие
опции (платформа i386):

<p>
<table border="1" width="100%" cellpadding="10">
<tr valign="top">
<td width="20%">
<code>APERTURE</code>
</td>
<td>
Драйвер апертуры ядра, позволяет X серверу получать прямой доступ к видео
памяти и регистрам PCI устройств. Непосредственное разрешение использования
апертуры ядра осуществляется через sysctl-переменную:
<tt><i>machdep.allowaperture=2</i></tt>.
</td>
</tr>
<tr valign="top">
<td>
<code>USER_PCICONF</code>
</td>
<td>
Предоставляет прикладным процессам (например, X серверу) возможность получения
доступа к конфигурации PCI шины.
</td>
</tr>
<tr valign="top">
<td>
<code>PCIAGP</code>
</td>
<td>
Позволяет получать доступ X сервера к GART (Graphics Address Remapping Table).
</td>
</tr>
<tr valign="top">
<td>
<code>WSDISPLAY_COMPAT_RAWKBD</code><br>
<code>WSDISPLAY_COMPAT_PCVT</code>
</td>
<td>
Позволяет получить доступ к клавиатуре.
</td>
</tr>
</table>

<p>
На архитектуре i386 система X Window System может использовать регистры
атрибутов областей памяти</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtrr&sektion=4">mtrr(4)</a>,
управляющих параметрами кэширования. Использование этих регистров теоретически
может ускорить работу с видео подсистемой.

<a name="example">
<h3><font color="#0000e0">Пример конфигурации ядра</font></h3>

<p>
Теперь приведем укороченный пример конфигурации ядра для маршрутизатора.
IPsec не поддерживается. Драйверы устройств опущены.

<pre>
<strong>
machine 	i386

maxusers	32

makeoptions	DEBUG="-g"

option		BOOT_CONFIG,TIMEZONE="-180"
option		I386_CPU,I486_CPU,I586_CPU,I686_CPU
option		DUMMY_NOPS
option		PCIVERBOSE,USBVERBOSE

option		ACCOUNTING,CRYPTO,LKM
option		KTRACE,PTRACE
option		FIFO,SYSVMSG,SYSVSEM,SYSVSHM

option		WSDISPLAY_COMPAT_USL,WSDISPLAY_COMPAT_RAWKBD
option		WSDISPLAY_DEFAULTSCREENS=6,WSDISPLAY_COMPAT_PCVT
option		WS_KERNEL_FG=WSCOL_WHITE,WS_KERNEL_BG=WSCOL_BLACK

option		FFS,FFS_SOFTUPDATES,UFS_DIRHASH
option		CD9660,MSDOSFS,MFS

option		INET,TCP_SACK,TCP_ECN,ALTQ
option		NFSCLIENT,NFSSERVER

pseudo-device	pf
pseudo-device	pflog
pseudo-device	bpfilter
pseudo-device	loop
pseudo-device	gif
pseudo-device	gre
pseudo-device	tun
pseudo-device	vlan
pseudo-device	trunk

pseudo-device	ksyms
pseudo-device	systrace
pseudo-device	pty		16
pseudo-device	vnd		4
</strong>
</pre>

<p>
<hr>
<a href="index.html"><img height=24 width=24 src="../images/back.gif" border=0 alt="OpenBSD.ru"></a>
<a href="mailto:www@openbsd.ru">www@openbsd.ru</a>
<br>
<small>$RuOBSD: howto-kernconf.html,v 1.24 2006/03/04 23:25:30 mkb Exp $</small>

</body>
</html>
