<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=koi8-r">
<meta http-equiv="Content-Language" content="ru">
<meta name="copyright" content="Copyright (c) 2006 by OpenBSD.ru">
<title>Samba: Создание файл-сервера</title>
<link rel="stylesheet" href="css/style.css" type="text/css">
</head>

<body bgcolor="#ffffff" text="#000000" link="#23238e">

<h2><font color="#e00000">Samba: Создание файл-сервера</font></h2>
<hr>

<h3><font color="#0000e0">Мини-руководство "шаг за шагом"</font></h3>

<p>
<table border=0>
<tr><td>
<blockquote>

<p>
Устанавливаем Samba из портов:

<pre>
# <strong>cd /usr/ports/net/samba</strong>
# <strong>make install clean CLEANDEPENDS=Yes</strong>
</pre>

<p>
Либо с помощью прекомпилированного пакета:

<pre>
# <strong>export PKG_PATH=ftp://ftp.openbsd.org/pub/OpenBSD/3.8/packages/i386/</strong>
# <strong>pkg_add samba-3.0.13p0.tgz</strong>
</pre>

<p>
Создаем расшаренные каталоги:

<pre>
# <strong>mkdir -p /usr/data/video</strong>
# <strong>mkdir -m 777 /usr/data/public</strong>
</pre>

<p>
Редактируем <font color="#008000">smb.conf:</font>

<pre>
# <strong>vi /etc/samba/smb.conf</strong>
[global]
   workgroup = WORKGROUP
   netbios name = Server
   os level = 1
   dos charset = cp866
   unix charset = cp1251
   display charset = cp1251
   server string = Samba File Server
   security = share
   guest ok = yes
   hosts allow = 192.168.1.0/24 127.0.0.1

[video]
   path = /usr/data/video
   comment = Video
   browseable = yes
   writeable = no

[public]
   path = /usr/data/public
   comment = Public
   browseable = yes
   writable = yes
   create mask = 644
</pre>

<p>
Проверяем конфиг на наличие ошибок:

<pre>
# <strong>/usr/local/bin/testparm | less</strong>
</pre>

<p>
Запускаем <tt>smbd</tt> и <tt>nmbd</tt>:

<pre>
# <strong>/usr/local/libexec/smbd -D</strong>
# <strong>/usr/local/libexec/nmbd -D</strong>
</pre>

<p>
Проверяем работоспособность:

<pre>
# <strong>smbclient -U% -L localhost</strong>
Domain=[WORKGROUP] OS=[Unix] Server=[Samba 3.0.13]

	Sharename       Type      Comment
	---------       ----      -------
	video           Disk      Video
	public          Disk      Public
	IPC$            IPC       IPC Service (192.168.1.1)
	ADMIN$          IPC       IPC Service (192.168.1.1)
</pre>

<p>
Чтобы Samba автоматически запускалась при старте системы, внесем соответствующие
изменения в <font color="#008000">/etc/rc.local</font>:

<pre>
# <strong>vi /etc/rc.local</strong>
if [ -x /usr/local/libexec/smbd ]; then
	echo -n ' smbd';	/usr/local/libexec/smbd -D
fi

if [ -x /usr/local/libexec/nmbd ]; then
	echo -n ' nmbd';	/usr/local/libexec/nmbd -D
fi
</pre>

<p>
<br>
При необходимости можно воспользоваться SWAT (Samba Web-based Administrative
Tool):

<pre>
# <strong>echo 'swat 901/tcp' &gt;&gt; /etc/services</strong>
# <strong>echo 'swat stream tcp nowait.400 root /usr/local/libexec/swat swat' &gt;&gt; /etc/inetd.conf</strong>
# <strong>pkill -HUP inetd</strong>
</pre>

<p>
Внимание: по умолчанию при администрировании Samba с помощью SWAT вся
передаваемая информация, в том числе и пароли, передается в открытом виде.
Для обеспечения безопасности соединений необходимо дать указание stunnel
принимать входящие SSL-соединения на 902 порту, расшифровывать данные и
передавать их на порт 901.

<pre>
# <strong>vi /etc/stunnel/stunnel.conf</strong>
[swats]
accept  = 902
connect = 901
</pre>

<p>
Подробную информацию по настройке Stunnel можно получить из мини руководства
&quot;<a href="stunnel.html">Stunnel: Шифрование TCP-соединений, используя SSL
</a>&quot;.

</blockquote>

</td></tr>
</table>

<p>
<hr>
<a href="index.html"><img height=24 width=24 src="../../images/back.gif" border=0 alt="OpenBSD.ru"></a>
<a href="mailto:www@openbsd.ru">www@openbsd.ru</a>
<br>
<small>$RuOBSD: samba.html,v 1.9 2006/02/08 12:03:35 andrey Exp $</small>

</body>
</html>
