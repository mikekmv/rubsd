<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=koi8-r">
<meta http-equiv="Content-Language" content="ru">
<meta name="copyright" content="Copyright (c) 2005 by OpenBSD.ru">
<title>Nut: Управление и мониторинг работы ИБП</title>
<link rel="stylesheet" href="css/style.css" type="text/css">
</head>

<body bgcolor="#ffffff" text="#000000" link="#23238e">

<h2><font color="#e00000">Nut: Управление и мониторинг работы ИБП</font></h2>
<hr>

<h3><font color="#0000e0">Мини-руководство "шаг за шагом"</font></h3>

<p>
<table border=0>
<tr><td>

<blockquote>
<p>
Устанавливаем nut из портов:

<pre>
# <strong>cd /usr/ports/sysutils/nut</strong>
# <strong>env FLAVOR=no_cgi make install clean</strong>
</pre>

<p>
Или с помощью прекомпилированного пакета:

<pre>
# <strong>pkg_add ftp://ftp.openbsd.org/pub/OpenBSD/3.8/packages/i386/nut-2.0.0.tgz</strong>
</pre>

<p>
Создаем секцию myups с описанием ИБП:

<pre>
# <strong>vi /etc/nut/ups.conf</strong>

# APC SmartUPS 420, com1.
#
[myups]
	driver = apcsmart
	port = /dev/tty01
	desc = "Server"
</pre>

<p>
Задаем права доступа:

<pre>
# <strong>vi /etc/nut/upsd.users</strong>
[admin]
	password = ups123
	allowfrom = localhost
	actions = SET
	instcmds = ALL

[monuser]
	password = mon123
	allowfrom = localhost
	upsmon master
</pre>

<p>
Указываем ИБП, работу которого будем мониторить:

<pre>
# <strong>vi /etc/nut/upsmon.conf</strong>
MONITOR myups@localhost 1 monuser mon123 master
</pre>

<p>
Загружаем необходимый драйвер (в данном случае apcsmart):

<pre>
# <strong>/usr/local/bin/upsdrvctl start</strong>
Network UPS Tools - UPS driver controller 2.0.0
Network UPS Tools (version 2.0.0) - APC Smart protocol driver
	Driver version 1.99.6, command table version 2.0
Detected Smart-UPS 420    [QS0242142315] on /dev/tty01
</pre>

<p>
Загружаем upsd:

<pre>
# <strong>/usr/local/sbin/upsd</strong>
Network UPS Tools upsd 2.0.0
Connected to UPS [myups]: apcsmart-tty01
Synchronizing...done
</pre>

<p>
Загружаем upsmon:

<pre>
# <strong>/usr/local/sbin/upsmon</strong>
Network UPS Tools upsmon 2.0.0
UPS: myups@localhost (master) (power value 1)
Using power down flag file /etc/killpower
</pre>

<p>
Проверяем состояние ИБП:

<pre>
% <strong>upsc myups@localhost ups.status</strong>
OL
</pre>

<p>
В /etc/rc.local прописываем автозапуск nut:

<pre>
# <strong>vi /etc/rc.local</strong>
if [ -x /usr/local/bin/upsdrvctl ]; then
	echo -n ' nut'
	/usr/local/bin/upsdrvctl start &gt; /dev/null 2&gt;&amp;1
	/usr/local/sbin/upsd &gt; /dev/null 2&gt;&amp;1
	/usr/local/sbin/upsmon &gt; /dev/null 2&gt;&amp;1
fi
</pre>

<p>
Выключаем питание после того, как данные на дисках будут синхронизированы:

<pre>
# <strong>vi /etc/rc.shutdown</strong>
if [ -f /etc/killpower ]; then
	/usr/local/bin/upsdrvctl shutdown
	sleep 60
fi
</pre>

</blockquote>

</td></tr>
</table>

<p>
<hr>
<a href="index.html"><img height=24 width=24 src="../../images/back.gif" border=0 alt="OpenBSD.ru"></a>
<a href="mailto:www@openbsd.ru">www@openbsd.ru</a>
<br>
<small>$RuOBSD: nut.html,v 1.4 2006/01/17 20:41:07 andrey Exp $</small>

</body>
</html>
