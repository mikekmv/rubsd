<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=koi8-r">
<meta http-equiv="Content-Language" content="ru">
<meta name="copyright" content="Copyright (c) 2000-2005 by OpenBSD.ru">   
<title>OpenSSH: Использование аутентификации на базе публичного ключа</title>
</head>

<body bgcolor="#ffffff" text="#000000" link="#23238e">

<h2><font color="#e00000">OpenSSH: Использование аутентификации на базе публичного ключа</font></h2>
<hr>

<h3><font color="#0000e0">Мини-руководство "шаг за шагом"</font></h3>

<p>
<table border=0>
<tr><td nowrap bgcolor="#EEEEEE">

<blockquote><pre>
Генерируем пару ключей (секретный и публичный):

% <strong>ssh-keygen -t rsa</strong>
Generating public/private rsa key pair.
Enter file in which to save the key (/home/andrushock/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/andrushock/.ssh/id_rsa.
Your public key has been saved in /home/andrushock/.ssh/id_rsa.pub.
The key fingerprint is:
25:95:5b:a6:d7:26:b6:f5:f9:a7:49:d4:a8:2a:0d:7d andrushock@midian

Проверяем наличие ключей и корректность прав доступа:

% <strong>ls -l .ssh/id_*</strong>
-rw-------  1 andrushock  wsrc  1743 Jun 11 03:35 /home/andrushock/.ssh/id_rsa
-rw-r--r--  1 andrushock  wsrc   413 Jun 11 03:35 /home/andrushock/.ssh/id_rsa.pub

В случае, если файл .ssh/authorized_keys на удаленной системе не существует:

% <strong>cat .ssh/id_rsa.pub | ssh remotehost "(mkdir -m 700 .ssh; cat > .ssh/authorized_keys)"</strong>

Иначе:

% <strong>cat .ssh/id_rsa.pub | ssh remotehost "cat >> .ssh/authorized_keys"</strong>

Для сохранения парольных фраз к приватным ключам запускаем ssh-agent(1):

% <strong>eval `/usr/bin/ssh-agent`</strong>
Agent pid 3855

С помощью ssh-add(1) добавляем в память агента парольную фразу от нашего ключа:

% <strong>ssh-add</strong>
Enter passphrase for /home/andrushock/.ssh/id_rsa:
Identity added: /home/andrushock/.ssh/id_rsa (/home/andrushock/.ssh/id_rsa)

Для проверки просматриваем отпечаток секретного ключа:

% <strong>ssh-add -l</strong>
2048 25:95:5b:a6:d7:26:b6:f5:f9:a7:49:d4:a8:2a:0d:7d /home/andrushock/.ssh/id_rsa (RSA)

Выполняем вход на удаленный сервер без ввода пароля и парольной фразы:

% <strong>ssh remotehost</strong>


Пример функции оболочки для упрощения безпарольной аутентификации:

% <strong>vi .kshrc</strong>
ag () {
	if [ -z "$SSH_AGENT_PID" ]; then
		eval `/usr/bin/ssh-agent`
		ssh-add
	else
		echo 'ssh-agent already running'
	fi
}

Пример завершения работы агента при выходе из оболочки:

% <strong>vi .profile</strong>
trap '
	if [ -n "$SSH_AGENT_PID" ]; then
		ssh-add -D
		eval `/usr/bin/ssh-agent -k`
		unset SSH_AUTH_SOCK
		unset SSH_AGENT_PID
	fi
' 0
</blockquote></pre>

</td></tr>
</table>

<p>
<hr>
<a href="index.html"><img height=24 width=24 src="../../images/back.gif" border=0 alt="OpenBSD.ru"></a>
<a href="mailto:www@openbsd.ru">www@openbsd.ru</a>
<br>
<small>$RuOBSD: ssh-pubkey.html,v 1.6 2005/10/15 23:04:34 andrey Exp $</small>

</body>
</html>
