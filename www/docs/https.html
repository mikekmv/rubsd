<!--#set var="DOC_TITLE" value="Создаем SSL-сертификат для Apache" -->
<!--#include virtual="doc_header.html" -->

<p>Для поддержки https необходимо создать RSA сертификат.</p>

<table border="0" width="600" align="center" cellpadding="15" cellspacing="0">
<tr><td nowrap bgcolor="#EEEEEE">
<pre>
# openssl genrsa -out /etc/ssl/private/server.key 1024
</pre>
</td></tr>
</table>

<p>Если вы хотите чтобы ключ был зашифрован паролем, который прийдется вводить
каждый раз при запуске httpd, сгенерируйте ключ, включив одну из следующих опций,
задающих алгоритм шифрования: <font color="#00a000">des</font>,
<font color="#00a000">des3</font>.</p>

<table border="0" width="600" align="center" cellpadding="15" cellspacing="0">
<tr><td nowrap bgcolor="#EEEEEE">
<pre>
# openssl genrsa -des3 -out /etc/ssl/private/server.key 1024
</pre>
</td></tr>
</table>

<p>Теперь cгенерируем <font color="#00a000">CSR</font> (Certificate Signing
Request) для подписи нашего сертификата:</p>

<table border="0" width="600" align="center" cellpadding="15" cellspacing="0">
<tr><td nowrap bgcolor="#EEEEEE">
<pre>
# openssl req -new -key /etc/ssl/private/server.key \
	-out /etc/ssl/private/server.csr
</pre>
</td></tr>
</table>

<p>Обратите внимание на запрос <strong>Common Name</strong>, тут вы должны
указать точное имя сервера без http://. Например: <b>www.server.ru</b></p>

<p>Затем, вы можете отдать файл <font color="#00a000">server.csr</font> в
Certifying Authority, где подпишут ваш ключ. Один из таких CA - Thawte
Certification доступный по адресу <a href="http://www.thawte.com">
http://www.thawte.com/</a>. На текущий момент они подписывают только RSA
ключи.

<p>Вы так же, можете подписать ключ самостоятельно. Подпишем ключ на 1 год
(365 дней):</p>

<table border="0" width="600" align="center" cellpadding="15" cellspacing="0">
<tr><td nowrap bgcolor="#EEEEEE">
<pre>
# openssl x509 -req -days 365 -in /etc/ssl/private/server.csr \
	-signkey /etc/ssl/private/server.key -out /etc/ssl/server.crt
</pre>
</td></tr>
</table>

<p>Когда <font color="#00a000">/etc/ssl/server.crt</font> и
<font color="#00a000">/etc/ssl/private/server.key</font> готовы, вы можете
запустить httpd с флагом <strong>-DSSL</strong> или же используя
<strong>apachectl startssl</strong>, который заставит httpd включить поддержку
https.</p>

<p>Проверим.<br> Для этого зайдем любым броузером поддерживающим
<strong>SSL</strong> на https://www.server.ru или с помощью команды:</p>

<table border="0" width="600" align="center" cellpadding="15" cellspacing="0">
<tr><td nowrap bgcolor="#EEEEEE">
<pre>
# openssl s_client -connect www.server.ru:443 -state -debug
</pre>
</td></tr>
</table>

<p>Не забудьте включить флаг <strong>-DSSL</strong> в поле httpd_flags
в файле /etc/rc.conf, для постоянного запуска httpd с поддержкой SSL.</p>

<p>Вы можете самостоятельно подписать ключ, например для проверки
работоспособности вашего сервера, даже если собираетесь использовать
сертификат подписанный другим Certifying Authority. И как только, Certifying
Authority подписал вам сертификат, вы можете начать использовать его, заменив
ваш самостоятельно подписанный <font color="#00a000">/etc/ssl/server.crt</font>
на сертификат, подписанный вашим Certifying Authority, и затем перезапустить
httpd(8).</p>

<p><hr>
<a href="index.html"><img height="24" width="24" src="../images/back.gif"
border="0" alt="OpenBSD.ru"></a>
<a href="mailto:www@openbsd.ru">www@openbsd.ru</a><br>
<small>$RuOBSD: https.html,v 1.4 2001/11/03 17:59:44 dfa Exp $</small>

</body>
</html>
