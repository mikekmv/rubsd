<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=koi8-r">
  <meta http-equiv="Content-Language" content="ru">
  <meta name="copyright" content="Copyright (c) 2006 by OpenBSD.ru">
  <title>Описание переменных sysctl</title>
</head>

<body bgcolor="#ffffff" text="#000000" link="#23238e">

<h2><font color="#e00000">Описание переменных sysctl</font></h2>
<hr>

<ul type="disc">
<li><u><code>kern.maxfiles</code></u>

<p>
Переменная kern.maxfiles определяет максимальное число дескрипторов файлов.
Каждый открытый файл, сокет или буфер использует дескриптор файла. Нагруженному
серверу может понадобиться много тысяч дескрипторов файлов, в зависимости от
количества программ, одновременно выполняемых на сервере. Стандартное значение
kern.maxfile определяется переменной maxusers в файле конфигурации ядра.
Посмотреть значение можно, выполнив команду sysctl kern.maxfiles. Посмотреть
количество открытых файлов можно также через sysctl kern.nfiles, если это
значение достаточно близко подобралось к максимальному, стоит повысить
kern.maxfiles.

<li><u><code>kern.somaxconn</code></u>
<li><u><code>kern.sominconn</code></u>

<p>
Переменная sysctl kern.somaxconn ограничивает размер очереди для приема новых
TCP соединений. Значение по умолчанию(128) мало для нагруженного сервера,
поэтому при необходимости его стоит увеличить.

<li><u><code>kern.maxclusters</code></u>
<p>
Ограничивает количество mbuf доступных машине. Каждый кластер представлен 2 Kb
памяти. Посмотреть количество сетевых кластеров можно с помощью netstat -m.
Если пиковое значение близко к максимальному, его стоит сменить. Расчитать
примерное значение можно, исходя из количества соединений и буферов
приема/отправки. К примеру, если сервер может обслуживать 1000 одновременных
соединений, и каждое соединение "съедает" 16 Kb буфера приема и 16 Kb буфера
отправки, понадобиться 32 Mb памяти под буферы. Хорошее правило умножать данное
значение на 2, тогда <code>kern.maxclusters=2*32Mb/2kb=32768</code>

<li><u><code>kern.maxvnodes</code></u>

<p>
Максимальное число vnode для кеширования дисковых операций, текущее значение
можно посмотреть через kern.numvnodes.

<li><u><code>kern.maxproc</code></u>

<p>
Максимально допустимое число одновременнозапущенных процессов. Текущее
количество запущенных процессов можно узнать через kern.nprocs.

<li><u><code>net.inet.ip.forwarding</code></u>

<p>
Если необходимо форвадить пакеты между интерфейсами, поставить 1.

<li><u><code>net.inet.tcp.sendspace</code></u>
<li><u><code>net.inet.udp.sendspace</code></u>
<li><u><code>net.inet.tcp.recvspace</code></u>
<li><u><code>net.inet.udp.recvspace</code></u>

<p>
На размер буфера приема и передачи TCP напрямую влияет параметр размера TCP
окна. Увеличенный размер окна позволит более эффективно передавать данные,
особенно при интенсивной передаче, такой как FTP и HTTP. Значение по умолчанию
не является оптимальным и должно быть увеличено до 32768 байт. Это значение не
должно быть более 64 Кб, если вы не знаете об ограничениях RFC1323 и RFC2018,
и если нет поддержки с обеих сторон.

<li><u><code>net.inet.ip.sourceroute</code></u>

<p>
С помощью маршрутизации отправителя атакующий может попытаться достигнуть
внутренние IP адреса, включая адреса RFC1918. Важно не включать принятие
пакетов маршрутизации отправителя для предотвращения незаметных проб вашей
внутренней сети.

<li><u><code>net.inet.icmp.bmcastecho</code></u>

<p>
Эти атаки работают с помощью отправки сообщения ICMP 8 0 (запрос ECHO) на
широковещательный адрес с фальшивого адреса. Некоторые стеки IP ответят по
умолчанию на такие сообщения. В идеале лучше отключить данную опцию.

<li><u><code>net.inet.ip.redirect</code></u>

<p>
Атакующий может использовать IP redirect для изменения таблицы марщрутизации
на удаленном хосте. В хорошо разработанной сети редиректы на конечные станции
не должны требоваться.

<li><u><code>net.inet.icmp.maskrepl</code></u>

<p>
Существуют 2 вида проб. Запрос маски адреса может быть использован для
определения размера блока сети и установки диапазона для дальнейших проб.
Широковещательный запрос временного штампа (timestamp) одно из средств
выявления хостов и определения их операционных систем (fingerprinting).

<li><u><code>net.inet.icmp.errppslimit</code></u>
<li><u><code>tcp.rstppslimit</code></u>

<p>
Задает максимальное количество исходящих ICMP-error и TCP RST пакетов. Она
помогает уменьшить урон от атак, при которых генерируется большое количество
ответных пакетов.

<li><u><code>net.inet.ip.ttl</code></u>

<p>
Задает значение Time-to-Live.

<li><u><code>net.inet.ip.portfirst</code></u>
<li><u><code>net.inet.ip.portlast</code></u>

<p>Границы диапазона распределения портов TCP/UDP, которые могут быть
использованы процессами и программами, запущенными обыным пользователем.
Должны находиться в диапазоне 1024-49152.

<li><u><code>net.inet.ip.porthifirst</code></u>
<li><u><code>net.inet.ip.porthilast</code></u>

<p>
Границы диапазона распределения динамическмх портов TCP/UDP, которые могут быть
использованы процессами и программами, запущенными обыным пользователем. Должны
находиться в диапазоне 49152-65535.

<li><u><code>net.inet.ip.maxqueue</code></u>

<p>
Устанавливает маскимальное число нетранслируемых IP фрагментов в фрагменте
очереди.

<li><u><code>kern.shminfo</code></u>

<ul>
<p>
<li><u><code>kern.shminfo.shmmax</code></u>
<p>
Наибольший допустимый размер сегмента разделяемой памяти(в байтах)

<li><u><code>kern.shminfo.shmmni</code></u>
<p>
Максимальное количество сегментов разделяемой памяти для системы.

<li><u><code>kern.shminfo.shmseg</code></u>

<p>
Максимальное количество сегментов разделяемой памяти на процесс.

<li><u><code>kern.shminfo.shmall</code></u>

<p>
Общее количество разделяемой памяти, которое может быть использовано
(в страницах оперативной памяти).
</ul>

<p>
Настройки разделяемой памяти стоит трогать в случае работы с SQUID. SQUID
использует по одной области разделяемой памяти для каждой cachedir. Значения
kern.shminfo.shmmni должно быть равно или больше количества cachedir,
kern.shminfo.shmmax больше либо равно размеру cashedir и kern.shminfo.shmall
должно быть не меньше kern.shminfo.shmmni, умноженной на kern.shminfo.shmmax.

<li><u><code>kern.seminfo</code></u>

<ul>
<p>
<li><u><code>kern.seminfo.semmni</code></u>
<p>
Число идентификаторов семафоров в системе. Определяет максимальное число
семафоров.

<li><u><code>kern.seminfo.semmns</code></u>

<p>
Число семафоров в системе. Каждый серверный процесс требует один семафор.

<li><u><code>kern.seminfo.semmnu</code></u>
<p>
Число undo-структур, которые используются для восстановления структур данных
семафоров при гибели процесса. Выставляется в максимальное число одновременных
процессов в статусе runnable в системе.

<li><u><code>kern.seminfo.semmsl</code></u>

<p>
Максимальное число семафоров, разрешенное системой в пределах одного набора
семафоров.
</ul>

<p>
Посмотреть текущие наборы семафоров в системе можно с помощью ipcs.

<p>
<hr>
<a href="index.html"><img src="images/back.gif" alt="OpenBSD.ru" border="0" height="24" width="24"></a>
<a href="mailto:www@openbsd.ru">www@openbsd.ru</a>
<br>
<small>$RuOBSD$</small>

</body>
</html>
