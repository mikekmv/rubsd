<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=koi8-r">
  <meta http-equiv="Content-Language" content="ru">
  <meta name="copyright" content="Copyright (c) 2006 by OpenBSD.ru">
  <title>Описание переменных sysctl</title>
</head>

<body bgcolor="#ffffff" text="#000000" link="#23238e">

<h2><font color="#e00000">Описание переменных sysctl</font></h2>
<hr>

<p>
Значения некоторых параметров ядра, влияющих на работу его подсистем возможно
изменять из контекста суперпользователя во время работы системы.
Механизмом, реализующим доступ к переменным ядра в OpenBSD, является
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=3">sysctl(3)</a>.
Команда непосредственного управления -
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a>.
Она способна как распечатывать текущие значения параметров, так и выставлять их.

<h3><font color="#0000e0">Лимиты на системные ресурсы</font></h3>

<ul type="disc">
<li><u><tt>kern.maxfiles</tt></u>

<p>
Переменная <tt>kern.maxfiles</tt> определяет максимальное число дескрипторов
файлов.
Каждый открытый файл, сокет или буфер использует дескриптор файла.
Нагруженному серверу может понадобиться много тысяч дескрипторов файлов, в
зависимости от количества программ, одновременно выполняемых на сервере.
Стандартное значение <tt>kern.maxfiles</tt> определяется переменной
<tt>maxusers</tt> в файле конфигурации ядра.
Посмотреть значение можно, выполнив команду <tt><b>sysctl
kern.maxfiles</b></tt>.
Посмотреть количество открытых файлов также можно с помощью <tt><b>sysctl
kern.nfiles</b></tt>, если это значение приблизилось к максимальному, стоит
увеличить <tt>kern.maxfiles</tt>.

<li><u><tt>kern.maxvnodes</tt></u>

<p>
Максимальное число vnode для кеширования дисковых операций. Текущее значение
можно посмотреть через <tt>kern.maxvnodes</tt>.

<li><u><tt>kern.maxproc</tt></u>

<p>
Максимально допустимое число одновременно запущенных процессов. Текущее
количество запущенных процессов можно узнать через <tt>kern.maxproc</tt>.
</ul>

<h3><font color="#0000e0">Параметры стека TCP/IP и другие сетевые
настройки</font></h3>

<ul type="disc">
<li><u><tt>kern.maxclusters</tt></u>

<p>
Ограничивает количество буферов
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mbuf&sektion=9">mbuf(9)</a>,
доступных машине. Каждый кластер представлен 2 Kb памяти.
Посмотреть количество сетевых кластеров можно с помощью <tt><b>netstat
-m</b></tt>.
Если пиковое значение близко к максимальному, его стоит изменить. Рассчитать
примерное значение можно, исходя из количества соединений и буферов
приема/отправки. К примеру, если сервер может обслуживать 1000 одновременных
соединений, и каждое соединение "съедает" 16 Kb буфера приема и 16 Kb буфера
отправки, понадобится 32 Mb памяти под буферы. Хорошее правило: умножать данное
значение на 2, тогда формула подсчета будет выглядеть следующим образом:
<tt>kern.maxclusters = 2 * 32Mb / 2Kb = 32768</tt>

<li><u><tt>kern.somaxconn</tt></u>
<li><u><tt>kern.sominconn</tt></u>

<p>
Переменная <tt>kern.somaxconn</tt> ограничивает размер очереди для приема
новых TCP-соединений. Значение по умолчанию (128) невелико для нагруженного
сервера, поэтому при необходимости его стоит увеличить.

<li><u><tt>net.inet.ip.forwarding</tt></u>

<p>
Если необходимо выполнять перенаправление IPv4-пакетов между сетевыми
интерфейсами, установите значение, равным 1 (необходимо для работы системы
в качестве маршрутизатора).

<li><u><tt>net.inet.ip.maxqueue</tt></u>

<p>
Устанавливает максимальное число нетранслируемых IP-фрагментов в фрагменте
очереди.

<li><u><tt>net.inet.ip.ttl</tt></u>

<p>
Задает значение поля TTL (Time To Live) IP пакетов.

<li><u><tt>net.inet.ip.redirect</tt></u>

<p>
Атакующий может использовать IP redirect для изменения таблицы маршрутизации
на удаленном хосте. Значение 0 позволит игнорировать подобные пакеты.

<li><u><tt>net.inet.ip.sourceroute</tt></u>

<p>
С помощью маршрутизации отправителя атакующий может попытаться достигнуть
внутренние IP-адреса, включая адреса RFC1918. Важно не включать принятие
пакетов маршрутизации отправителя для предотвращения незаметных проб вашей
внутренней сети.

<li><u><tt>net.inet.icmp.bmcastecho</tt></u>

<p>
Эти атаки работают с помощью отправки ECHO-запроса на широковещательный адрес
с фальшивого адреса. По умолчанию некоторые стеки TCP/IP отвечают на такие
сообщения. Нет необходимости включать эту опцию.

<li><u><tt>net.inet.icmp.maskrepl</tt></u>

<p>
Существуют 2 вида проб. Запрос маски адреса может быть использован для
определения размера блока сети и установки диапазона для дальнейших проб.
Широковещательный запрос временного штампа (timestamp) - одно из средств
выявления хостов и определения операционных систем (fingerprinting).

<li><u><tt>net.inet.icmp.errppslimit</tt></u>
<li><u><tt>net.inet.tcp.rstppslimit</tt></u>

<p>
Задает максимальное количество исходящих ICMP-error и TCP RST пакетов.
Данные переменные могут помочь снизить урон от сетевых атак, когда
генерируется большое количество ответных пакетов.

<li><u><tt>net.inet.tcp.sendspace</tt></u>
<li><u><tt>net.inet.udp.sendspace</tt></u>
<li><u><tt>net.inet.tcp.recvspace</tt></u>
<li><u><tt>net.inet.udp.recvspace</tt></u>

<p>
На размер буфера приема и передачи TCP напрямую влияет параметр размера окна TCP.
Увеличенный размер окна позволит более эффективно передавать данные, особенно
при интенсивной передаче, такой как FTP и HTTP. Значение по умолчанию не
является оптимальным и может быть увеличено до 32768 байт. Это значение не
должно быть более 64 Кб, если вы не знаете об ограничениях RFC1323 и RFC2018,
и если нет поддержки с обеих сторон.

<li><u><tt>net.inet.tcp.baddynamic</tt></u>

<p>
Список зарезервированны TCP портов. Порты с этими номерами не будут
использованы ядром в качестве портов для исходящих соединений. Это может
быть полезно, если используются непривелигерованные процессы, прослушивающие
определенные порты с номерами выше 1024. Для того, чтобы добавить номер порта
в список необходимо выполнить команду <tt><b>sysctl
net.inet.tcp.baddynamic=+52000</b></tt>, а чтобы удалить: <tt><b>sysctl
net.inet.tcp.baddynamic=-52000</b></tt>.

</ul>

<h3><font color="#0000e0">Лимиты средств межпроцессного взаимодействия
в стиле UNIX System V</font></h3>

<p>
Посмотреть информацию о используемых средствах System V IPC можно с
помощью программы
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipcs&sektion=1">ipcs(1)</a>.

<ul type="disc">
<li><u><tt>kern.shminfo</tt></u>
<p>
Иерархия переменных, относящихся к разделяемой памяти.

<ul>
<p>
<li><u><tt>kern.shminfo.shmmax</tt></u>

<p>
Наибольший допустимый размер сегмента разделяемой памяти (в байтах).

<li><u><tt>kern.shminfo.shmmni</tt></u>

<p>
Максимальное количество сегментов разделяемой памяти для системы.

<li><u><tt>kern.shminfo.shmseg</tt></u>

<p>
Максимальное количество сегментов разделяемой памяти на процесс.

<li><u><tt>kern.shminfo.shmall</tt></u>

<p>
Общее количество разделяемой памяти, которое может быть использовано
(в страницах оперативной памяти).

</ul>

<p>
Настройки разделяемой памяти стоит изменять только в случае работы с прокси
сервером Squid, который использует по одной области разделяемой памяти для
каждой cachedir. Значение <tt>kern.shminfo.shmmni</tt> должно быть равно
или больше количества <tt>cachedir</tt>, <tt>kern.shminfo.shmmax</tt>
больше либо равно размеру <tt>cachedir</tt> и <tt>kern.shminfo.shmall</tt>
должно быть не меньше <tt>kern.shminfo.shmmni</tt>, умноженной на
<tt>kern.shminfo.shmmax</tt>.

<li><u><tt>kern.seminfo</tt></u>
<p>
Иерархия переменных, относящихся к семафорам

<ul>
<p>
<li><u><tt>kern.seminfo.semmni</tt></u>

<p>
Число идентификаторов семафоров в системе. Определяет максимальное число
семафоров.

<li><u><tt>kern.seminfo.semmns</tt></u>

<p>
Число семафоров в системе. Каждый серверный процесс требует один семафор.

<li><u><tt>kern.seminfo.semmnu</tt></u>

<p>
Число undo-структур, которые используются для восстановления структур данных
семафоров при гибели процесса. Выставляется в максимальное число одновременных
процессов в статусе runnable в системе.

<li><u><tt>kern.seminfo.semmsl</tt></u>

<p>
Максимальное число семафоров, разрешенное системой в пределах одного набора
семафоров.

</ul>

</ul>

<p>
<hr>
<a href="index.html"><img src="images/back.gif" alt="OpenBSD.ru" border="0" height="24" width="24"></a>
<a href="mailto:www@openbsd.ru">www@openbsd.ru</a>
<br>
<small>$RuOBSD: howto-sysctl.html,v 1.4 2006/02/06 21:04:33 mkb Exp $</small>

</body>
</html>
