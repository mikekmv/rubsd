<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=koi8-r">
<meta http-equiv="Content-Language" content="ru">
<meta name="copyright" content="Copyright (c) 2000-2002 by OpenBSD.ru">
<title>Русификация OpenBSD</title>
</head>

<body bgcolor="#ffffff" text="#000000" link="#23238e">

<h2><font color="#e00000">Русификация OpenBSD</font></h2>
"Ибо без русификации читать кириллицу невозможно." Лебедев.
<hr>

<h4>Русификация OpenBSD</h4>

<ul>
  <li><a href="#wscons">Русификация wscons консоли</a>
  <li><a href="#pcvt">Русификация PCVT консоли</a> (OpenBSD 2.8 и ранние)
  <li><a href="#xwindow">Русификация X Window</a>
</ul>

<h4>Русификация программ</h4>

<ul>
  <li><a href="#freeciv">Freeciv</a>
  <li><a href="#fvwm">Fvwm</a> (Fvwm2, Fvwm95)
  <li><a href="#gqmpeg">GQmpeg</a>
  <li><a href="#gtk">GTK приложений</a> (GIMP, Sylpheed, X-Chat и т.д.)
  <li><a href="#LaTeX">LaTeX</a>
  <li><a href="#majordomo">Majordomo</a>
  <li><a href="#mg">Mg</a>
  <li><a href="#netscape">Netscape</a>
  <li><a href="#readline">Readline приложений</a> (bash, mysql, psql, smbclient и т.д.)
  <li><a href="#samba">Samba</a>
  <li><a href="#talk">Talk</a>
  <li><a href="#twm">TWM - Tab Window Manager</a>
  <li><a href="#nvi">Vi/Ex</a>
</ul>

<hr>

<h3><font color="#e00000">Русификация OpenBSD</font></h3>

<h4><font color="#0000e0"><a name="wscons">Русификация wscons</a></font></h4>

<p>
Начиная с OpenBSD 2.9, драйвер консоли pcvt(4) был удалён из системы,
в пользу нового драйвера wscons(4).

<h5>Раскладка клавиатуры</h5>

<p>
Русская раскладка была добавлена после выхода 2.9, поэтому для набора
текста в 2.9, вам необходим <a href="../files/koi8-map.sh">этот скрипт</a>
(пример его использования см. ниже). В случае если у вас OpenBSD 3.0 или
новее, добавьте в файл <code>/etc/kbdtype</code> раскладку вашей клавиатуры.
Если вы указали тип раскладки при установке системы раскладка уже должна
стоять правильно.

<pre>
	# <b>echo "ru" > /etc/kbdtype</b>
</pre>

<p>
альтернативный (файлу <code>/etc/kbdtype</code>) вариант - раскомментировать
следующею строку в <code>/etc/wsconsctl.conf</code>:

<pre>
	keyboard.encoding=ru
</pre>

<p>
Набор русского текста происходит так же, как и в pcvt(4) консоли - зажимая
правый Alt. Для реализации т.н. sticky переключателя (фиксированного) доступен
<a href="http://violent.death.kiev.ua/soft.html">патч и краткое руководство по установке</a>.
Начиная с версии 3.0, такой переключатель интегрирован в OpenBSD.

<h5>Отображение кириллицы</h5>

<p>
Для отображения кириллицы необходимо загрузить шрифт и настроить
экраны (консоли).

<p>
На экранах созданных ядром кириллица отображаться не будет. Необходимо:

<ul>
  <li>либо пересобрать ядро с меньшим числом экранов по умолчанию
  (<small>option WSDISPLAY_DEFAULTSCREENS=6</small>), загрузить шрифт и
  создать новые
  <li>либо удалить созданные по умолчанию экраны, загрузить шрифт и
  создать их заново
</ul>

<p>
Экран ttyC0 создаётся всегда и не может быть удалён, поэтому не может
отображать кириллицу.

<p>
Итак, если мы создаём <strong>custom</strong> ядро, необходимые в ядре опции
(оставляем по умолчанию два экрана, на которых не будет видно кириллицы):

<pre>
	option WSDISPLAY_COMPAT_USL
	option WSDISPLAY_COMPAT_RAWKBD
	option WSDISPLAY_COMPAT_PCVT
	option WSDISPLAY_DEFAULTSCREENS=2
</pre>

<p>
Исходя из количества экранов по умолчанию, в данном случае два, добавляем
в <code>/etc/rc.local</code> следующие строки, в зависимости от версии OpenBSD,
для создания трёх дополнительных экранов с предварительно загруженным русским
шрифтом. Не забудьте запустить дополнительные процессы getty(8), если нужны,
на этих экранах, см. ttys(5).

<p>
Для OpenBSD 2.9:

<pre>
	if [ -x /usr/sbin/wsconscfg -a -x /usr/sbin/wsfontload ]; then
		# загружаем русский koi8 шрифт
		/usr/sbin/wsfontload -h 16 /usr/share/misc/pcvtfonts/koi8-8x16

		for SCREEN in 2 3 4; do
		#	удаляем экраны созданные по умолчанию (для GENERIC)
		#	/usr/sbin/wsconscfg -d $SCREEN
			/usr/sbin/wsconscfg -t 80x25bf -e vt100 $SCREEN
		done

		# загружаем раскладку с переключателем
		/bin/sh /path/to/koi8-map.sh > /dev/null
	fi
</pre>

<p>
Для OpenBSD 3.0 и новее:

<pre>
	if [ -x /usr/sbin/wsconscfg -a -x /usr/sbin/wsfontload ]; then
		# загружаем русский koi8 шрифт
		/usr/sbin/wsfontload -h 16 /usr/share/misc/pcvtfonts/koi8-r-8x16
		# или украинский koi8 шрифт
		# /usr/sbin/wsfontload -h 16 /usr/share/misc/pcvtfonts/koi8-u-8x16

		for SCREEN in 2 3 4; do
		#	удаляем экраны созданные по умолчанию (для GENERIC)
		#	/usr/sbin/wsconscfg -d $SCREEN
			/usr/sbin/wsconscfg -t 80x25bf -e vt100 $SCREEN
		done

		# создаем фиксированный переключатель на правом ctrl
		/sbin/wsconsctl -w keyboard.map+="keycode 157 = Mode_Lock" > /dev/null
		# а если вы привыкли пользоваться обычным переключателем - правый Alt
		/sbin/wsconsctl -w keyboard.map+="keycode 184 = Mode_switch" > /dev/null
	fi
</pre>

<h4><font color="#0000e0"><a name="pcvt">Русификация PCVT консоли</a></font></h4>

<p>
Версии OpenBSD 2.8 и ниже, содержат три различных русских шрифта в кодировке
koi8-r для русификации PCVT консоли: koi8-8x16, koi8-8x14 и koi8-8x8. Эти
шрифты могут быть загружены в знакогенератор EGA/VGA адаптера для
использования в различных видеорежимах:

<p>
<table align="center" border="1" width="400" cellpadding="2" cellspacing="0">
<tr>
  <td bgcolor="#EEEEEE" align="center">Шрифт</td>
  <td bgcolor="#EEEEEE" align="center">Число строк<br>EGA</td>
  <td bgcolor="#EEEEEE" align="center">Число строк<br>VGA</td>
</tr>
<tr>
  <td align="center">koi8-8x8</td>
  <td align="center">43</td>
  <td align="center">50</td>
</tr>
<tr>
  <td align="center">koi8-8x14</td>
  <td align="center">25</td>
  <td align="center">28</td>
</tr>
<tr>
  <td align="center">koi8-8x16</td>
  <td align="center">-</td>
  <td align="center">25</td>
</tr>
</table>

<p>
Для русификации консоли:

<ol>
<li>Убедитесь, что система собрана с драйвером PCVT. Файл конфигурации ядра
должен содержать следующую строчку:

<pre>
vt0 at isa? port 0x60 irq 1
</pre>


<li>Добавьте в <code>/etc/rc.local</code> команды загрузки шрифтов:

<pre>
if [ -x /usr/sbin/ispcvt ] && /usr/sbin/ispcvt; then
	/usr/sbin/loadfont -c0 -f/usr/share/misc/pcvtfonts/koi8-r-8x16
	/usr/sbin/loadfont -c1 -f/usr/share/misc/pcvtfonts/koi8-r-8x14
	/usr/sbin/loadfont -c2 -f/usr/share/misc/pcvtfonts/koi8-r-8x8
	/usr/sbin/kcon -m koi8
	/usr/sbin/scon -o

	# Следующие строчки нужны только для OpenBSD 2.5 и более ранних версий
	# for t in /dev/ttyC[0-7]; do
	# 	echo -n '\033/X' &gt; ${t}
	# done
fi
</pre>

</ol>

<p>
После выполнения данных действий, на консоли можно будет нормально читать
русский текст в кодировке koi8-r. Однако набор русского текста превратится
в этакое упражнение по машинописи, чтобы набрать букву &quot;ф&quot;
придётся нажать LeftAlt-A, &quot;Ф&quot; - Shift-LeftAlt-A,
&quot;ы&quot; - LeftAlt-S и т.д. На
<a href="http://violent.death.kiev.ua/soft.html">домашней странице</a> Игоря
Грабина находится патч, позволяющий создать фиксированный переключатель.

<h4><font color="#0000e0"><a name="xwindow">Русификация X Window</a></font></h4>

<p>
В файл конфигурации X Window (<code>/etc/X11/XF86Config</code> для XF4
или <code>/etc/XF86Config</code> для X11) в раздел
<strong>Section &quot;Files&quot;</strong> добавьте следующую строчку,
<u>перед</u> ранее написанными директивами <strong>FontPath</strong>:

<pre>
	FontPath "/usr/X11R6/lib/X11/fonts/cyrillic/"
</pre>

<p>
После рестарта X Window, вы сможете читать тексты на русском языке в
кодировке koi8-r. Для ранних версий X Window, вам может понадобится
установить дополнительные шрифты, для этого создан порт <a href="http://www.openbsd.org/cgi-bin/cvsweb/ports/russian/xcyrillic/">xcyrillic</a>.
Для русификации клавиатуры можно настроить XKB, либо воспользоваться
<a href="http://www.openbsd.org/cgi-bin/cvsweb/ports/russian/xruskb/">xruskb</a>.

<h4>Настройка XKB</h4>

<p>
Для того, чтобы настроить XKB:

<p>
В XFree86 3.x, необходимо добавить следующие строки в секцию
<strong>Keyboard</strong> файла <code>/etc/XF86Config</code>:

<pre>
	XkbKeycodes     "xfree86"
	XkbSymbols      "us(pc101)"
	XkbGeometry     "pc"
	XkbRules        "xfree86"
	XkbModel        "pc104"
	XkbLayout       "ru"
	XkbOptions      "grp:ctrl_shift_toggle"
</pre>

<p>
В XFree86 4.x, необходимо добавить следующие строки в секцию
<strong>InputDevice</strong> файла <code>/etc/X11/XF86Config</code>:

<pre>
	Option	"XkbRules"   "xfree86"
	Option	"XkbModel"   "pc101"
	Option	"XkbLayout"  "ru"
	Option	"XkbOptions" "grp_led:scroll,grp:ctrl_shift_toggle"
</pre>

<p>
Эти настройки можно сделать в удобной графической утилите <code>xf86cfg</code>
в разделе <strong>Keyboard</strong>.

<p>
В данных примерах переключателем режимов является комбинация клавиш Ctrl+Shift.
Теперь чтобы увидеть вводимые Вами символы, необходимо эти символы определить,
так как X Window ничего не знает о символах кириллицы. Для этого необходимо
загрузить соответствующую раскладку с помощью xmodmap. Пример такой раскладки
можно найти <a href="../files/Xmodmap">здесь</a> или
<a href="ftp://ftp.kiarchive.ru/pub/cyrillic/x11/Xmodmap">здесь</a>.</P>


<p>
Загрузка раскладки происходит по-умолчанию из файла <code>~/.Xmodmap</code> при
запуске startx. Если вы используете XDM, добавьте следующую команду в файл
<code>~/.xsession</code>:

<pre>
	[ -x /usr/X11R6/bin/xmodmap ] && /usr/X11R6/bin/xmodmap ~/.Xmodmap
</pre>

<p>
Более подробную информацию по настройке XKB можно получить
<a href="http://www.tsu.ru/~pascal/other/xkb">здесь</a>.

<h4>Установка xruskb</h4>

Установите порт <a href="http://www.openbsd.org/cgi-bin/cvsweb/ports/russian/xruskb/">xruskb</a>.
Добавьте в <code>~/.xinitrc</code> или <code>~/.xsession</code> следующую
команду:

<pre>
	[ -x /usr/local/bin/xrus ] && xrus jcuken-koi8.xmm
</pre>

<h3><font color="#e00000"><a name="programs">Русификация программ</a></font></h3>

<h4><font color="#0000e0"><a name="freeciv">Freeciv</a></font></h4>

<p>
Для того, чтобы изменить шрифт в freeciv (xaw версии) для русских сообщений,
необходимо добавить следующую строку в файл <code>~/.Xdefaults</code>

<pre>
	Freeciv*font: -cronyx-helvetica-medium-r-normal-*-12-*-*-*-*-*-koi8-r
</pre>

<h4><font color="#0000e0"><a name="fvwm">Fvwm (Fvwm2 и Fvwm95)</a></font></h4>

<p>
Чтобы включить поддержку русских букв в менеджерах семейства fvwm, нужно
указать шрифты &quot;cronyx&quot; в следующих строчках конфигурационного
файла (.fvwmrc, .fvwm2rc, .fvwm95rc):

<pre>
	WindowFont -cronyx-helvetica-bold-r-*-*-12-*-*-*-*-*-*-*
	MenuFont -cronyx-helvetica-medium-r-*-*-12-*-*-*-*-*-*-*
	*FvwmPagerFont -cronyx-helvetica-bold-r-*-*-10-*-*-*-*-*-*-*
	*FvwmButtonsFont -cronyx-helvetica-bold-r-*-*-10-*-*-*-*-*-*-*
	*MiniButtonsFont -cronyx-helvetica-bold-r-*-*-10-*-*-*-*-*-*-*
	*FvwmIdentFont -cronyx-helvetica-medium-r-*-*-12-*-*-*-*-*-*-*
	*FvwmWinListFont -cronyx-helvetica-bold-r-*-*-10-*-*-*-*-*-*-*
	*FvwmTaskBarFont -cronyx-helvetica-medium-r-*-*-*-120-*-*-*-*-*-*
	*FvwmTaskBarSelFont -cronyx-helvetica-bold-r-*-*-*-120-*-*-*-*-*-*
</pre>

<h4><font color="#0000e0"><a name="gqmpeg">GQmpeg</a></font></h4>

<p>
GQmpeg поддерживает перекодировку тегов (win1251 -&gt; koi8). Для
этого, его необходимо собрать с опцией <strong>--enable-russian</strong>.
Добавьте следующие строчки в файл <code>/etc/mk.conf</code> и
пересоберите GQmpeg из портов.

<pre>
	PORTSDIR?=      /usr/ports

	.if ${.CURDIR} == ${PORTSDIR}/audio/gqmpeg
	CONFIGURE_ARGS+=        --enable-russian
	.endif
</pre>

<p>
В разделе <a href="../files/">Файлы</a> доступны skin'ы с поддержкой
русских букв.

<h4><font color="#0000e0"><a name="gtk">Приложений на базе GTK</a></font></h4>

<p>
Все приложения на базе GTK (GIMP, Sylpheed, X-Chat и другие), можно
русифицировать, добавив в <code>~/.gtkrc</code> следующие строчки:

<pre>
	style "user-font"
	{
		font = "-cronyx-helvetica-*-r-normal-*-12-*-*-*-*-*-koi8-r"
	}

	widget_class "*" style "user-font"
</pre>

<h4><font color="#0000e0"><a name="LaTeX">LaTeX</a></font></h4>

<p>
Для того, чтобы документы могли содержать русские буквы, необходимо подключить
пакет русификации и указать кодировку в <i>преамбуле</i> документа. Например:

<pre>
	\documentclass{article}
	\usepackage[koi8-r]{inputenc}
	\usepackage[russian]{babel}
	\begin{document}
	\LaTeX~--- макропакет, позволяющий авторам верстать и печатать их работы
	с высоким типографским качеством, при помощи заранее определённых,
	профессиональных макетов.
	\end{document}
</pre>

<p>
Для того, чтобы активизировать переносы в русских словах запустите утилиту
<code>texconfig</code>, выберите раздел <strong>hyphenation</strong>,
далее <strong>latex</strong> и раскомментируйте строку:

<pre>
	russian ruhyphen.tex
</pre>

<h4><font color="#0000e0"><a name="majordomo">Majordomo</a></font></h4>

<p>
Под русификацией Majordomo мы подразумеваем приведение сообщений, отправляемых
Majordomo, в ответ на запросы к такому виду, чтобы почтовый клиент не строил
догадок относительно кодировки сообщения, а точно знал её. Патч, который можно
взять <a href="ftp://ftp.openbsd.ru/pub/OpenBSD/local/patches/majordomo-1.94.5-koi8.patch.gz">здесь</a>,
предназначен для Majordomo 1.94.5 и устанавливает кодировку сообщений в koi8-r.

<h4><font color="#0000e0"><a name="mg">Mg - emacs-like text editor</a></font></h4>

<p>
Чтобы заставить mg работать с русскими буквами, достаточно создать файл
<code>~/.mg</code>, содержащий строчку:

<pre>
	meta-key-mode
</pre>

<h4><font color="#0000e0"><a name="netscape">Netscape</a></font></h4>

<p>
Наибольшую проблему при русификации Netscape представляют кнопки и поля ввода.
К сожалению по-видимому не существует &quot;нормального&quot; способа решить
эту проблему, но кое что все же сделать можно:

<ol>
  <li>Прежде всего конечно следует 
  <a href="#xwindow">русифицировать X Window</a>.
  <li>Установите порт netscape (navigator или communicator).
  <li>Добавьте в файл <code>~/.Xdefaults</code> следующие строки:

  <pre>
Netscape*fontList: -cronyx-helvetica-medium-r-normal-*-14-*-*-*-*-*-koi8-r
Netscape*documentFonts.charset*iso8859-1: koi8-r
Netscape*toolBar*fontList: -cronyx-helvetica-medium-r-normal-*-14-*-*-*-*-*-koi8-r
  </pre>
</ol>

<p>
Остальные настройки производятся обычным способом, из меню
<strong>Edit/Preferences</strong>.

<h4><font color="#0000e0"><a name="readline">Readline приложений</a></font></h4>

<p>
Приложения на базе readline (bash, mysql, psql, smbclient и т.д.) могут
работать с русскими буквами. Для этого необходимо создать файл
<code>~/.inputrc</code>, содержащий следующие строки:

<pre>
	set convert-meta off
	set input-meta on
	set output-meta on
</pre>

<h4><font color="#0000e0"><a name="samba">Samba</a></font></h4>

<p>
Для того, чтобы Windows клиенты видели русские буквы, в файл
<code>/etc/samba/smb.conf</code> добавьте следующие строки:

<pre>
	[global]
		...
		client code page = 866
		character set = koi8-r
		...
</pre>

Для того, чтобы в <strong>smbclient</strong> можно было вводить
русские буквы, необходимо создать файл <code>~/.inputrc</code>,
как это описано в разделе посвящённом русификации
<a href="#readline">Readline</a> приложений.

<h4><font color="#0000e0"><a name="talk">Talk</a></font></h4>

<p>
Начиная с OpenBSD 2.9, в программе talk, появилась поддержка русских символов.
Другие, более старые версии talk не поддерживали русские символы. Для решения
этой проблемы была создана программа bazar. Программа оформлена в виде порта с
использованием файлов из <code>/usr/src/usr.bin/talk</code> от OpenBSD.
Загрузить порт bazar можно
<a href="ftp://ftp.openbsd.ru/pub/OpenBSD/local/ports/net/bazar/">отсюда</a>.

<p>
Программа bazar полностью совместима с talk, но содержит следующие дополнения:

<ul>
  <li>Добавлен скроллинг в окна
  <li>Поддерживаются русские символы
  <li>Добавлена возможность перекодировки koi8-r &lt;&gt; windows-1251
</ul>

<h4><font color="#0000e0"><a name="twm">Tab Window Manager</a></font></h4>

<p>
Для того, чтобы Menu, Title и IconManager в TWM писали по русски, необходимо
иметь следующие строчки в <code>~/.twmrc</code> (помимо остальной
конфигурации TWM). Пример настройки TWM можно посмотреть
<a href="../files/twmrc">тут</a>.

<pre>
	TitleFont "-cronyx-helvetica-medium-r-normal-*-12-*-*-*-*-*-koi8-r"
	MenuFont "-cronyx-helvetica-medium-r-normal-*-12-*-*-*-*-*-koi8-r"
	IconManagerFont "-cronyx-helvetica-medium-r-normal-*-12-*-*-*-*-*-koi8-r"
</pre>

<h4><font color="#0000e0"><a name="nvi">Vi/Ex</a></font></h4>

<p>
Стандартный дистрибутив OpenBSD содержит nvi/nex версию редакторов vi и ex.
Начиная с OpenBSD 2.9, в nvi/nex правильно отображаются русские буквы. Для
ранних версий OpenBSD, необходимо создать файл <code>~/.nexrc</code>,
содержащий следующие строки:

<pre>
	set print=абвгдежзийклмнопрстуфхцчшщыьъэюяАБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЫЬЪЭЮЯ
	set noprint=
</pre>

<p>
<hr>
<a href="index.html"><img height=24 width=24 src="../images/back.gif" border=0 alt="OpenBSD.ru"></a>
<a href="mailto:www@openbsd.ru">www@openbsd.ru</a>
<br>
<small>$RuOBSD: howto-cyrillic.html,v 1.68 2002/09/13 09:03:01 dfa Exp $</small>

</body>
</html>
