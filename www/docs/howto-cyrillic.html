<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=koi8-r">
<meta http-equiv="Content-Language" content="ru">
<meta name="copyright" content="Copyright (c) 2000-2005 by OpenBSD.ru">
<title>Русификация OpenBSD</title>
</head>

<body bgcolor="#ffffff" text="#000000" link="#23238e">

<h2><font color="#e00000">Русификация OpenBSD</font></h2>
"Ибо без русификации читать кириллицу невозможно." Лебедев.
<hr>

<h4>Русификация OpenBSD</h4>

<ul>
  <li><a href="#wscons">Русификация wscons консоли</a>
  <li><a href="#xwindow">Русификация X Window</a>
</ul>

<h4>Русификация программ</h4>

<ul>
  <li><a href="#freeciv">Freeciv</a>
  <li><a href="#fvwm">Fvwm</a> (Fvwm2, Fvwm95)
  <li><a href="#gqmpeg">GQmpeg</a>
  <li><a href="#gtk">GTK приложений</a> (GIMP, Sylpheed, X-Chat и т.д.)
  <li><a href="#LaTeX">LaTeX</a>
  <li><a href="#majordomo">Majordomo</a>
  <li><a href="#mg">Mg</a>
  <li><a href="#netscape">Netscape</a>
  <li><a href="#readline">Readline приложений</a> (bash, mysql, psql, smbclient и т.д.)
  <li><a href="#samba">Samba</a>
  <li><a href="#twm">TWM - Tab Window Manager</a>
</ul>

<hr>

<h2><font color="#e00000">Русификация OpenBSD</font></h2>

<h3><font color="#0000e0"><a name="wscons">Русификация wscons</a></font></h3>

<p>
Руссификация консоли происходит в две стадии: смены раскладки клавиатуры и
настройки русских шрифтов.

<h4><font color="#008000">Раскладка клавиатуры</font></h4>

<p>
Добавьте в файл <code>/etc/wsconsctl.conf</code> раскладку вашей клавиатуры.
Если вы указали тип раскладки при установке системы, раскладка уже должна
стоять правильно. Так же укажите тип переключателя раскладки.

<pre>
	keyboard.encoding=ru
	keyboard.map+="keycode 157 = Mode_Lock"
</pre>

<h4><font color="#008000">Отображение кириллицы</font></h4>

<p>
Для отображения кириллицы необходимо загрузить шрифт и настроить
экраны (консоли).

<p>
На экранах созданных ядром кириллица отображаться не будет. Необходимо:

<ul>
  <li>либо удалить созданные по умолчанию экраны, загрузить шрифт и
  создать их заново
  <li>либо пересобрать ядро с меньшим числом экранов по умолчанию
  (<code>option WSDISPLAY_DEFAULTSCREENS</code>), загрузить шрифт и
  создать новые
</ul>

<p>
Экран ttyC0 создаётся всегда и не может быть удалён, поэтому не может
отображать кириллицу.

<p>
Исходя из количества экранов по умолчанию, в данном случае два, добавляем
в <code>/etc/rc.local</code> следующие строки,
для создания трёх дополнительных экранов с предварительно загруженным русским
шрифтом. Не забудьте запустить дополнительные процессы getty(8), если нужны,
на этих экранах, см. ttys(5).

<pre>
	if [ -x /usr/sbin/wsconscfg -a -x /usr/sbin/wsfontload ]; then
		# загружаем русский koi8 шрифт
		wsfontload -h 16 /usr/share/misc/pcvtfonts/koi8-r-8x16
		# или украинский koi8 шрифт
		# wsfontload -h 16 /usr/share/misc/pcvtfonts/koi8-u-8x16

		for SCREEN in 2 3 5; do
		#	удаляем экраны созданные по умолчанию (для GENERIC)
			wsconscfg -d $SCREEN
			wsconscfg -t 80x25bf -e vt100 $SCREEN
		done
	fi
</pre>

<h3><font color="#0000e0"><a name="xwindow">Русификация X Window</a></font></h3>

<p>
В файл конфигурации X Window (<code>/etc/X11/xorg.conf</code> для Xorg
или <code>/etc/XF86Config</code> для XFree86 3.x) в раздел
<strong>Section &quot;Files&quot;</strong> добавьте следующую строчку,
<em>перед</em> ранее написанными директивами <strong>FontPath</strong>:

<pre>
	FontPath "/usr/X11R6/lib/X11/fonts/cyrillic/"
</pre>

<p>
После перезагрузки X Window, вы сможете читать тексты на русском языке в
кодировке koi8-r. Для ранних версий X Window, вам может понадобится
установить дополнительные шрифты, для этого создан порт <a href="http://www.openbsd.org/cgi-bin/cvsweb/ports/russian/xcyrillic/">xcyrillic</a>.

<p>
Для русификации клавиатуры в OpenBSD версии 3.8 и старше, следует настроить xkb,
а для более ранних либо воспользоваться
<a href="http://www.openbsd.org/cgi-bin/cvsweb/ports/russian/xruskb/">xruskb</a>
либо использовать патч для libc из набора
<a href="../files/site.tar.gz">site.tar.gz</a>.

<h4><font color="#008000">Настройка xkb</font></h4>

<p>
Для того, чтобы настроить xkb:

<p>
В Xorg, необходимо добавить следующие строки в секцию
<strong>InputDevice</strong> файла <code>/etc/X11/xorg.conf</code>:

<pre>
	Option	"XkbRules"   "xfree86"
	Option	"XkbModel"   "pc105"
	Option	"XkbLayout"  "us,ru(winkeys)"
	Option	"XkbOptions" "grp_led:scroll,grp:ctrl_shift_toggle"
</pre>

<p>
Эти настройки можно сделать в удобной графической утилите <code>xorgcfg</code>
в разделе <strong>Keyboard</strong>.

<p>
В XFree86 3.x, необходимо добавить следующие строки в секцию
<strong>Keyboard</strong> файла <code>/etc/XF86Config</code>:

<pre>
	XkbKeycodes     "xfree86"
	XkbSymbols      "us(pc101)"
	XkbGeometry     "pc"
	XkbRules        "xfree86"
	XkbModel        "pc104"
	XkbLayout       "ru"
	XkbOptions      "grp:ctrl_shift_toggle"
</pre>

<p>
В данных примерах режим переключается комбинацией клавиш Ctrl+Shift.
При переключении раскладки будет загораться Scroll Lock (если задан
параметр grp_led).

<p>
Также необходимо определить несколько переменных окружения, этого можно достичь,
добавив в файл <code>~/.xsession</code>:

<pre>
	export LC_COLLATE=C LC_CTYPE=ru_RU.KOI8-R LC_MONETARY=C \
		LC_NUMERIC=C LC_TIME=C
</pre>

<p>
Более подробную информацию по настройке XKB можно получить
<a href="http://www.tsu.ru/~pascal/other/xkb">здесь</a>.

<h4><font color="#008000">Настройка xruskb</font></h4>

Установите порт
<a href="http://www.openbsd.org/cgi-bin/cvsweb/ports/russian/xruskb/">xruskb</a>.
Добавьте в <code>~/.xinitrc</code> или <code>~/.xsession</code> следующую
команду:

<pre>
	[ -x /usr/local/bin/xrus ] && xrus jcuken-koi8.xmm
</pre>

<h4><font color="#008000">Замечание</font></h4>

<p>
Маловероятно, но возможно, что потребуется дополнительно определить вводимые
символы с помощью xmodmap(1). Для этого необходимо загрузить соответствующую
раскладку. Пример такой раскладки можно найти
<a href="../files/Xmodmap">здесь</a>.

<p>
Загрузка раскладки происходит по-умолчанию из файла <code>~/.Xmodmap</code> при
запуске startx(1). Если вы используете XDM, добавьте следующую команду в файл
<code>~/.xsession</code>:

<pre>
	[ -x /usr/X11R6/bin/xmodmap ] && /usr/X11R6/bin/xmodmap ~/.Xmodmap
</pre>

<h2><font color="#e00000"><a name="programs">Русификация программ</a></font></h2>

<h3><font color="#0000e0"><a name="freeciv">Freeciv</a></font></h3>

<p>
Для того, чтобы изменить шрифт в freeciv (xaw версии) для русских сообщений,
необходимо добавить следующую строку в файл <code>~/.Xdefaults</code>

<pre>
	Freeciv*font: -cronyx-helvetica-medium-r-normal-*-12-*-*-*-*-*-koi8-r
</pre>

<h3><font color="#0000e0"><a name="fvwm">Fvwm (Fvwm2 и Fvwm95)</a></font></h3>

<p>
Чтобы включить поддержку русских букв в менеджерах семейства fvwm, нужно
указать шрифты &quot;cronyx&quot; в следующих строчках конфигурационного
файла (<code>.fvwmrc</code>, <code>.fvwm2rc</code>, <code>.fvwm95rc</code>):

<pre>
	WindowFont -cronyx-helvetica-bold-r-*-*-12-*-*-*-*-*-*-*
	MenuFont -cronyx-helvetica-medium-r-*-*-12-*-*-*-*-*-*-*
	*FvwmPagerFont -cronyx-helvetica-bold-r-*-*-10-*-*-*-*-*-*-*
	*FvwmButtonsFont -cronyx-helvetica-bold-r-*-*-10-*-*-*-*-*-*-*
	*MiniButtonsFont -cronyx-helvetica-bold-r-*-*-10-*-*-*-*-*-*-*
	*FvwmIdentFont -cronyx-helvetica-medium-r-*-*-12-*-*-*-*-*-*-*
	*FvwmWinListFont -cronyx-helvetica-bold-r-*-*-10-*-*-*-*-*-*-*
	*FvwmTaskBarFont -cronyx-helvetica-medium-r-*-*-*-120-*-*-*-*-*-*
	*FvwmTaskBarSelFont -cronyx-helvetica-bold-r-*-*-*-120-*-*-*-*-*-*
</pre>

<h3><font color="#0000e0"><a name="gqmpeg">GQmpeg</a></font></h3>

<p>
GQmpeg поддерживает перекодировку тегов (win1251 -&gt; koi8). Для
этого, его необходимо собрать с опцией <strong>--enable-russian</strong>.
Добавьте следующие строчки в файл <code>/etc/mk.conf</code> и
пересоберите GQmpeg из портов.

<pre>
	PORTSDIR?=      /usr/ports

	.if ${.CURDIR} == ${PORTSDIR}/audio/gqmpeg
	CONFIGURE_ARGS+=        --enable-russian
	.endif
</pre>

<p>
В разделе <a href="../files/">Файлы</a> доступны skin'ы с поддержкой
русских букв.

<h3><font color="#0000e0"><a name="gtk">Приложений на базе GTK</a></font></h3>

<p>
Все приложения на базе GTK (GIMP, Sylpheed, X-Chat и другие), можно
русифицировать, добавив в <code>~/.gtkrc</code> следующие строчки:

<pre>
	style "user-font"
	{
		font = "-cronyx-helvetica-*-r-normal-*-12-*-*-*-*-*-koi8-r"
	}

	widget_class "*" style "user-font"
</pre>

<h3><font color="#0000e0"><a name="LaTeX">LaTeX</a></font></h3>

<p>
Для того, чтобы документы могли содержать русские буквы, необходимо подключить
пакет русификации и указать кодировку в <i>преамбуле</i> документа. Например:

<pre>
	\documentclass{article}
	\usepackage[koi8-r]{inputenc}
	\usepackage[russian]{babel}
	\begin{document}
	\LaTeX~--- макропакет, позволяющий авторам верстать и печатать их работы
	с высоким типографским качеством, при помощи заранее определённых,
	профессиональных макетов.
	\end{document}
</pre>

<p>
Для того, чтобы активизировать переносы в русских словах запустите утилиту
<code>texconfig</code>, выберите раздел <strong>hyphenation</strong>,
далее <strong>latex</strong> и раскомментируйте строку:

<pre>
	russian ruhyphen.tex
</pre>

<h3><font color="#0000e0"><a name="majordomo">Majordomo</a></font></h3>

<p>
Под русификацией Majordomo мы подразумеваем приведение сообщений, отправляемых
Majordomo, в ответ на запросы к такому виду, чтобы почтовый клиент не строил
догадок относительно кодировки сообщения, а точно знал её. Патч, который можно
взять <a href="ftp://ftp.openbsd.ru/pub/OpenBSD/local/patches/majordomo-1.94.5-koi8.patch.gz">здесь</a>,
предназначен для Majordomo 1.94.5 и устанавливает кодировку сообщений в koi8-r.

<h3><font color="#0000e0"><a name="mg">Mg - emacs-like text editor</a></font></h3>

<p>
Чтобы заставить mg работать с русскими буквами, достаточно создать файл
<code>~/.mg</code>, содержащий строчку:

<pre>
	meta-key-mode
</pre>

<h3><font color="#0000e0"><a name="netscape">Netscape</a></font></h3>

<p>
Наибольшую проблему при русификации Netscape представляют кнопки и поля ввода.
К сожалению по-видимому не существует &quot;нормального&quot; способа решить
эту проблему, но кое что все же сделать можно:

<ol>
  <li>Прежде всего конечно следует 
  <a href="#xwindow">русифицировать X Window</a>.
  <li>Установите порт netscape (navigator или communicator).
  <li>Добавьте в файл <code>~/.Xdefaults</code> следующие строки:

  <pre>
Netscape*fontList: -cronyx-helvetica-medium-r-normal-*-14-*-*-*-*-*-koi8-r
Netscape*documentFonts.charset*iso8859-1: koi8-r
Netscape*toolBar*fontList: -cronyx-helvetica-medium-r-normal-*-14-*-*-*-*-*-koi8-r
  </pre>
</ol>

<p>
Остальные настройки производятся обычным способом, из меню
<strong>Edit/Preferences</strong>.

<h3><font color="#0000e0"><a name="readline">Readline приложений</a></font></h3>

<p>
Приложения на базе readline (bash, mysql, psql, smbclient и т.д.) могут
работать с русскими буквами. Для этого необходимо создать файл
<code>~/.inputrc</code>, содержащий следующие строки:

<pre>
	set convert-meta off
	set input-meta on
	set output-meta on
</pre>

<h3><font color="#0000e0"><a name="samba">Samba</a></font></h3>

<p>
Для того, чтобы Windows клиенты видели русские буквы, в файл
<code>/etc/samba/smb.conf</code> добавьте следующие строки:

<pre>
	[global]
		...
		client code page = 866
		character set = koi8-r
		...
</pre>

Для того, чтобы в <strong>smbclient</strong> можно было вводить
русские буквы, необходимо создать файл <code>~/.inputrc</code>,
как это описано в разделе посвящённом русификации
<a href="#readline">Readline</a> приложений.

<h3><font color="#0000e0"><a name="twm">Tab Window Manager</a></font></h3>

<p>
Для того, чтобы Menu, Title и IconManager в TWM писали по русски, необходимо
иметь следующие строчки в <code>~/.twmrc</code> (помимо остальной
конфигурации TWM). Пример настройки TWM можно посмотреть
<a href="../files/twmrc">тут</a>.

<pre>
	TitleFont "-cronyx-helvetica-medium-r-normal-*-12-*-*-*-*-*-koi8-r"
	MenuFont "-cronyx-helvetica-medium-r-normal-*-12-*-*-*-*-*-koi8-r"
	IconManagerFont "-cronyx-helvetica-medium-r-normal-*-12-*-*-*-*-*-koi8-r"
</pre>

<p>
<hr>
<a href="index.html"><img height=24 width=24 src="../images/back.gif" border=0 alt="OpenBSD.ru"></a>
<a href="mailto:www@openbsd.ru">www@openbsd.ru</a>
<br>
<small>$RuOBSD: howto-cyrillic.html,v 1.71 2004/03/19 22:27:19 tm Exp $</small>

</body>
</html>
