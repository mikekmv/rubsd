<!--#set var="DOC_TITLE" value="Русификация OpenBSD" -->
<!--#include virtual="doc_header.html" -->

<h3><font color="#e00000">Оглавление</font></h3>

<h4>Русификация OpenBSD</h4>

<ul>
  <a href="#wscons">Русификация wscons консоли</a>
  <br><a href="#pcvt">Русификация PCVT консоли</a> (OpenBSD 2.8 и ранние)
  <br><a href="#xwindow">Русификация X Window</a>
</ul>

<h4>Русификация программ</h4>

<ul>
  <a href="#bash">Bash</a>,
  <a href="#gtk">GTK приложений</a>,
  <a href="#majordomo">Majordomo</a>,
  <a href="#mg">Mg</a>,
  <a href="#netscape">Netscape</a>,
  <a href="#talk">Talk</a>,
  <a href="#nvi">Vi/Ex</a>
</ul>

<h3><font color="#e00000">Русификация OpenBSD</font></h3>

<h4><font color="#0000e0"><a name="wscons">Русификация wscons</a></font></h4>

<p>
Начиная с OpenBSD 2.9, драйвер консоли был полностью переписан. Русская
раскладка была добавлена после выхода 2.9, поэтому для набора текста в 2.9,
вам необходим <a href="../files/koi8-map.sh">этот скрипт</a>. В случае если
у вас OpenBSD 3.0 или новее, добавьте в файл <code>/etc/kbdtype</code>
раскладку вашей клавиатуры:</p>

<ul>
  <pre>
# <b>echo "ru" > /etc/kbdtype</b>
  </pre>
</ul>

<p>
или раскомментируйте следующею строку в <code>/etc/wsconsctl.conf</code>:

<ul>
  <pre>
keyboard.encoding=ru
  </pre>
</ul>

<p>
Поддержка русского языка достигается путем создания <strong>custom</strong>
ядра с опциями:

<ul>
  <pre>
option WSDISPLAY_COMPAT_USL
option WSDISPLAY_COMPAT_RAWKBD
option WSDISPLAY_COMPAT_PCVT
option WSDISPLAY_DEFAULTSCREENS=2
  </pre>
</ul>

<p>
Исходя из количества экранов по умолчанию, в данном случае два, добавьте
в <code>/etc/rc.local</code> следующие строки для создания трех
дополнительных экранов с предварительно загруженным русским шрифтом.
Не забудьте запустить дополнительные процессы getty(8), если нужны,
на этих экранах, см. <code>/etc/ttys</code>.

<ul>
  <pre>
if [ -x /usr/sbin/wsconscfg -a -x /usr/sbin/wsfontload ]; then
	echo 'setting up wscons:'

	# Русские koi8 шрифты
	/usr/sbin/wsfontload -h 16 /usr/share/misc/pcvtfonts/koi8-r-8x16
	# Украинские koi8 шрифты
	# /usr/sbin/wsfontload -h 16 /usr/share/misc/pcvtfonts/koi8-u-8x16

	for SCREEN in 2 3 4; do
		/usr/sbin/wsconscfg -t 80x25bf -e vt100 $SCREEN
	done

	# Следующая строчка нужна, если вы используете OpenBSD 2.9
	# /bin/sh /path/to/koi8-map.sh > /dev/null

	# Следующие строчки нужны, если вы используете OpenBSD 3.0 или новее;
	# позволяет создать фиксированный переключатель на правом Ctrl
	/sbin/wsconsctl -w keyboard.map+="keycode 157 = Mode_Lock" > /dev/null
	# если вы привыкли пользоваться обычным переключателем - правый Alt
	/sbin/wsconsctl -w keyboard.map+="keycode 184 = Mode_switch" > /dev/null
fi
  </pre>
</ul>

<p>
В OpenBSD 2.9 набор русского текста происходит так же, как и в PCVT консоли -
зажимая правый Alt. Доступен патч для реализации т.н. sticky переключателя
(фиксированного). Патч и краткое руководство по установке доступны
<a href="http://violent.death.kiev.ua/soft.html">здесь</a>. Начиная с версии
3.0, такой переключатель интегрирован в OpenBSD, за что огромное спасибо Игорю
Грабину.

<h4><font color="#0000e0"><a name="pcvt">Русификация PCVT консоли</a></font></h4>

<p>
Версии OpenBSD 2.8 и ниже, содержат три различных русских шрифта в кодировке
koi8-r для русификации PCVT консоли: koi8-8x16, koi8-8x14 и koi8-8x8. Эти
шрифты могут быть загружены в знакогенератор EGA/VGA адаптера для
использования в различных видеорежимах:

<p>
<table align="center" border="1" width="400" cellpadding="2" cellspacing="0">
<tr>
  <td bgcolor="#EEEEEE" align="center">Шрифт</td>
  <td bgcolor="#EEEEEE" align="center">Число строк<br>EGA</td>
  <td bgcolor="#EEEEEE" align="center">Число строк<br>VGA</td>
</tr>
<tr>
  <td align="center">koi8-8x8</td>
  <td align="center">43</td>
  <td align="center">50</td>
</tr>
<tr>
  <td align="center">koi8-8x14</td>
  <td align="center">25</td>
  <td align="center">28</td>
</tr>
<tr>
  <td align="center">koi8-8x16</td>
  <td align="center">-</td>
  <td align="center">25</td>
</tr>
</table>

<p>
Для русификации консоли:

<ol>
<li>Убедитесь, что система собрана с драйвером PCVT. Файл конфигурации ядра
должен содержать следующую строчку:

<ul>
  <pre>
vt0 at isa? port 0x60 irq 1
  </pre>
</ul>


<li>Добавьте в <code>/etc/rc.local</code> команды загрузки шрифтов:

<ul>
  <pre>
if [ -x /usr/sbin/ispcvt ] && /usr/sbin/ispcvt; then
	/usr/sbin/loadfont -c0 -f/usr/share/misc/pcvtfonts/koi8-r-8x16
	/usr/sbin/loadfont -c1 -f/usr/share/misc/pcvtfonts/koi8-r-8x14
	/usr/sbin/loadfont -c2 -f/usr/share/misc/pcvtfonts/koi8-r-8x8
	/usr/sbin/kcon -m koi8
	/usr/sbin/scon -o

	# Следующие строчки нужны только для OpenBSD 2.5 и более ранних версий
	# for t in /dev/ttyC[0-7]; do
	# 	echo -n '\033/X' &gt; ${t}
	# done
fi
  </pre>
</ul>

</ul>

<p>
После выполнения данных действий, на консоли можно будет нормально читать
русский текст в кодировке koi8-r. Однако набор русского текста превратится
в этакое упражнение по машинописи, чтобы набрать букву &quot;ф&quot;
придётся нажать LeftAlt-A, &quot;Ф&quot; - Shift-LeftAlt-A,
&quot;ы&quot; - LeftAlt-S и т.д. На
<a href="http://violent.death.kiev.ua/soft.html">домашней странице</a> Игоря
Грабина находится патч, позволяющий создать фиксированный переключатель.

<h4><font color="#0000e0"><a name="xwindow">Русификация X Window</a></font></h4>

<p>
В файл конфигурации X Window (<code>/etc/X11/XF86Config</code> для XF4
или <code>/etc/XF86Config</code> для X11) в раздел
<strong>Section &quot;Files&quot;</strong> добавьте следующую строчку,
<u>перед</u> ранее написанными директивами <strong>FontPath</strong>:

<ul>
  <pre>
FontPath "/usr/X11R6/lib/X11/fonts/cyrillic/"
  </pre>
</ul>

<p>
После рестарта X Window, вы сможете читать тексты на русском языке в
кодировке koi8-r. Для ранних версий X Window, вам может понадобится
установить дополнительные шрифты, для этого создан порт <a href="http://www.openbsd.org/cgi-bin/cvsweb/ports/russian/xcyrillic/">xcyrillic</a>.
Для русификации клавиатуры можно настроить XKB, либо воспользоваться
<a href="http://www.openbsd.org/cgi-bin/cvsweb/ports/russian/xruskb/">xruskb</a>.

<h4>Настройка XKB</h4>

<p>
Для того, чтобы настроить XKB:

<p>
В XFree86 3.x, необходимо добавить следующие строки в секцию
<strong>Keyboard</strong> файла <code>/etc/XF86Config</code>:

<ul>
  <pre>
XkbKeycodes     "xfree86"
XkbSymbols      "us(pc101)"
XkbGeometry     "pc"
XkbRules        "xfree86"
XkbModel        "pc104"
XkbLayout       "ru"
XkbOptions      "grp:ctrl_shift_toggle"
  </pre>
</ul>

<p>
В XFree86 4.x, необходимо добавить следующие строки в секцию
<strong>InputDevice</strong> файла <code>/usr/X11/XF86Config</code>:

<ul>
  <pre>
Option	"XkbRules"   "xfree86"
Option	"XkbModel"   "pc101"
Option	"XkbLayout"  "ru"
Option	"XkbOptions" "grp_led:scroll,grp:ctrl_shift_toggle"
  </pre>
</ul>

<p>
Эти настройки можно сделать в удобной графической утилите <code>xf86cfg</code>
в разделе <strong>Keyboard</strong>.

<p>
В данных примерах переключателем режимов является комбинация клавиш Ctrl+Shift.
Теперь чтобы увидеть вводимые Вами символы, необходимо эти символы определить,
так как X Window ничего не знает о символах кириллицы. Для этого необходимо
загрузить соответствующую раскладку с помощью xmodmap. Пример такой раскладки
можно найти <a href="../files/Xmodmap">здесь</a> или
<a href="ftp://ftp.kiarchive.ru/pub/cyrillic/x11/Xmodmap">здесь</a>.</P>


<p>
Загрузка раскладки происходит по-умолчанию из файла <code>~/.Xmodmap</code> при
запуске startx. Если вы используете XDM, добавьте следующую команду в файл
<code>~/.xsession</code>:

<ul>
  <pre>
[ -x /usr/X11R6/bin/xmodmap ] && /usr/X11R6/bin/xmodmap ~/.Xmodmap
  </pre>
</ul>

<p>
Более подробную информацию по настройке XKB можно получить
<a href="http://www.tsu.ru/~pascal/other/xkb">здесь</a>.

<h4>Установка xruskb</h4>

Установите порт <a href="http://www.openbsd.org/cgi-bin/cvsweb/ports/russian/xruskb/">xruskb</a>.
Добавте в <code>~/.xinitrc</code> или <code>~/.xsession</code> следующую
команду:
</ol>

<ul>
  <pre>
[ -x /usr/local/bin/xrus ] && xrus jcuken-koi8.xmm
  </pre>
</ul>

<h3><font color="#e00000"><a name="programs">Русификация программ</a></font></h3>

<h4><font color="#0000e0"><a name="bash">Bash</a></font></h4>

<p>
Чтобы заставить bash работать с русскими буквами, нужно создать файл
<code>~/.inputrc</code>, содержащий следующие строки:

<ul>
  <pre>
set convert-meta off
set input-meta on
set output-meta on
  </pre>
</ul>

<h4><font color="#0000e0"><a name="gtk">Приложений на базе GTK</a></font></h4>

<p>
Все приложения на базе GTK (GIMP, Slypheed, X-Chat и другие), можно
русифицировать добавив в <code>~/.gtkrc</code> следующие строчки:

<ul>
  <pre>
style "user-font"
{
	font = "-cronyx-helvetica-*-r-normal-*-12-*-*-*-*-*-koi8-r"
}

widget_class "*" style "user-font"
  </pre>
</ul>

<h4><font color="#0000e0"><a name="majordomo">Majordomo</a></font></h4>

<p>
Под русификацией Majordomo мы подразумеваем приведение сообщений, отправляемых
Majordomo, в ответ на запросы к такому виду, чтобы почтовый клиент не строил
догадок относительно кодировки сообщения, а точно знал ее. Патч, который можно
взять <a href="ftp://ftp.openbsd.ru/pub/OpenBSD/local/patches/majordomo-1.94.5-koi8.patch.gz">здесь</a>,
предназначен для Majordomo 1.94.5 и устанавливает кодировку сообщений в koi8-r.

<h4><font color="#0000e0"><a name="mg">Mg - emacs-like text editor</a></font></h4>

<p>
Чтобы заставить mg работать с русскими буквами, достаточно создать файл
<code>~/.mg</code>, содержащий строчку:

<ul>
  <pre>
meta-key-mode
  </pre>
</ul>

<h4><font color="#0000e0"><a name="netscape">Netscape</a></font></h4>

<p>
Наибольшую проблему при русификации Netscape представляют кнопки и поля ввода.
К сожалению по-видимому не существует &quot;нормального&quot; способа решить
эту проблему, но кое что все же сделать можно:

<ol>
  <li>Прежде всего конечно следует 
  <a href="#xwindow">русифицировать X Window</a>.
  <li>Установите порт netscape (navigator или communicator).
  <li>Добавте в файл <code>~/.Xdefaults</code> следующие строки:

  <ul>
    <pre>
*fontList: -cronyx-helvetica-medium-r-normal-*-14-*-*-*-*-*-koi8-r
*documentFonts.charset*iso8859-1: koi8-r
*toolBar*fontList: -cronyx-helvetica-medium-r-normal-*-14-*-*-*-*-*-koi8-r
    </pre>
  </ul>
</ol>

<p>
Остальные настройки производятся обычным способом, из меню
<strong>Edit/Preferences</strong>.

<h4><font color="#0000e0"><a name="talk">Talk</a></font></h4>

<p>
Начиная с OpenBSD 2.9, в программе talk, появилась поддержка русских символов.
Другие, более старые версии talk не поддерживали русские символы. Для решения
этой проблемы была создана программа bazar. Программа оформлена в виде порта с
использованием файлов из <code>/usr/src/usr.bin/talk</code> от OpenBSD.
Загрузить порт bazar можно
<a href="ftp://ftp.openbsd.ru/pub/OpenBSD/local/ports/net/bazar/">отсюда</a>.

<p>
Программа bazar полностью совместима с talk, но содержит следующие дополнения:

<ul>
  <li>Добавлен скроллинг в окна
  <li>Поддерживаются русские символы
  <li>Добавлена возможность перекодировки koi8-r &lt;&gt; windows-1251
</ul>

<h4><font color="#0000e0"><a name="nvi">Vi/Ex</a></font></h4>

<p>
Стандартный дистрибутив OpenBSD содержит nvi/nex версию редакторов vi и ex.
Для того чтобы эти редакторы правильно отображали русские буквы, необходимо
создать файл <code>~/.nexrc</font>, содержащий следующие строки:

<ul>
  <pre>
set print=абвгдежзийклмнопрстуфхцчшщыьъэюяАБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЫЬЪЭЮЯ
set noprint=
  </pre>
</ul>

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../images/back.gif" border="0" alt="OpenBSD.ru"></a>
<a href="mailto:www@openbsd.ru">www@openbsd.ru</a><br>
<small>$RuOBSD: howto-cyrillic.html,v 1.47 2002/02/07 15:24:55 dfa Exp $</small>

</body>
</html>
