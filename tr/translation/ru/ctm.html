<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
   <meta http-equiv="Content-Type" content="text/html; charset=koi8-r">
   <TITLE>CTM</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#23238E">

<center>
<img alt="CTM for OpenBSD" src=../images/bsdctm.gif width=401 height=126>
</center>

<H3>Что такое ctm?</H3>

<P>
Ctm - система, которую создал Поль-Хеннинг Камп (Poul-Henning Kamp) для
изменения исходных текстов на ежедневной основе по электрoнной почте.
Это хороший способ отслеживать текущее состояние исходных текстов при
плохом соединении с интернетом - например, если у вас модем.

<P>
При передаче изменений исходных текстов ctm использует очень малую пропускную
полосу, при этом они сжимаются при помощи gzip -9.

<H3>Как она работает?</H3>

<P>
Основная идея ctm заключается в том, что вы подписываетесь на специальный
список рассылки для конкретной ветви исходных текстов. Каждый день вы получаете
почтовое сообщение, содержащее все изменения в данной ветви за этот период.
Каждый отдельный набор изменений называется &quot;дельтой&quot;.

<P>
Вы начинаете с базового набора, на который накладываются последующие дельты.
Для того, чтобы начать пользоваться ctm, вы должны взять последний базовый
набор и все дельты, которые появились после него. Для облегчения загрузки по
плохим линиям базовые наборы разбиты на части по 1400k каждая. В таком виде
вы даже можете разместить их на флоппи-диске.

<P>
Базы создаются примерно через 100 дельт после предыдущей базы, поэтому вам не
придется загружать более 100 дельт для синхронизации исходных текстов.

<H3>Какая пропускная полоса требуется для ctm?</H3>

<P>
Как уже говорилось выше, базовый набор содержит полную ветвь исходных текстов,
упакованную в формате TAR. При этом он очень велик. Вы должны взять по ftp с
сайтов, приведенных ниже, базовый набор и все дельты до текущего момента.
Размеры:

<ul>
<li> примерно 115Mb для OpenBSD-cvs
<li> примерно 37Mb для OpenBSD-cvs-x11
<li> примерно 65Mb для OpenBSD-src
<li> примерно 35Mb для OpenBSD-src-x11
<li> примерно 2Mb для OpenBSD-ports
<li> Помните, что это размеры в сжатом виде, расчитывайте на пятикратное
	увеличение занимаемых размеров после распаковки.
<li> размер относительных дельт колеблется от 10k до 100k, и иногда до пары Mb
<li> ctm всегда делит дельты на сообщения по 100k, которые объединяются
     автоматически
</ul>

<P>
Хотя большие изменения в ctm редки, обычно они появляются после внесения
больших изменений, например апгрейда binutils, perl и т.д.

<H3>Как использовать ctm?</H3>

<UL>
<LI>Подпишитесь на список рассылки ctm для необходимой вам ветви исходных
текстов.
<p>
   Существует несколько списков рассылки ctm.  Существует список для получения
   изменений в ветви cvs, список для ветви src, список для X11 ветвей
   cvs и src, список для ветви портов, а также список для
   просмотра сообщений (log messages), возникающих при работе генератора ctm
   дельт.
   <p>
   При помощи этих команд вы можете подписаться на соответствующие списки:
<br><br><tt>
Для ветви cvs (без X11):<br>
    <b>echo subscribe OpenBSD-cvs | mail majordomo@OpenBSD.org</b><br>
Для X11 части ветви cvs:<br>
    <b>echo subscribe OpenBSD-cvs-x11 | mail majordomo@OpenBSD.org</b><br>
Для ветви src (без X11): <br>
    <b>echo subscribe OpenBSD-src | mail majordomo@OpenBSD.org</b><br>
Для X11 части ветви src: <br>
    <b>echo subscribe OpenBSD-src-x11 | mail majordomo@OpenBSD.org</b><br>
Для ветви портов: <br>
    <b>echo subscribe OpenBSD-ports-ctm | mail majordomo@OpenBSD.org</b><br>
Список рассылки сообщений генератора дельт:<br>
    <b>echo subscribe ctm-log | mail majordomo@OpenBSD.org</b><br>
</tt><br>

<LI>Через некоторое время вы получите первую дельту.

<LI>Распакуйте и соберите дельту ctm при помощи ctm_rmail.
<br>
<br>
<tt>
    <b>ctm_rmail -p. -d. -b. folder</b>
</tt>
<br><br>
где <b>folder</b> - каталог, в котором содержатся почтовые сообщения с дельтами.
<br>
Эта команда распакует дельту ctm и поместит ее в рабочий каталог. Дельта будет
файлом в виде OpenBSD-XXX.YYYY.gz, где XXX - или "src" или "cvs", а YYYY означают номер дельты.
<p>

<li>Возьмите базовый набор с ftp-сайтов, указанных ниже, в подкаталогах
<b>base/OpenBSD-cvs</b> (для OpenBSD-cvs) or <b>base/OpenBSD-src</b>
(для OpenBSD-src).  Возьмите все файлы в данном каталоге и, как только вы
получите все файлы, вы можете создать базовую ветвь исходных текстов при помощи
команды:

<br><br>
<tt>
    <b>cd target <br>
    cat /split/OpenBSD-* | tar zxf - <br>
</b></tt><br>

где <b>split</b> - каталог, в который вы поместили взятые файлы.

<p>
Если вы уверены, что у вас вся необходимая ветвь, Вам больше нет необходимости
сохранять эти файлы. Однако, прежде чем продолжать, запомните номер базы.

<p>
Теперь Вам нужно взять дельты, которые были созданы после базы. Зайдите
например в подкаталог <b>OpenBSD-cvs</b> или <b>OpenBSD-src</b>, и возьмите
все файлы, номер которых <it>больше</it> номера использованной вами базы.

<p>
Адреса базы и дельт:

<ul>
<li><a href="ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm/
</a>
</ul>

<ul>
<li><a href="ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm/
</a>
</ul>

<ul>
<li><a href="ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm/
</a>
</ul>

<p>
<ul>
<li><b>Замечание:</b> Мне хотелось бы найти другие сайты во всех странах,
которые захотели бы размещать у себя эти дельты.
</ul>
<p>

<LI> Запустите ctm.
<br>
  <br>
  <tt>
     <b>cd target<br>
     ctm -v -v /deltas/OpenBSD-cvs.*</b><br></tt>
или<br><tt>
где <b>target</b> - каталог, в котором вы хотели бы разместить исходные тексты,
и <b>deltas</b> - где вы храните дельты.
<p>
Для обработки всех дельт потребуется какое-то время, но повседневная работа
<b>ctm_rmail</b> и <b>ctm</b> не будет столь продолжительна.
</ul>

<h3>Что мне выбрать - ветвь cvs или исходные тексты?</h3>

<P>
Это зависит, среди прочего, от свободного места на вашем диске. Так как
ctm еще не умеет работать с файлами, которые были изменены не самим ctm,
"лучшим" вариантом вероятно будет ветвь cvs. Тогда вы сможете вносить
изменения в вашу ветвь src из своей ветви cvs, и держать ваши
изменения в своей ветви src, предоставив ctm только вашу ветвь cvs.

<p>
Недостатком, однако, является тот объем дискового пространства, который при
этом занимается. Ветвь src занимает примерно 300Mb, но если
вы держите свою ветвь cvs, вам потребуется на нее около 400Mb <b>плюс</b>
300Mb для ветви src.

<p>
При этом не берутся в расчет те 100Mb, или более, которые потребуются для
компиляции (в зависимости от архитектуры).

<p>
Если вы хотите иметь только исходные тексты, вам придется самому разбираться с
местными изменениями. Для этого можно воспользоваться файловой системой
<b>union</b>, хотя были сообщения, что она можеть быть нестабильной, если
нижний и верхний уровни размещаются на одной и той же физической файловой
системе. Если вы разместите нижний и верхний уровни на разных файловых системах,
у вас не должно быть проблем. Пример такой работы:

<p>
Предположим, что ветвь, обновляемая при помощи ctm, находится в
<b>/usr/src-ctm</b>, а ваша настоящая ветвь исходных текстов, та, в которую вы
вносите изменения и которую компилируете, находится в <b>/usr/src</b>.
Сначала <b>/usr/src</b> должен быть пустым каталогом. Данная команда
выполнит монтирование объединенной файловой системы:
<br><br>
<tt>
    <b>mount -t union -o -b /usr/src-ctm /usr/src</b>
</tt>
<br><br>
Изменения, сделанные в файлах на /usr/src, становятся файлом, находящимся на
/usr/src, и скрывающим тот, что находится в src-ctm. Если изменения были
внесены ctm в ветвь src-ctm, лежащую ниже, то эти изменения <b>не</b> будут
видны, если есть файл в верхнем уровне, скрывающий их.

<p>
вы должны периодически размонтировать объединенную файловую систему и искать
файлы, которые являются локальными для этой файловой системы.
<br><br>
<tt>
    <b>umount /usr/src <br>
    find /usr/src -type f</b> <br>
</tt>
<br><br>
Команды <b>ls -W</b> и <b>rm -W</b> тоже полезны, поскольку объекты /usr/src,
называемые "whiteouts", также будут скрывать файлы в src-ctm.

<p>
Если вы выбрали ветвь cvs, вы можете использовать команду "cvs checkout" для
выделения ветви src, и каждый раз, когда вы производите обновление
при помощи ctm, вы можете использовать команду "cvs update" для обновления
ветви src.

<br><br>
Для получения начальной ветви src:<br>
<tt>
    <b>cd /usr <br>
    cvs -qd YOUR_CVS_TREE checkout src</b> <br><br>
</tt>
и после каждой модификации ctm:<br>
<tt>
    <b>cd /usr/src <br>
    cvs -q update -PAd</b> <br>
</tt>

<H3>На сколько стабильна система ctm для OpenBSD?</H3>

Ctm для OpenBSD используется более года, а для FreeBSD уже несколько лет.
Ctm вполне стабильна и надежна.

<H3>Дополнительная информация</H3>

Если у вас возникли проблемы с ctm, то для начала хорошо бы ознакомиться с
FreeBSD handbook:

<ul>
<li> <a href="http://www.FreeBSD.org/handbook/ctm.html">
         http://www.FreeBSD.org/handbook/ctm.html
     </a>
</ul>

Кроме того, существуют справочные страницы (man pages) для всех
утилит ctm, входящих в дистрибутив исходных текстов ctm. Если у вас OpenBSD,
у вас уже должны быть справочные страницы, исходные тексты и бинарные файлы.
Если нет, вы можете взять их с того же ftp-сайта, что и дельты.

<p>
Если у вас возникнут проблемы с ctm, вы можете обратиться в списки рассылки
OpenBSD или ко мне, хотя мое свободное время довольно ограничено.

<p>
В итоге:

<p>

<ul>
<li> Списки рассылки:

   <ul>
   <li> <b>echo subscribe OpenBSD-cvs | mail majordomo@OpenBSD.org</b>
   <li> <b>echo subscribe OpenBSD-cvs-x11 | mail majordomo@OpenBSD.org</b>
   <li> <b>echo subscribe OpenBSD-src | mail majordomo@OpenBSD.org</b>
   <li> <b>echo subscribe OpenBSD-src-x11 | mail majordomo@OpenBSD.org</b>
   <li> <b>echo subscribe OpenBSD-ports-ctm | mail majordomo@OpenBSD.org</b>
   <li> <b>echo subscribe ctm-log | mail majordomo@OpenBSD.org</b>
   </ul>

<li> FTP (для базы и относительных дельт; ctm есть в исходных текстах OpenBSD,
     но если у вас нет ни бинарных файлов, ни исходных текстов, то там же
     исходные тексты):

   <ul>
   <li> <a href="ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm">
         ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm
	   </a>
   <li> <a href="ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm">
         ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm
	   </a>
   <li> <a href="ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm">
         ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm
	   </a>
   </ul>
</ul>

<p>
Все важные замечания и объявления по ctm будут посылаться по адресам:
<ul>
<li> misc@OpenBSD.org
<li> announce@OpenBSD.org
</ul>

<p>
<b>Замечание:</b> Если вы используете ctm для OpenBSD, пожалуйста, пошлите
мне письмо по электоронной почте, чтобы я знал, сколько людей ее используют!

<H3>Благодарности</H3>

<li> Poul-Henning Kamp (phk@FreeBSD.org) - за создание ctm и помощи мне в
     в отладке процесса создания дельт.

<li> Theo de Raadt (deraadt@theos.com) - за создание OpenBSD и предоставление
     начальных ресурсов, необходимых для создания дельт ctm на cvs.OpenBSD.org
     (сейчас они создаются в другом месте), а также за помощь в конфигурации
     DNS

<li> Todd C. Miller (millert@OpenBSD.org) - за настройку и администрирование
     списков рассылки ctm

<li> Bob Beck (beck@OpenBSD.org), Artur Grabowski (art@OpenBSD.org),
     Magnus Holmberg (mho@OpenBSD.org) и
     Wolfram Schneider (wosch@FreeBSD.org) за настройку ftp-сайта для
     баз и дельт на ctm.*OpenBSD.org

<li> ... и всем другим, кто помог косвенно ..
</ul>

<P>
Удачи!

<P>
t

<HR>

<ADDRESS><A HREF="mailto:graichen@OpenBSD.org">Thomas Graichen</A></ADDRESS>
<br>
Логотип OpenBSD/CTM для проекта OpenBSD создал
   <a href="mailto:flipk@openbsd.org">Phillip F Knaack</a>.

<P>
Originally [$OpenBSD: ctm.html,v 1.11 2000/03/25 02:29:49 wvdputte Exp $]<br>
$RuOBSD: ctm.html $<br>
$Translation$<br>
$OpenBSD$

</BODY>
</HTML>
