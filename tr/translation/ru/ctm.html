<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
   <meta http-equiv="Content-Type" content="text/html; charset=koi8-r">
   <TITLE>CTM</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#23238E">

<center>
<img alt="CTM for OpenBSD" src="../images/bsdctm.gif" width="401" height="126">
</center>

<H3>Что такое CTM?</H3>

<P>
CTM - система, которую создал Поль-Хеннинг Камп (Poul-Henning Kamp) для
изменения исходных текстов на ежедневной основе по электрoнной почте.
Это хороший способ отслеживать текущее состояние исходных текстов при
плохом соединении с интернетом - например, если у вас модем.

<P>
При передаче изменений исходных текстов CTM использует очень малую пропускную
полосу, при этом они сжимаются при помощи <tt><b>gzip -9</b></tt>. В отличие от
<a href="cvsup.html">CVSup</a>, CTM написан на языке C и поэтому доступен
для любой платформы, которую поддерживает OpenBSD.

<p>
По <b>любым</b> проблемам, предложениям и вопросам относительно
CTM, свяжитесь с администратором CTM -
<a href="mailto:hgw@d1906.inka.de">Hans G&uuml;nter Weigand</a>.
<small>(Пожалуйста, не беспокойте других людей из OpenBSD по поводу CTM,
так как они заняты решением других проблем. Спасибо.)</small>

<H3>Как она работает?</H3>

<P>
Основная идея CTM заключается в том, что вы подписываетесь на специальный
список рассылки для конкретной ветви исходных текстов. Каждый день вы получаете
почтовое сообщение, содержащее все изменения в данной ветви за этот период.
Каждый отдельный набор изменений называется <b>дельтой</b>. На самом деле,
CTM сервер создает новые дельты каждые 12 часов.

<P>
Вы начинаете с базового набора, на который накладываются последующие дельты.
Для того, чтобы начать пользоваться CTM, вы должны взять последний базовый
набор и все дельты, которые появились после него. Для облегчения загрузки по
плохим линиям базовые наборы разбиты на части по 1400kB каждая.

<P>
Базовые наборы создаются примерно через 50 дельт, поэтому вам не придется
загружать более 50 дельт для синхронизации исходных текстов.

<P>
В настоящий момент существует два типа базовых набора. Долгое время мы делали
файлы <tt><b>tar.gz</b></tt> вручную, но мы переключаемся на истинные базовые
CTM дельты. Они также содержат контрольную сумму
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=md5&sektion=1">md5(1)</a>
и генерируются автоматически, поэтому немного безопаснее. Вы можете различить
эти два типа базовых набора по их названию. Пример для <tt><b>tar.gz</b></tt>
файла - <tt><b>OpenBSD-cvs.1450.tar.gz</b></tt>, тогда как базовая CTM дельта
будет называться <tt><b>OpenBSD-cvs.1500A.gz</b></tt>. Смотрите ниже для
подробных инструкций.

<H3>Какая пропускная полоса требуется для ctm?</H3>

<P>
Вы получаете базовый набор и все дельты до текущего момента с ftp серверов,
приведенных ниже. Размеры:

<ul>
<li>Примерно 115MB для OpenBSD-cvs.
<li>Примерно 37MB для OpenBSD-cvs-x11.
<li>Примерно 56MB для OpenBSD-cvs-xf4.
<li>Примерно 65MB для OpenBSD-src.
<li>Примерно 35MB для OpenBSD-src-x11.
<li>Примерно 2MB для OpenBSD-ports.
<br>Помните, что это размеры в сжатом виде, рассчитывайте на
    пятикратное увеличение занимаемых размеров после распаковки.
<li>Размер дельт колеблется от 10k до 500kB, и иногда до пары мегабайт.
<li>CTM всегда делит дельты на сообщения по 100kB, которые объединяются
    автоматически.
<li>Если дельта больше чем 5MB, она не посылается по почте. Вместо этого,
    вы получите извещение о том, что нужно забрать дельту через ftp. Большие
    изменения в CTM редкость и в основном происходят при импортировании
    значительных вещей, таких как binutils, perl, gcc или при добавлении
    CVS тега в CVS репозиторий.
</ul>

<H3>Как использовать CTM?</H3>

<UL>
<LI>Подпишитесь на список рассылки CTM для необходимого вам дерева исходных
текстов.
<p>
   Существует несколько списков рассылки CTM. Список для получения изменений
   в CVS репозитории, список для дерева исходных текстов, список для X11,
   список для дерева портов, а также список для просмотра регистрационных
   сообщений, возникающих при генерации CTM дельт.
   <p>
   При помощи этих команд вы можете подписаться на соответствующие списки:
<p>
Для CVS репозитория (без модулей X11 и XF4):
<pre>
	echo subscribe OpenBSD-cvs | mail majordomo@OpenBSD.org
</pre>
Для модуля X11 CVS репозитория:
<pre>
	echo subscribe OpenBSD-cvs-x11 | mail majordomo@OpenBSD.org
</pre>
Для дерева исходных текстов (без модулей X11 и XF4):
<pre>
	echo subscribe OpenBSD-src | mail majordomo@OpenBSD.org
</pre>
Для модуля X11 дерева исходных текстов:
<pre>
	echo subscribe OpenBSD-src-x11 | mail majordomo@OpenBSD.org
</pre>
Для дерева портов:
<pre>
	echo subscribe OpenBSD-ports-ctm | mail majordomo@OpenBSD.org
</pre>
Для регистрационных сообщений:
<pre>
	echo subscribe ctm-log | mail majordomo@OpenBSD.org
</pre>

Пока нет списка рассылки для модуля XF4. Он доступен только через ftp.

<p>
<li>Установите программу CTM из коллекции пакетов или портов.
Порт находится в <tt><b>/usr/ports/devel/ctm</b></tt>.

</ul>
<b>Примечание:</b> Для ясности, ниже идущие примеры относятся к OpenBSD-cvs.
Но, их так же можно применить и к другим исходным наборам.

<p><ul>

<li>Скопируйте базовый набор с ftp-сервера. Вы можете найти его в директории
<tt><b>base/OpenBSD-cvs</b></tt>. Возьмите все файлы из данной директории.
Как только вы получите их все, вы можете создать файл базового набора и
распаковать его при помощи ниже следующих команд, в зависимости от полученного
типа файла:

<pre>
	cat split/OpenBSD-cvs.1500A.gz.* &gt; OpenBSD-cvs.1500A.gz
	cd target
	ctm -v -v -v .../OpenBSD-cvs.1500A.gz
</pre>
<p>
или

<pre>
	cat split/OpenBSD-cvs.1500.tar.gz.* &gt; OpenBSD-cvs.1500.tar.gz
	cd target
	tar -xzvf .../OpenBSD-cvs.1500.tar.gz
</pre>

<p>
где <tt><b>split</b></tt> - директория, в которой вы поместили скопированные
файлы и <tt><b>target</b></tt> - выбранное вами место для распаковки набора
исходных текстов.

<p>Если вы уверены в том, что у вас все необходимое дерево, вам больше нет
необходимости хранить эти файлы. Но вы можете оставить их, как резервную копию.
Однако, прежде чем продолжать, запомните номер базового набора.

<p>
<li>Теперь вам нужно получить дельты, которые были сгенерированы после
базового набора. Идите на FTP сервер в поддиректорию <tt><b>OpenBSD-cvs</b></tt>
и скопируйте каждый файл, чей номер <em>больше</em> номера базового набора,
который вы используете. После добавьте эти дельты:

<pre>
	cd target
	ctm -v -v -v deltas/OpenBSD-cvs.*
</pre>

<p>
где <tt><b>target</b></tt> - директория, в которой вы поместили исходное дерево
набора, и <tt><b>deltas</b></tt> - куда вы переписали дельты.

<p>
<LI>Подождите пока вы получите первую дельту из списка рассылки.
<p>
<LI>Распакуйте и соберите дельту CTM при помощи <tt><b>ctm_rmail</b></tt>.
<p>

<pre>
	ctm_rmail -p /tmp -d deltas -b target folder
</pre>

<p>
где <tt><b>folder</b></tt> - директория, в которой содержатся почтовые
сообщения с дельтами. Эта команда распакует CTM дельту и поместит ее в
директорию <tt><b>deltas</b></tt>. Дельта будет файлом в виде
<tt><b>OpenBSD-cvs.<var>XXXX</var>.gz</b></tt>, где <var>XXXX</var> - номер
дельты. Потом дельта будет добавлена в дерево директорий расположенных в
<tt><b>target</b></tt>, место куда вы распаковали базовый набор.

<p>
Повторяйте этот последний шаг каждый раз, как вы получаете дельту
из списка рассылки. Вы можете автоматизировать этот процесс используя
procmail или любую схожею программу.
</ul>

<p>
Адреса FTP серверов на которых вы можете найти CTM дельты:

<ul>
<li>Основной FTP сервер:
<p>
<a href="ftp://openbsd.rug.ac.be:/ftp/pub/OpenBSD-ctm/">
     ftp://openbsd.rug.ac.be:/ftp/pub/OpenBSD-ctm/
</a>.
<p>
Этот сервер автоматически обновляется при генерации CTM дельт. Базовые
наборы доступны в больших одиночных файлах в директории <tt><b>base</b></tt>.
Разделенные файлы в <tt><b>base-split</b></tt>.
</ul>

<ul>
<li><a href="ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm/
</a>
<p>
Сервер обновляется, как только получает CTM дельты из списков рассылки. Кроме
того, он содержит разделенные базовые наборы в директории <tt><b>base</b></tt>.
</ul>

<ul>
<li><a href="ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm/
</a>
<p>
идентичен
<p>
<li><a href="ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm/
</a>
<p>
зеркало
<a href="ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.se.OpenBSD.org
</a>
.
</ul>

<p>
<b>Примечание:</b> <a href="mailto:hgw@d1906.inka.de">Мне</a> хотелось бы
      найти другие сервера по всему миру, которые захотели бы размещать у
      себя эти дельты.
<p>

<h3>Что мне выбрать - CVS репозиторий или дерево исходных текстов?</h3>

<P>
Это зависит, среди прочего, от свободного места на вашем диске. Так как
CTM еще не умеет работать с файлами, которые были изменены локально,
"лучшим" вариантом вероятно будет <a href="anoncvs.html">CVS</a> репозиторий.
Тогда вы сможете извлечь рабочее дерево исходных текстов из вашего CVS
репозитория, и хранить ваши локальные изменения в вашем дереве. CVS достаточно
силен, чтобы объединить ваши локальные изменения. Вы сможете использовать
любые команды CVS, за исключением <tt><b>cvs commit</b></tt>.

<p>
Недостатком, однако, является тот объем дискового пространства, который при
этом используется. Извлеченное дерево исходных текстов занимает примерно 350MB,
но если вы содержите свой CVS репозиторий, вам потребуется на него более 1Gb,
<b>плюс</b> другие 350MB для извлеченного дерева исходных текстов. При этом не
берутся в расчет еще около 100Mb или более (в зависимости от архитектуры),
которые потребуются для компилирования исходных текстов.

<p>
Если вы только хотите иметь дерево исходных текстов, вам придется самому
разбираться с локальными изменениями. Один из способ сделать это - использовать
файловую систему <b>union</b> (смотрите <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_union&sektion=8">mount_union(8)</a>),
хотя были сообщения, что файловая система <b>union</b> может быть нестабильна
если оба уровня - верхний и нижний находятся на одной физической файловой
системе. Если вы разместите нижний и верхний уровни на разных файловых системах,
у вас не должно возникнуть таких проблем. Пример этого:

<p>
Предположим, что дерево обновляемое через CTM, находится в
<tt><b>/usr/src-ctm</b></tt>, и ваше настоящее дерево исходных текстов, то, в
котором вы делаете изменения и которое вы компилируете, находится в
<tt><b>/usr/src</b></tt>. <tt><b>/usr/src</b></tt> должен быть пустой
директорией. Данная команда выполнит объединенное монтирование файловых систем:

<pre>
	mount -t union -o -b /usr/src-ctm /usr/src
</pre>

<p>
Изменения, сделанные в файлах на <tt><b>/usr/src</b></tt>, становятся файлами,
находящимися в <tt><b>/usr/src</b></tt>, и скрывающими те, что находятся в
<tt><b>src-ctm</b></tt>. Если изменения были внесены CTM в низлежащее дерево
<tt><b>src-ctm</b></tt>, они <b>не</b> будут видны, если есть файлы на верхнем
уровне, скрывающие их.

<p>
Вы должны периодически размонтировать объединенную файловую систему и искать
файлы, которые являются локальными для этой файловой системы.

<pre>
	umount /usr/src
	find /usr/src -type f
</pre>

<p>
Команды <tt><b>ls -W</b></tt> и <tt><b>rm -W</b></tt> будут так же полезны,
поскольку объекты называемые "whiteouts" в <tt><b>/usr/src</b></tt>, будут
также скрывать файлы в <tt><b>src-ctm</b></tt>.

<p>
Если вы выбрали CVS репозиторий, вы можете использовать команду
<tt><b>cvs checkout</b></tt> для извлечения дерева исходных текстов из него.
Каждый раз, когда вы производите обновление при помощи CTM, вы можете
использовать команду <tt><b>cvs update</b></tt> для обновления дерева
исходных текстов.

<p>
Чтобы получить начальный src репозиторий:
<pre>
	cd /usr
	cvs -qd YOUR_CVS_REPOSITORY checkout -A src
</pre>
<p>
и после каждого CTM обновления:
<pre>
	cd /usr/src
	cvs -q update -PAd
</pre>

<H3>На сколько стабильна CTM для OpenBSD?</H3>

CTM для OpenBSD используется более четырех лет, а для FreeBSD еще
больше. CTM вполне стабильна и надежна.

<h3>Что преподнесет будущее для CTM?</h3>

Предвидятся многочисленные (мелкие) изменения и возможная оптимизация.
Среди них: 

<ul>
<li> CTM никогда не посылает по почте дельту, которая больше 5MB. Это может
     быть заменено одним из двух способов: Максимальный размер дельты может
     быть увеличен или установлено ограничение на отсылаемое количество
     сообщений, которые будут отправляться ежедневно. Например, если размер
     дельты 6MB, она разбивается на 96 почтовых сообщений. Они становятся в
     очередь. На первый день отсылается первые 50 сообщений, на второй день
     отсылаются остальные 46 сообщений, плюс первые 4 сообщения следующей
     дельты.
<li> Программное обеспечение CTM может быть переписано. Это была бы, также
     хорошая возможность для добавления новых возможностей, например: PGP
     подпись для CTM дельты.
</ul>

<H3>Дополнительная информация</H3>

Если вы хотите узнать больше о CTM, хорошо бы ознакомиться с FreeBSD handbook:

<ul>
<li> <a href="http://www.FreeBSD.org/handbook/ctm.html">
         http://www.FreeBSD.org/handbook/ctm.html
     </a>
</ul>

Также, там находятся справочные руководства по всем утилитам CTM.

<h3>Cводка:</h3>

<p>

<ul>
<li> Списки рассылки:

   <ul>
   <li><tt>echo subscribe OpenBSD-cvs | mail majordomo@OpenBSD.org</tt>
   <li><tt>echo subscribe OpenBSD-cvs-x11 | mail majordomo@OpenBSD.org</tt>
   <li><tt>echo subscribe OpenBSD-src | mail majordomo@OpenBSD.org</tt>
   <li><tt>echo subscribe OpenBSD-src-x11 | mail majordomo@OpenBSD.org</tt>
   <li><tt>echo subscribe OpenBSD-ports-ctm | mail majordomo@OpenBSD.org</tt>
   <li><tt>echo subscribe ctm-log | mail majordomo@OpenBSD.org</tt>
   </ul>
<p>
<li> FTP (для базовых наборов и дельт):

   <ul>
   <li> <a href="ftp://openbsd.rug.ac.be:/ftp/pub/OpenBSD-ctm/">
        ftp://openbsd.rug.ac.be:/ftp/pub/OpenBSD-ctm/</a>
   <li> <a href="ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm">
        ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm</a>
   <li> <a href="ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm">
        ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm</a>
   <li> <a href="ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm">
        ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm</a>
   </ul>
</ul>

<p>
Важные замечания и объявления по CTM будут посылаться на:
<ul>
<li> announce@OpenBSD.org
<li> misc@OpenBSD.org
</ul>

<p>

<H3>Благодарности</H3>

<ul>
<li> Poul-Henning Kamp (phk@FreeBSD.org) - за создание CTM и помощи в
     отладке процесса создания дельт

<li> Theo de Raadt (deraadt@theos.com) - за создание OpenBSD и предоставление
     начальных ресурсов, необходимых для создания дельт CTM на cvs.OpenBSD.org
     (сейчас они создаются в другом месте), а также за помощь в конфигурации
     DNS

<li> Todd C. Miller (millert@OpenBSD.org) - за настройку и администрирование
     списков рассылки CTM

<li> Bob Beck (beck@OpenBSD.org), Artur Grabowski (art@OpenBSD.org),
     Magnus Holmberg (mho@OpenBSD.org) и
     Wolfram Schneider (wosch@FreeBSD.org) - за настройку ftp-сервера для
     базовых наборов и дельт на ctm.*OpenBSD.org

<li> Thomas Graichen (graichen@OpenBSD.org) - за поддержку CTM в OpenBSD
     и сопровождение ее все эти годы.
     
<li> Wim Vandeputte (wvdputte@OpenBSD.org) - за содержание CTM

<li> ... и всем другим, кто помогал косвенно
</ul>


<p>
Логотип OpenBSD/CTM для проекта OpenBSD создал
   <a href="mailto:flipk@openbsd.org">Phillip F Knaack</a>.
<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../back.gif" border="0" alt="OpenBSD" /></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: ctm.html,v 1.16 ]<br>
$RuOBSD$<br> 
$Translation: ctm.html,v 1.1.1.1 2001/08/28 21:15:57 dfa Exp $<br>
$OpenBSD$
</small>

</body>
</html>
