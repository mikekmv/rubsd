<!DOCTYPE HTML PUBLIC  "-//IETF//DTD HTML Strict Level 2//EN//2.0">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=koi8-r">
<title>Криптография в OpenBSD</title>
<link rev=made href=mailto:www@openbsd.org>
<meta name="resource-type" content="document">
<meta name="description" content="Криптография в OpenBSD">
<meta name="keywords" content="openbsd,криптография,openssh,openssl,kerberos">
<meta name="keywords" content="ipsec,photuris,isakmp,ike,blowfish,des,rsa,dsa">
<meta name="distribution" content="global">
<meta name="copyright" content="This document copyright 1997-2001 by OpenBSD.">
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#23238E">

<img align=left alt="[OpenBSD]" height=166 width=197 SRC="../../images/blowfish-notext.jpg">
<br>
<br>
<br>
"Любой хороший инженер по безопасности знает: "Безопасность -
это не продукт, а процесс." Это больше чем встраивание сильной криптографии
в систему, это - разработка системы с учетом всех критериев безопасности,
включая криптографию, для эффективной работы всей системы в целом."<br>
<br>
-- Брюс Шнайер, автор книги "Прикладная криптография".
<br clear="all">
<h2><font color="#e00000">Криптография</font><hr></h2>

<strong>Содержание</strong><br>
<a href=#why>Почему мы используем криптографию?</a>.<br> 
<a href=#ssh>OpenSSH</a>.<br> 
<a href=#prng>Генераторы псевдо-случайных чисел</a> (PRNG): ARC4, ...<br>
<a href=#hash>Криптографические хэш-функции</a>: MD5, SHA1, ...<br>
<a href=#trans>Криптографические преобразования</a>: DES, Blowfish, ...<br>
<a href=#hardware>Поддержка криптографического аппаратного обеспечения</a><br>
<a href=#people>International Cryptographers wanted</a><br>
<a href=#papers>Ссылки</a><br>
<p>
<hr>

<a name=why></a>
<h3><font color=#e00000>Почему мы используем криптографию?</font></h3><p>

В трех словах:  <strong>потому что можем</strong>.<p>

Проект OpenBSD расположен в Канаде.<p>

<a href="../ECL.html">Список Контроля за Экспортом Канады</a>
не содержит никаких важных ограничений на экспорт криптографического
программного обеспечения, и даже более определенна по отношению к
экспорту свободно-распространяемого криптографического программного
обеспечения.

Марк Пламб (Marc Plumb) провел
<a href="http://insight.mcmaster.ca/org/efc/pages/doc/crypto-export.html">
некоторые исследования в области криптографического законодательства</a>.
<p>
В этой связи в рамках проекта OpenBSD криптография получила широкое
распространение в операционной системе.

Наше обязательное условие, чтобы криптографическое программное обеспечение,
которое мы используем, было <a href="policy.html">свободно распространяемым
и с соответсвующими лицензиями</a>.
Мы не используем криптографические алгоритмы с ограничительными патентами.
Мы так же требуем чтобы данная категория программного обеспечения была произведена 
в странах с пригодной лицензией для экспорта, потому что мы не хотим нарушать
законы других стран. Криптографические компоненты, которые мы используем,
написаны в Аргентине, Австралии, Канаде, Германии, Греции, Норвегии,
и Швеции.
<p>

Когда мы создаем очередные дистрибутивы или промежуточные версии
операционной системы OpenBSD, мы делаем это в странах, из которых
исходный и двоичный код может быть свободно доступен. В последнее время
наши дистрибутивы собораются в Канаде, Швеции и Германии.<p>


OpenBSD поставляется вместе с Kerberos IV. Базовый код, который
мы используем - это доступный для экспорта версия, на базе KTH из Швеции.
Наши исхидные коды X11 так же доработнаны для использования Kerberos IV.<p>

Следующая версия OpenBSD будет поставляться с реализацией Kerberos V,
так же от KTH из Швеции.
<p>


<img align=right src="../images/vpnc-test-partner.gif">
OpenBSD стала первой операционной системой, поставляющейся с встроенным
стеком IPSec, который впервые был включен в OpenBSD 2.1 в 1997.

Наша матрица стека IPsec, с аппаратным ускорением
на различных картах,
с демоном ISAKMP, используются на
одной из машин испытательного стенда IPsec, запущенного
<a href="http://www.vpnc.org">VPNC</a>.
<br clear=all>
<p>

Сегодня криптография - это важный аспект в улучшении <a
href="security.html">безопасности</a> операционной системы.
Криптографию, используемую в OpenBSD, можно разделить на две
части, как показано ниже.<p>

<a name="ssh"></a>
<h3><font color=#e00000>OpenSSH</font></h3><p>

Что чаще всего делают люди после установки OpenBSD?
Устанавливают Secure Shell
(<a href=http://www.openbsd.org/cgi-bin/man.cgi?query=ssh>ssh</a>)
из дерева портов или пакет, взятый с одного из сайтов.<p>

Начиная с версии 2.6, OpenBSD включает
<a href="http://www.openssh.com/">OpenSSH</a>, свободнораспространяемую
и патентонезависимую версию ssh.  
<a href="http://www.openssh.com/">OpenSSH</a> работает с протоколом версии
1 и включает множество улучшений,	
<ul>
<li>
все компоненты, имеющие ограничения(например, патентное, см.
<a href=http://www.openbsd.org/cgi-bin/man.cgi?query=ssl>ssl</a>))
были удалены из кода системы, все лицензированные или патентованые
компоненты используют внешние библиотеки.
</li>
<li>
добавлены обновления для работы с протоколом 1.5.
</li>
<li>
добавлена поддержка аутентификации и передачи билетов в
<a href=http://www.openbsd.org/cgi-bin/man.cgi?query=kerberos>kerberos</a>
</li>
<li>
добавлена поддержка одноразовой аутентификации с помощью
<a href=http://www.openbsd.org/cgi-bin/man.cgi?query=skey>skey</a>.
</li>
</ul>
<p>

Грубо говоря, мы взяли свободнораспространяемую версию ssh и привели
ее к стандартам OpenBSD. Мы нашли способ использовать RSA не нарушая 
патента, предоставляя возможность автоматической загрузки и установки
пакета, содержащего библиотеки libcrypto и libssl с RSA-кодом. Эти
пакеты основаны на коде OpenSSL. Люди, живущие за пределами США, 
могут свободно использовать эти библиотеки, в то время как люди, 
живущие в США могут использовать их в некоммерческих целях.

Вобщем-то компании в США так же могут использовать  RSA, так как 
этот алгоритм применяется для второстепенных целей.<p>

<strong>НОВИНКА!  OpenSSH поддерживает протокол 2.0!</strong><p>

Недавно мы добавили в OpenSSH поддержку протокола  SSH 2. Таким образом, 
наш новый демон sshd теперь поддерживает  протоколы (1.3, 1.5, 2.0) и 
обладает большей гибкостью нежели раньше. Протокол 2.0 не использует 
RSA для собственных нужд, замещая его алгоритмами DH и DSA. Поэтому, 
начиная с версии 2.7 OpenBSD поставляется вместе с пакетом OpenSSH. 
Если вы хотите так же поддерживать протоколы 1.3 и 1.5, вам необходимо 
установить пакет RSA (процесс установки описан в электронном руководстве
<a href=http://www.openbsd.org/cgi-bin/man.cgi?query=ssl>ssl</a>
) и перезапустить демона ssh.

<a name=prng></a>
<h3><font color=#e00000>Генераторы псевдо-случайных чисел</font></h3><p>

Генераторы псевдо-случайных чисел (PRNG) предоставляют приложениям
поток чисел, которые облядают рядом важных свойств, используемых в
системе безопасности:<p>

<ul>
<li>Посторонний человек не должен иметь возможность предсказать
результат работы генератора псевдослучайных чисел даже если он знает
предыдущий разультат.
<li>Сгенерированные числа не должны иметь повторяющихся блоков, что
подразумевает что PRNG должны иметь очень большую длину цикла генерации.
</ul>
<p>

Как правило, PRNG - это просто алгоритм в котором одни и те же 
стартовые значения будут вырабатывать одну и ту же последовательность
на выходе. В многопользовательской системе существует множество
источников для начальных значений PRNG. Ядро OpenBSD использует прерывания 
от мыши, задержки в сетевых устройствах, задержки нажатия клавиш и информации 
дискового ввода/вывода для заполнения пула энтропии.
Случайные числа используются ядром и предоставляются пользовательским программам 
через специальные устройства.

Случайные числа исползуются в следующих задачах:<p>

<ul>
<li>Динамическое распределение sin_port allocation в bind(2).
<li>Генерация PID процессов.
<li>Формирование ID дейтаграм IP.
<li>Формирование ID транзакций RPC(XID).
<li>Формирование ID транзакций NFS RPC (XID).
<li>Формирование Query-ID для DNS.
<li>Генерация номеров inode, см. getfh(2) и fsirand(8).
<li>Синхронизация возмущений в traceroute(8).
<li>Улучшенная генерация временных имен для mktemp(3) и mkstemp(3)
<li>Различные улучшения в TCP ISS для защиты от спуфинга.
<li>Используется в IPsec для внутренних нужд.
<li>Генерация случайных последовательностей при шифровании паролей.
<li>Использование в S/Key.
<li>В <a href=http://www.physnet.uni-hamburg.de/provos/photuris/>photurisd</a> 
        и <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd>isakmpd</a>
        для предоставления устойчивого обмена ключами.
</ul>

<p>
<a name=hash></a>
<h3><font color=#e00000>Криптографические хэш-функции</font></h3><p>

Хэш-функция преобразует входные данные в строку заданной длинны, значение 
которой постоянно. Для криптографических хэш-функции очень сложно найти:

<ul>
<li>два потока данных с одинаковым результатом преобразования
<li>два разных вхадных потока с одиныкавым выходным результатом 
</ul>
<p>

В OpenBSD из криптографических хэш-функций используются MD5, SHA1 и RIPEMD-160:<p>
<ul> 
<li>В <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=skey>S/Key</a>
    для создания одноразовых паролей.
<li>В <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec>IPsec</a>,
    <a href=http://www.physnet.uni-hamburg.de/provos/photuris/>photurisd</a>
    и
    <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd>isakmpd(8)</a>
    для аутентификации источника данных и обеспечения целостности данных.
<li>Для паролей, совместимых с FreeBSD (по умолчанию не используется), см.
    <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=passwd.conf&sektion=5>
    passwd.conf(5)</a>
<li>Для поддержки идентификатора TCP SYN (по умолчанию отключено), см.
    <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4>
    options(4)</a>
<li>В libssl для цифровой подписи сообщений.
</ul>
<p>

<p>
<a name="trans"></a>
<h3><font color=#e00000>Криптографические преобразования</font></h3><p>

Криптографические преобразования используются для шифрации и дешифрации
данных. Обычно для этого используются один ключ для шифровки и один ключ 
для дешифровки данных. Безопасность криптографических преобразований должна
полагаться только на содержимое ключа.<p>

OpenBSD поддерживает алгоритмы DES, 3DES, Blowfish и Cast, используемых 
ядром и пользовательскими программами:<p>
<ul>
<li>в libc для создания паролей, преобразованных
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=blf_key">Blowfish</a>
    .  См. так же <a href="../papers/bcrypt-paper.ps">доклад USENIX</a>
    по этому вопросу.
<li>в
    <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec>IPsec</a>
    для конфидециальной передачи данных на сетевом уровне.
<li>в Kerberos и подобных приложениях, таких как
    <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=telnet>telnet</a>,
    <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=cvs>cvs</a>,
    <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=rsh>rsh</a>,
    <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=rcp>rcp</a>,
    и
    <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=rlogin>rlogin</a>.
<li>в <a href=http://www.physnet.uni-hamburg.de/provos/photuris/>
    photurisd</a> and
    <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd>isakmpd</a>
    для защиты обмена данными, при обмене содержимым ключа IPsec.
<li>в AFS для защиты сообщений, передаваемых по сети, для предоставления
    конфидециальности доступа к удаленной файловой системе.
<li>в libssl для предоставления приложениям возможности связи по защищенному
    протоколу SSL.
</ul>

<p>
<a name=hardware></a>
<h3><font color=#e00000>Аппаратная поддержка криптографии</font></h3><p>

Начиная с версии 2.7, OpenBSD поддерживает криптографическое аппаратное
обеспечение: акселераторы и генераторы случайных чисел.
<ul>
<li><b>IPsec crypto dequeue</b><br>
    Наша реализация стека IPsec устроена таким образом, что криптографические
    функции вынесены за пределы основного кода. Большинству ПО необходимо использовать
    стек для обработки каждого пакета. Для оптимального и оперативного использования 
    аппаратных средств необходимо разъединить эти два компонента, что мы и сделали. 
    Кроме того, использование этого же принципа дает прирост производительности и для 
    программных компонент.
<p>
<li><b><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hifn&sektion=4">
    Hifn 7751</a></b><br>
    Карты, использующие чипсет Hifn 7751 можно использовать в качестве
    ускорителей симметричной криптографии (например, как в
    <a href="http://www.powercrypt.com">PowerCrypt</a>).
    Текущая производительность при использовании одного Hifn 7751 
    на каждом конце туннеля составляет 64Мбит/сек для алгоритмов 3DES/SHA1 ESP,
    примерно 600-кратное ускорение по сравнению с процессором P3/550 CPU.
    В дальнейшем предполагается провести ряд улучшений над кодом, который
    признан стабильным 13 апреля 2000. Мы разработали свой собственный
    драйвер для поддержки этого чипа, отличный от разработанного в США драйвера от
    <a href="http://www.powercrypt.com">PowerCrypt</a>, который, к тому же,
    корректно работает с нашим стеком IPsec. На сегондяшний день, согласно стандарту
    отрасли, чип 7751 считается медленным, и многие производители имеют более быстрые
    чипы (даже сама Hifn имеет более быстрый чип).
    <p>
    (К сожалению очень сложно сотрудничать с компанией, которая пытается угрожать
     даже тем разработчикам, работающим с этим чипом, которые находятся за пределами США).
    <p>

<li><b>Hifn 6500</b><br>
    Это устройство представляет собой блок ассиметричного шифрования. Он
    поддерживает алгоритмы RSA, DSA и DH на ряду с большинством основных 
    функция работы с большими числами. Так же он содержит высокопроизводительный
    генератор случайных чисел. Проект обладает одним таким устройством, с 
    полной документацией и примерами кода, однако поддержка его еще не начата.
    <p>

<li><b><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ubsec&sektion=4">
    Broadcom BCM5805 (или beta-чип Bluesteelnet 5501)</a></b><br>
    Сразу после выпуска  OpenBSD 2.7, мы добавили поддержку некоторых
    блоков, предоставленных производителем, тестового чипа 5501 и старше.
    Это устройство обладает самой высокой производительностью среди устройств
    симметричного шифрования из всех виденных нами.
    <p>
    Bluesteelnet была куплена компанией Broadcom, которая вскоре начала выпускать 
    продукцию хорошего качества. 
    Их новый чип BCM5805 аналигочен предыдущему, за исключением того, что в 
    него добавлено ядро для работы с алгоритмами RSA, DSA и аналогичными.
    <p>

    Люди, работающие в Broadcom/Bluesteelnet оказались хорошими партнерами. Они
    предоставили нам полную документацию и примеры кода для своих чипов и необходимое 
    количество карт для тестов.
    <p>
    После выхода 2.8 этот драйвер  был модифицирован для работы с генератором
    случайных чисел на чипсете BCM5805 и аналогах, и посылки результатов генерации в пул 
    ядра.
    <p>

<li><b><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ises&sektion=4">
    Securealink PCC-ISES</a></b><br>
    <a href="http://www.securealink.com/pcc-ises.html">PCC-ISES</a> это новый чипсет,
    разработанный в Нидерландах. Мы получили необходимую аппаратуру и документацию и 
    работаем над драйвером устройства. В настоящее время драйвер умеет посылать 
    сгенерированные случайные числа в соответсвующий пул ядра.
    <p>
	
<li><b>SafeNet SafeXcel 2141</b><br>
    Мы получили документации и примеры кода для криптографических карт
    <a href="http://www.safenet-inc.com/technology/chips/Chip2141.asp">SafeNet</a>.
    Идет работа над поддержкой как минимум симметричной криптографии этих устройств.
    <p>

<li><b><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=txp&sektion=4">
    3com 3c990</a></b><br>
    3com предоставила нам драйвер для поддержки компонент этого чипсета и,
    отталкиваясь от него, мы разработали собственный драйвер ethernet.  В
    настоящее время, с момента интеграции этого драйвера мы имеем лицензию
    на работу с микрокодом. Так же мы получили информацию, необходимую для
    поддержки криптографических функций, которые требуют небольшой перестройки
    нашего стека. Следите за новостями...
    <p>

<li><b>Карта Intel IPsec</b><br>
    Несмотря ни на что, Intel, в отличие от других производителей, твердо
    решила не предоставлять нам документацию для своих сетевых компонентов.
    Мы говорили об этом с пятью инженерами, которые задействованы с разработке
    этих компонентов. Они все хотели, чтобы мы получили документацию. Однако
    их руки связаны менеджерами, которые против этой затеи. Забудьте о Intel.
    (Если вы хотите купить аппаратуру для Gigabit Ethernet,мы рекомендуем
    обратиться к кому-нибуть еще... по той же причине: большинство драйверов,
    которые есть у нас для сетевых устройств Intel были написаны без документации).
    <p>

<li><b><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pchb&sektion=4">
    Intel 82802AB/82802AC Firmware Hub RNG</a></b><br>
    Чип 82802 FWH (установлен на материнских платах i810, i820, i840, 
    i850 и i860) содержит в себе генератор случайных чисел (RNG).  
    Высокопроизводительный стек IPsec для своей работы требует достаточно 
    большой числовой энтропии. Начиная с 10 апреля 2000, мы начали 
    поддерживать этот чип. Так же мы планируем добавить поддержку для других
    генераторов случайных чисел, найденных в других крипточипах.
    <p>

<li><b>OpenSSL</b><br>
    OpenBSD поддерживает криптографические карты, которые работают с 
    алгоритмами RSA и DSA и может предоставлять функции всех подобных
    карт пользовательским программам (таким как, <a href="http://www.openssh.com">ssh</a>,
    <a href="http://www.modssl.org/">apache https</a>, и другим).
    .
</ul>

<p>
<b>Если кто-нибудь хочет помочь в написании драйверов -
<a href=#people>милости просим!</a>.</b>

<p>
<a name=people></a>
<h3><font color=#e00000>Требуются криптографы</font></h3><p>

Конечно, наш проект нуждается в людях готовых работать над криптографией 
в системе. Желающие принять участие в проекте, которые не являются 
гражданами Америки и  удовлетворяют приведенным выше требованиям, 
могут связаться с нами.<p>

<p>
<a name=papers></a>
<h3><font color=#e00000>Дополнительная литература</font></h3><p>

Членами команды OpenBSD был написан ряд документов о криптографических
изменениях, которые они сделали в системе. Эти документы доступны в формате
postscript.<p>

<ul>
<li>A Future-Adaptable Password Scheme.<br>
    <a href=../events.html#usenix99>Usenix 1999</a>,
    <a href=mailto:provos@openbsd.org>Niels Provos</a>,
    <a href=mailto:dm@openbsd.org>David Mazieres</a>.<br>
    <a href=../papers/bcrypt-paper.ps>доклад</a> и
    <a href=../papers/bcrypt-slides.ps>слайды</a>.
<p>
<li>Криптография в OpenBSD: обзор.<br>
    <a href=../events.html#usenix99>Usenix 1999</a>,
    <a href=mailto:deraadt@openbsd.org>Theo de Raadt</a>,
    <a href=mailto:niklas@openbsd.org>Niklas Hallqvist</a>,
    <a href=mailto:art@openbsd.org>Artur Grabowski</a>,
    <a href=mailto:angelos@openbsd.org>Angelos D. Keromytis</a>,
    <a href=mailto:provos@openbsd.org>Niels Provos</a>.<br>
    <a href=../papers/crypt-paper.ps>доклад</a> и
    <a href=../papers/crypt-slides.ps>слайды</a>.
<p>
<li>Реализация обмена ключами через Интернет (IKE).<br>
    <a href=../events.html#usenix2000>Usenix 2000</a>,
    <a href=mailto:niklas@openbsd.org>Niklas Hallqvist</a> и
    <a href=mailto:angelos@openbsd.org>Angelos D. Keromytis</a>.<br>
    <a href=../papers/ikepaper.ps>доклад</a> и
    <a href=../papers/ikeslides.ps>слайды</a>.
<p>
<li>Криптование виртуальной памяти</a><br>
    <a href=../events.html#sec2000>Usenix Security 2000</a>,
    <a href=mailto:provos@openbsd.org>Niels Provos</a>.<br>
    <a href=../papers/swapencrypt.ps>доклад</a> и
    <a href=../papers/swapencrypt-slides.ps>слайды</a>.
</ul>

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../back.gif" border="0" alt="OpenBSD"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>Originally [OpenBSD: crypto.html,v 1.91 ]<br>
$RuOBSD: crypto.html,v 1.1 2002/04/26 08:59:43 cruz Exp $<br>
$Translation$<br>
$OpenBSD$
</small>

</body>
</html>
