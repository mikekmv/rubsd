$RuOBSD: README,v 1.1.1.1 2004/04/05 10:25:19 form Exp $

    Усовершенствованный вариант LKM для запрещения процессам просмотра
информации о чужих процессах. Данный вариант грузится как устройство и
создает ноду /dev/hproc для управления.  Во время выгрузки модуля нода
автоматически удаляется.  Управление  производится  утилитой hprocctl.
Модуль не влияет на запросы информации, сделанные процессами с правами
root.


Сборка и установка модуля и программы управления:

# make depend && make && make install

Загрузка модуля (kernel securelevel должен быть меньше 1):

# modload /usr/lkm/hproc.o

Выгрузка модуля (kernel securelevel должен быть меньше 1):

# modunload -n hproc


Формат команды hprocctl:

usage: hprocctl [-DE] [[!]group]

-D	- запретить работу модуля
-E	- разрешить работу модуля
group	- имя или номер группы для которой разрешен (запрещен,  если в
	  начале стоит знак '!') просмотр чужих процессов.

    Если не указан ни один  параметр,  программа распечатывает текущее
состояние модуля. Проверка группы осуществляется по всему списку групп
процесса, запросившего информацию о процессах.


Примеры:

# hprocctl operator
	- только члены группы operator могут запрашивать информацию  о
	  чужих процессах

# hprocctl \!users
	- только члены группы users не могут запрашивать  информацию о
	  чужих процессах (обратный слэш нужен для всяких вумных shell
	  которые воспринимают '!' как специальный символ)

# hprocctl -D
	- запрещает работу модуля (все  могут  смотреть  информацию  о
	  чужих процессах)

# hprocctl -E
	- разрешает работу модуля

# hprocctl
	- распечатывает текущее состояние модуля


Техническая информация:

    Модуль загружается  в  память  как  LKM  типа  DEV,  устанавливает
фильтры для системных вызовов kill и sysctl и создает ноду /dev/hproc.
Устройство /dev/hproc поддерживает следующие ioctl (определены в файле
hproc.h):

ioctl(fd, HIOCGFLAGS, (u_int32_t *)&flags)
	- получить флаги модуля

ioctl(fd, HIOCSFLAGS, (u_int32_t *)&flags)
	- установить флаги модуля

ioctl(fd, HIOCGGID, (gid_t *)&gid)
	- получить GID для которого разрешен (запрещен) просмотр чужих
	  процессов

ioctl(fd, HIOCSGID, (gid_t *)&gid)
	- установить GID для  которого  разрешен  (запрещен)  просмотр
	  чужих процессов

Флаги, используемые в HIOCGFLAGS/HIOCSFLAGS:

HPF_ENABLED
	- если установлен - модуль разрешен, иначе запрещен)

HPF_DENYGID
	- если установлен - только процессы с  правами  GID  не  могут
	  получать информацию о чужих процессах, иначе только процессы
	  с правами GID могут получать информацию о чужих процессах
