$RuOBSD: README,v 1.4 2003/05/16 07:31:06 form Exp $

nuBo v0.1alpha - краткое описание
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Предупреждение
--------------
  Как обычно, сразу предупреждаю,  что весь  мой  софт  для  UNIX-подобных
систем мной поддерживаться не будет. ;)
  Однако народ из проекта OpenBSD.ru грозился заняться этим вопросом,  так
что все вопросы - в support@openbsd.ru.

Чё это за фигня
---------------
  Так уж повелось что за последнее время все что я писал под UNIX-подобные
системы чем-то напоминают спиртные напитки и все что к ним относится... :)
Не будем нарушать  традицию.  Итак,  nuBo - набор  программ  для  подсчета
трафика.
  Набор  nuBo был задуман  как...  А никак...  Он вообще  не был задуман в
принципе  и  появился  просто от нехрен делать. :)  Ну раз уж он появился,
немного расскажу о том что и как...
  Набор  программ  nuBo  на  данный  момент  состоит из программы подсчета
трафика  trafd  и  программы  trafstat,  предназначенной  для   распечатки
собранной  информации  для  дпльнейшего  использования  в  системах  учета
трафика, билинга итд...  Возможно кто-нибудь возьмется совместить это дело
с системой CaMoroH дабы получить вполне законченное решение. :)
  Основные отличия от других подобного рода программ состоят  в  том,  что
статистика во  время  работы  программы  хранится  в  binary  search  tree
(собственно именно отсюда и ростут ноги: просто  мне  захотелось  rb  tree
поиграться и трафик - первое что мне взбрело в  голову  туда запихать),  а
также  в  том,  что  nuBo  нормально  работает  в  OpenBSD  с  tun  и  gif
интерфейсами.

  Что еще можно сказать...  Можно сказать что на данный момент все это еще
мало похоже на готовый продукт, хотя и пригодно для  использования  и  что
работы тут еще... Кое-что пока реализовано такими способами,  за которые я
бы обматерил любого другого. :)))

Установка
---------

  Компиляция и  установка  программы  очень  проста.  Прежде  всего  можно
заглянуть в файл Makefile.inc и поправить CFLAGS под свои нужды:

-DINET6		- включить поддержку IPv6
-DNOPORTS	- не включать в статистику номера TCP/UDP портов

Далее скомпилировать и установить все это:

# make depend && make && make install

Добавить  в  /etc/master.passwd  запись для пользователя  trafd.  Домашний
каталог данного пользователя является каталогом,  куда будут  записываться
PID файлы и сбрасываться dump файлы трафика.

trafd:*:32761:32761::0:0:Traffic collector:/var/trafd:/sbin/nologin

Добавить группу trafd в /etc/group

trafd:*:32761:

Создать домашний каталог

# install -o trafd -g trafd -m 750 -d /var/trafd

Запуск
------

trafd [-dOp] [-i interface] [expression]

-d	- не даемониться, syslogиться на stderr
-O	- не включать оптимизер
-p	- не ставить в promisc mode

expression - стандартные tcpdump expression

pidfile:	/var/trafd/trafd-<interface>.pid
dumpfile:	/var/trafd/traffic.<interface>

Думп генерится по достаточному заполнению таблицы или по SIGHUP, а также
по завершению по SIG{KILL,QUIT,INT}. В syslog при этом можно посмотреть
число пакетов и потери если они есть.

Прога set[ug]iдится на trafd:trafd и цхроотится в /var/trafd.

Просмотр думпа
--------------

trafstat [-nP][-f family ][-p protocol] interface
(пока недоделан - не разбирает timestamps итд)

-n		- выводить номер протокола вместо названия
-P		- не писать номера портов
-f family	- выводить статистику для данной аф (inet/inet6)
-p protocol	- выводить статистику для данного протокола

формат вывода:	bytes protocol src[:port] dst[:port]

------------------------------ цут хере ----------------------------------

ЦОПЫРИГХТ (Ц) 2003 ОЛЕГ САФИУЛЛИН <ФОРМЮПДП11.ОРГ.РУ>
АЛЛ РИГХТС РЕСЕРЖЕД.

РЕДИСТРИБУТИОН  АНД  УСЕ  ИН  СОУРЦЕ  АНД  БИНАРЫ  ФОРМС,  ВИТХ ОР ВИТХОУТ
МОДИФИЦАТИОН,  АРЕ  ПЕРМИТТЕД  ПРОЖИДЕД  ТХАТ  ТХЕ  ФОЛЛОВИНГ   ЦОНДИТИОНС
АРЕ МЕТ:
1. РЕДИСТРИБУТИОНС  ОФ  СОУРЦЕ ЦОДЕ МУСТ РЕТАИН ТХЕ АБОЖЕ ЦОПЫРИГХТ НОТИЦЕ
   УНМОДИФИЕД, ТХИС ЛИСТ ОФ ЦОНДИТИОНС, АНД ТХЕ ФОЛЛОВИНГ ДИСЦЛАИМЕР.
2. РЕДИСТРИБУТИОНС  ИН  БИНАРЫ  ФОРМ  МУСТ  РЕПРОДУЦЕ  ТХЕ АБОЖЕ ЦОПЫРИГХТ
   НОТИЦЕ,  ТХИС  ЛИСТ  ОФ  ЦОНДИТИОНС АНД ТХЕ ФОЛЛОВИНГ ДИСЦЛАИМЕР ИН ТХЕ
   ДОЦУМЕНТАТИОН АНД/ОР ОТХЕР МАТЕРИАЛС ПРОЖИДЕД ВИТХ ТХЕ ДИСТРИБУТИОН.

ТХИС СОФТВАРЕ ИС ПРОЖИДЕД БЫ ТХЕ АУТХОР АНД ЦОНТРИБУТОРС ``АС ИС'' АНД АНЫ
ЕЬПРЕСС  ОР ИМПЛИЕД ВАРРАНТИЕС, ИНЦЛУДИНГ, БУТ НОТ ЛИМИТЕД ТО, ТХЕ ИМПЛИЕД
ВАРРАНТИЕС  ОФ  МЕРЦХАНТАБИЛИТЫ  АНД  ФИТНЕСС ФОР А ПАРТИЦУЛАР ПУРПОСЕ АРЕ
ДИСЦЛАИМЕД. ИН НО ЕЖЕНТ СХАЛЛ ТХЕ АУТХОР ОР ЦОНТРИБУТОРС БЕ ЛИАБЛЕ ФОР АНЫ
ДИРЕЦТ, ИНДИРЕЦТ, ИНЦИДЕНТАЛ, СПЕЦИАЛ, ЕЬЕМПЛАРЫ, ОР ЦОНСЕЯУЕНТИАЛ ДАМАГЕС
(ИНЦЛУДИНГ,  БУТ  НОТ  ЛИМИТЕД  ТО,  ПРОЦУРЕМЕНТ  ОФ  СУБСТИТУТЕ  ГООДС ОР
СЕРЖИЦЕС; ЛОСС ОФ УСЕ, ДАТА, ОР ПРОФИТС; ОР БУСИНЕСС ИНТЕРРУПТИОН) ХОВЕЖЕР
ЦАУСЕД  АНД  ОН  АНЫ  ТХЕОРЫ  ОФ  ЛИАБИЛИТЫ,  ВХЕТХЕР  ИН ЦОНТРАЦТ, СТРИЦТ
ЛИАБИЛИТЫ,  ОР ТОРТ (ИНЦЛУДИНГ НЕГЛИГЕНЦЕ ОР ОТХЕРВИСЕ) АРИСИНГ ИН АНЫ ВАЫ
ОУТ  ОФ  ТХЕ  УСЕ  ОФ ТХИС СОФТВАРЕ, ЕЖЕН ИФ АДЖИСЕД ОФ ТХЕ ПОССИБИЛИТЫ ОФ
СУЦХ ДАМАГЕ.
