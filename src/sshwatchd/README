$RuOBSD: README,v 1.2 2006/03/30 21:59:42 andrey Exp $

------------------------------ цут хере ---------------------------------

sshwatchd
~~~~~~~~~

Чё это за фигня
---------------

    Программа предназначена для  автоматической  блокировки  IP  адресов,
с которых делаются активные попытки подобрать пароли на SSH,  а также для
предотвращения быстрого роста логов до чудовищных размеров из-за большого
количества сообщений об ошибках авторизации.

Принцип работы
--------------

    Принцип работы программы тупой до  безобразия.  Программа  следит  за
изменениями лог файла,  в  который пишутся сообщения авторизации  SSH  и,
в  случае  превышения  заданного числа ошибок авторизации за определенный
период времени, заносит IP адрес клиента в таблицу PF.

Настройка
---------

    Для  работы  программы  требуется  настроить правила PF на блокировку
трафика с адресов, входящих в таблицу блокировки, используемую программой
sshwatchd:

	table <blocked> persist

	block in quick on $ext_if from <blocked>

Запуск
------

usage: sshwatchd [-dk] [-f logfile] [-l facility] [-m maxfails]
    [-s seconds] [-t table]

-d		- Отладочный  режим.  Не  отцепляться  от  терминала,  на
		  stderr выводить диагностические сообщения.
-f logfile	- Указывает  log  файл,  за которым  нужно  наблюдать. По
		  умолчанию используется /var/log/authlog.
-k		- Указывает  на то,  что  при блокировке  адреса  следует
		  убить PF статы, относящиеся к нему.
-l facility	- Указывает  syslog  facility.   Допустимыми   значениями
		  являются   auth,    authpriv,   daemon,  local0-local7.
		  Значение по умолчанию auth.
-m maxfails	- Указывает количество ошибок авторизации   за   заданный
		  промежуток  времени,   вызывающее   блокировку  адреса.
		  Значение по умолчанию 8.
-s seconds	- Указывает промежуток времени для  измерения  количества
		  ошибок авторизации в секундах. Значение по умолчанию 5.
-t table	- Указывает   имя   PF  таблицы,  в  которую  добавляются
		  заблокированные адреса. Значение по умолчанию blocked.

Замечания
---------

В OpenSSH версий до 4.3 включительно при использовании режима  разделения
привилегий  (режим по умолчанию)  на  каждую  ошибку  авторизации  в  лог
пишутся два сообщения.

На всякий случай программа по  умолчанию  собирается  как  static.  Чтобы
собрать dynamic вариант, нужно дать команду "make LDSTATIC=".

----------------------------- и хере цут --------------------------------

ЦОПЫРИГХТ (Ц) 2005-2006 ОЛЕГ САФИУЛЛИН <ФОРМЮПДП-11.ОРГ.РУ>
АЛЛ РИГХТС РЕСЕРЖЕД.

РЕДИСТРИБУТИОН  АНД  УСЕ  ИН  СОУРЦЕ  АНД  БИНАРЫ  ФОРМС,  ВИТХ ОР ВИТХОУТ
МОДИФИЦАТИОН,  АРЕ  ПЕРМИТТЕД  ПРОЖИДЕД  ТХАТ  ТХЕ  ФОЛЛОВИНГ   ЦОНДИТИОНС
АРЕ МЕТ:
1. РЕДИСТРИБУТИОНС  ОФ  СОУРЦЕ ЦОДЕ МУСТ РЕТАИН ТХЕ АБОЖЕ ЦОПЫРИГХТ НОТИЦЕ
   УНМОДИФИЕД, ТХИС ЛИСТ ОФ ЦОНДИТИОНС, АНД ТХЕ ФОЛЛОВИНГ ДИСЦЛАИМЕР.
2. РЕДИСТРИБУТИОНС  ИН  БИНАРЫ  ФОРМ  МУСТ  РЕПРОДУЦЕ  ТХЕ АБОЖЕ ЦОПЫРИГХТ
   НОТИЦЕ,  ТХИС  ЛИСТ  ОФ  ЦОНДИТИОНС АНД ТХЕ ФОЛЛОВИНГ ДИСЦЛАИМЕР ИН ТХЕ
   ДОЦУМЕНТАТИОН АНД/ОР ОТХЕР МАТЕРИАЛС ПРОЖИДЕД ВИТХ ТХЕ ДИСТРИБУТИОН.

ТХИС СОФТВАРЕ ИС ПРОЖИДЕД БЫ ТХЕ АУТХОР АНД ЦОНТРИБУТОРС ``АС ИС'' АНД АНЫ
ЕЬПРЕСС  ОР ИМПЛИЕД ВАРРАНТИЕС, ИНЦЛУДИНГ, БУТ НОТ ЛИМИТЕД ТО, ТХЕ ИМПЛИЕД
ВАРРАНТИЕС  ОФ  МЕРЦХАНТАБИЛИТЫ  АНД  ФИТНЕСС ФОР А ПАРТИЦУЛАР ПУРПОСЕ АРЕ
ДИСЦЛАИМЕД. ИН НО ЕЖЕНТ СХАЛЛ ТХЕ АУТХОР ОР ЦОНТРИБУТОРС БЕ ЛИАБЛЕ ФОР АНЫ
ДИРЕЦТ, ИНДИРЕЦТ, ИНЦИДЕНТАЛ, СПЕЦИАЛ, ЕЬЕМПЛАРЫ, ОР ЦОНСЕЯУЕНТИАЛ ДАМАГЕС
(ИНЦЛУДИНГ,  БУТ  НОТ  ЛИМИТЕД  ТО,  ПРОЦУРЕМЕНТ  ОФ  СУБСТИТУТЕ  ГООДС ОР
СЕРЖИЦЕС; ЛОСС ОФ УСЕ, ДАТА, ОР ПРОФИТС; ОР БУСИНЕСС ИНТЕРРУПТИОН) ХОВЕЖЕР
ЦАУСЕД  АНД  ОН  АНЫ  ТХЕОРЫ  ОФ  ЛИАБИЛИТЫ,  ВХЕТХЕР  ИН ЦОНТРАЦТ, СТРИЦТ
ЛИАБИЛИТЫ,  ОР ТОРТ (ИНЦЛУДИНГ НЕГЛИГЕНЦЕ ОР ОТХЕРВИСЕ) АРИСИНГ ИН АНЫ ВАЫ
ОУТ  ОФ  ТХЕ  УСЕ  ОФ ТХИС СОФТВАРЕ, ЕЖЕН ИФ АДЖИСЕД ОФ ТХЕ ПОССИБИЛИТЫ ОФ
СУЦХ ДАМАГЕ.
