$RuOBSD: README,v 1.3 2006/04/26 02:13:40 form Exp $

IRCyka 6
~~~~~~~~

IRCyka  6  представляет  из  себя IRC  бот,  расчитаный  на  испльзование
c ircd-hybrid.  С точки зрения IRC сервера IRCyka является  прилинкованым
IRC сервером, что требует дополнительных настроек ircd-hybrid.

Пример настройки ircd-hybrid 7.2:

connect {
	# Имя IRC сервера, которым будет представляться IRCyka.
	name = "caxap.home.lan";
	host = "caxap.home.lan";
	# Параметр send_password не используется, но должен
	# присутствовать.
	send_password = "Lak-Lak-Lak";
	accept_password = "Lak-Lak-Lak";
	encrypted = no;
	port = 6667;
	hub_mask = "*";
	class = "server";
};


Запуск
~~~~~~

usage: ircyka [-d] [-c conf_file] [-u user] [conf_name]

-c conf_file	- Задает файл конфигурации IRCyka.  По умолчанию  берется
		  ~/.ircyka/ircyka.conf.  Если  программа запускается  от
		  root, используется файл ~ircyka/ircyka.conf  (или ~user
		  если была использована опция -u).
-d		- Отладочный режим.  IRCyka не отцепляется от терминала и
		  выводит отладочную информацию и IRC протокол на stderr.
-u user		- Использовать учетную запись user  вместо  ircyka  (если
		  программа запускается от root).
conf_name	- Название   используемой   конфигурации.   По  умолчанию
		  используется конфигурация default.


Команды
~~~~~~~

Команды, помеченные (P) требуют nick флага +p.  Все команды можно  писать
IRCyk'е в приватном сообщении или на любом канале, обслуживаемом  IRCyka.
В последнем случае команда должна начинаться с  символа '!'.  Большинство
команд требуют регистрации в IRCyka (с помощью команды HEL).  Регистрация
остается в силе на протяжении всего соединения с сервером (не зависимо от
присутствия на каналах) или до выполнения команды BYE.

(P)	ABO
	- Очистить очередь IRC команд.

(P)	ACL <channel> [<nick> [+|-<flags>]]
	- Создать/просмотреть ACL для  <nick> на <channel>.  Если  <nick>
	  не указан, выводятся все ACL для <channel>.  ACL  для  которого
	  выключены все флаги автоматически удаляется.

(P)	ADD <nick> [+<flags>] <passwd>
	- Добавить <nick> с паролем <passwd> в базу данных.

(P)	BRO -a|-l|-n|<target> <message>
	- Передать сообщение <message> на <target>.  В качестве  <target>
	  может быть указан любой канал,  nick,  а также -a (все каналы),
	  -l (все залогиненые nick'и) и -n (все nick'и).

	BYE
	- Завершить сеанс.

(P)	DEL <nick>
	- Удалить <nick> из базы данных.

(P)	DIE [<message>]
	- Завершить работу IRCyka с сообщением <message>.

(P)	EXE <module> [<args>]
	- Вызвать загруженый модуль <module>.

	HEL [<nick>] <passwd>
	- Начать сеанс. Если <nick> не указан, используется IRC nick.

	HELP [<command>]
	- Распечатывает краткое  описание  команд  или  описание  команды
	  <command>. Для работы команды модуль help должен быть загружен.

	HIST [<channel>]
	- Распечатывает последние 20  сообщений  канала  <channel>.  Если
	  <channel>   не   указан,   распечатываются   сообщения   канала
	  на котором выдана  команда.  Для  работы  команды  должен  быть
	  загружен модуль history.

	INV <channel>
	- Запросить INVITE на <channel>.  Требует наличия ACL с флагом +i
	  или nick флаг +p.

(P)	JOI <channel>
	- Подключить IRCyka к <channel>.

(P)	LOA <module> [<args>]
	- Загрузить модуль <module>.

(P)	LOG [-|<target>]
	- Установить   канал/nick  <target>  для   приема   сообщений   о
	  регистрации nick'ов.

	LST [<nick>]
	- Распечатать список nick'ов,  находящихся в  базе  данных.  Если
	  указан <nick>, выводится только информация о <nick>.

	MAIL [<nick> [<message>]]
	- Отправить/просмотреть почтовое сообщение для  <nick>.  Просмотр
	 чужих  сообщений  требует  наличия  nick  флага +p.  Для  работы
	 команды должен быть загружен модуль mail.

(P)	MLS
	- Распечатать список загруженых модулей.

(P)	MOD <nick> [+|-<flags>] [<passwd>]
	- Изменить флаги или пароль для <nick>.

	NAM <nick> [<name>]
	- Установить/посмотреть полное имя для  <nick>.  Установка  имени
	  требует nick флага +p.

	OPE [<channel>]
	- Установить права op/halfop/voice на канале  <channel>  согласно
	  ACL. Если <channel> не указан, используется канал,  на  котором
	  была выдана команда.  Если  команда  была  напрямую  адресована
	  IRCyka, устанавливаются права на всех подключенных каналах. Для
	  nick'ов с флагом +p ACL не проверяются и  устанавливаются права
	  оператора.

(P)	PAR [<channel>]
	- Отключить IRCyka  от  <channel>.  Если  <channel>  не  указан и
	  команда выдана на  канале,  IRCyka  отключается  от  канала  на
	  котором выдана команда.

	PSW <passwd>
	- Сменить пароль.

	SET [<nick>] +|-<flags>
	- Установить  флаги  для  зарегистрированного  <nick>.  Установка
	  флага -l отменяет регистрацию <nick>. Если  <nick>  не  указан,
	  происводится  установка  своих  флагов. Установка флагов чужому
	  nick и/или установка флагов +c и +p требует nick флага +p.

(P)	UNL <module> [<args>]
	- Выгрузить модуль <module>

	VER
	- Распечатать версию IRCyka.

	WHO [-a] [<channel>]
	- Распечатать список зарегистрированных nick'ов.  Если указать -a
	  распечатывается список всех nick'ов.  Если  указать  <channel>,
	  распечатывается список только nick'ов,  подключенных  к  каналу
	  <channel>. Параметр <channel> и опция -a требуют nick флага +p.


Nick флаги
~~~~~~~~~~

a	- Автоматически устанавливать права  оператора/полуоператора  или
	  голоса на каналах  в  соответствии  с  ACL  при  регистрации  и
	  подключению к каналу.
c	- При выполнении команд на канале, выводить результат команды  на
	  канал.   Если  флаг  не  установлен  результат  команды  всегды
	  передается приватным сообщением.
d	- Регистрация запрещена (используется только в командах ADD/MOD).
l	- Пользователь  зарегистрирован  (используется  только  в команде
	  SET).
m	- Nick имеет непрочитаную почту. Используется модулем mail. Может
	  быть сброшен командой SET чтобы  вызвать  сообщение  о  наличии
	  почты или установлен чтобы запретить оповещение о новой почте.
p	- Nick может выполнять привилегированные команды.


ACL флаги
~~~~~~~~~
h	- Права полу-оператора на канале.
i	- Права на запрос INVITE на канал.
o	- Права оператора на канале (перекрывает флаг +h).
v	- Права голоса на канале.


Модули
~~~~~~

IRCyka поддерживает подгружаемые модули. Модуль представляет собой shared
object, написаный на C. Внутри  модуля можно использовать любые системные
подпрограммы/вызовы, входящие в libc, а также некоторые функции IRCyka. В
комплекте с IRCyka идут модули  ctcp  (поддержка  CTCP PING,  CTCP TIME и
CTCP VERSION),  help (см. описание команды HELP)  и  mail  (см.  описание
команды mail. Модуль может быть загружен командой LOA  или  автоматически
при запуске IRCyka с помощью директивы mod_load.


Формат файла модуля
~~~~~~~~~~~~~~~~~~~

...
#include "ircyka/ircyka.h"

...

static int
ircyka_module_entry(int func, const char *target, const char *arg)
{
	/*
	 * func		- Код функции.
	 * target	- Канал на котором выдана команда EXE/LOA/UNL
	 *		  или nick в случае если команда была  выдана
	 *		  в привате.  При автозагрузке  модуля target
	 *		  имеет значение NULL.
	 * arg		- Аргумент команды EXE/LOA/UNL или NULL.
	 */

	switch (func) {
	case IME_LOAD:
		/* код, выполняемый в момент загрузки */
		break;
	case IME_UNLOAD:
		/* код, выполняемый в момент выгрузки */
		break;
	case IME_EXEC:
		/* код, выполняемый по команде EXE */
		break;
	}

	/* функция должна возвращать 0 в случае успеха и -1 при ошибке */

	return (0);
}

IRCYKA_MODULE("имя", "описание");
